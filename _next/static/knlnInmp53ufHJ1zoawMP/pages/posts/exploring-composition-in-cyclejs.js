(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{JSYy:function(e,t,a){"use strict";a.r(t);var l=a("q1tI"),n=a.n(l),s=a("JRaF"),r=(a("YFqc"),{url:"exploring-composition-in-cyclejs",id:"cyclecomposition",type:"post",title:"Exploring composition in CycleJS",date:"2016-06-15",tags:["cyclejs"],author:"david",excerpt:"Experimenting with a helper function for component composition in CycleJS",draft:!1,folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2016-06-15_cyclecomposition",hasStaticContent:!0,headlines:[{level:3,text:"The premise",id:"the-premise"},{level:3,text:"Our demo app",id:"our-demo-app"},{level:3,text:"The Confirm component",id:"the-confirm-component"},{level:3,text:"The Textentry component",id:"the-textentry-component"},{level:3,text:"The Nameform component",id:"the-nameform-component"},{level:3,text:"Introspective",id:"introspective"},{level:3,text:"The `withComponent` method",id:"the-withcomponent-method"},{level:3,text:"The `withComponents` helper",id:"the-withcomponents-helper"},{level:3,text:"Wrapping up",id:"wrapping-up"}]});t.default=function(){return n.a.createElement(s.a,{kind:"post",data:r,title:"Exploring composition in CycleJS",summary:"Experimenting with a helper function for component composition in CycleJS",headlines:[{level:3,text:"The premise",id:"the-premise"},{level:3,text:"Our demo app",id:"our-demo-app"},{level:3,text:"The Confirm component",id:"the-confirm-component"},{level:3,text:"The Textentry component",id:"the-textentry-component"},{level:3,text:"The Nameform component",id:"the-nameform-component"},{level:3,text:"Introspective",id:"introspective"},{level:3,text:"The `withComponent` method",id:"the-withcomponent-method"},{level:3,text:"The `withComponents` helper",id:"the-withcomponents-helper"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["cyclejs"]},n.a.createElement("div",{className:"post","data-postid":"cyclecomposition"},n.a.createElement("h3",{id:"the-premise"},"The premise"),n.a.createElement("p",null,"This post plays around with a ",n.a.createElement("strong",null,"helper method for combining components in CycleJS"),", which can be somewhat painful when a child and parent each depend on streams from the other. You are assumed to be familiar with ",n.a.createElement("a",{href:"http://cycle.js.org/"},"CycleJS")," basics."),n.a.createElement("p",null,"We'll use ",n.a.createElement("a",{href:"https://github.com/cujojs/most"},"most")," for our streams in the code examples, but the concept works for any stream implementation."),n.a.createElement("h3",{id:"our-demo-app"},"Our demo app"),n.a.createElement("p",null,"To test the concepts we'll be using the below application. Please kick it around for a bit to see how it works!"),n.a.createElement("iframe",{className:"nb",src:"/static/posts/exploring-composition-in-cyclejs/applets/cyclecomp/demos/nameform_02.html",height:"160px",width:"100%"}),n.a.createElement("p",null,"There are three components in use here; ",n.a.createElement("strong",null,"Nameform"),", ",n.a.createElement("strong",null,"Textentry")," and ",n.a.createElement("strong",null,"Confirm"),". You can see the border between them as dashed lines in the live app above."),n.a.createElement("p",null,"Here's a diagram of how they are nested:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-components.svg",alt:"components"})),n.a.createElement("p",null,"We'll now walk through them one at a time, starting from the inside and working our way out!"),n.a.createElement("h3",{id:"the-confirm-component"},"The Confirm component"),n.a.createElement("p",null,"The innermost component is the button. It has ",n.a.createElement("strong",null,"three modes"),":"),n.a.createElement("ul",null,n.a.createElement("li",null,"Showing Submit but disabled"),n.a.createElement("li",null,"Showing Submit"),n.a.createElement("li",null,"Showing Confirm/Cancel")),n.a.createElement("p",null,"Here's the API:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-confirm-api.svg",alt:"confirm api"})),n.a.createElement("p",null,"It ",n.a.createElement("strong",null,"expects the parent to give it a ",n.a.createElement("code",null,"disabled")," stream")," as a source to let it know when to enter the disabled mode. In turn the component ",n.a.createElement("strong",null,"returns a ",n.a.createElement("code",null,"submit")," stream")," for the parent to consume, containing an event per time the user clicked the confirm button."),n.a.createElement("p",null,"Since it is a leaf component the implementation isn't relevant to the subject of this post, but if you're interested you can check out the source code ",n.a.createElement("a",{href:"/static/posts/exploring-composition-in-cyclejs/applets/cyclecomp/components/confirm.js"},"here"),"."),n.a.createElement("h3",{id:"the-textentry-component"},"The Textentry component"),n.a.createElement("p",null,"This component is responsible for... "),n.a.createElement("ul",null,n.a.createElement("li",null,"keeping track of the contents of a field"),n.a.createElement("li",null,"notifying the parent of submitted values.")),n.a.createElement("p",null,"Here's the API:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-textentry-api.svg",alt:"textentry api"})),n.a.createElement("p",null,n.a.createElement("code",null,"Textentry")," uses the ",n.a.createElement("code",null,"Confirm")," component, but here things get hairy:"),n.a.createElement("ul",null,n.a.createElement("li",null,"in order to provide the ",n.a.createElement("code",null,"disabled")," stream to ",n.a.createElement("code",null,"Confirm")," we need to know our state"),n.a.createElement("li",null,"to know our state we need our action stream"),n.a.createElement("li",null,"but to know our action stream we need the ",n.a.createElement("code",null,"submit")," stream from ",n.a.createElement("code",null,"Confirm"),"!")),n.a.createElement("p",null,"This gives us a ",n.a.createElement("strong",null,"circular dependency"),", which we must ",n.a.createElement("strong",null,"solve using a proxy"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"Textentry"),"(",n.a.createElement("span",{className:"hljs-params"},"sources"),")"),"{",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," disabledproxy = mostSubject.holdSubject(",n.a.createElement("span",{className:"hljs-number"},"1"),")",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," childsources = {",n.a.createElement("span",{className:"hljs-attr"},"DOM"),":sources.DOM,",n.a.createElement("span",{className:"hljs-attr"},"disabled$"),":disabledproxy}",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," confirm = Confirm(childsources)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," intents = intent(sources, confirm.submit$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," state$ = model(intents.action$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," vtree$ = view(state$, confirm.DOM)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," disabled$ = state$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"i")," =>")," !i).startWith(",n.a.createElement("span",{className:"hljs-literal"},"true"),")",n.a.createElement("br",null),"  disabled$.subscribe(disabledproxy)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"DOM"),": vtree$,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"submit$"),": intents.submit$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"a")," =>")," a.data)",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"If you want to see the full source including ",n.a.createElement("code",null,"intent"),", ",n.a.createElement("code",null,"model")," and ",n.a.createElement("code",null,"view"),", check ",n.a.createElement("a",{href:"/static/posts/exploring-composition-in-cyclejs/applets/cyclecomp/components/textentry_02.js"},"here"),"."),n.a.createElement("h3",{id:"the-nameform-component"},"The Nameform component"),n.a.createElement("p",null,"This is the outermost component, which ",n.a.createElement("strong",null,"holds the currently submitted name"),". It has the following API:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-nameform-api.svg",alt:"nameform api"})),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"store")," streams in sources and sinks are handled by a ",n.a.createElement("code",null,"localStorage")," driver, persisting the name between sessions."),n.a.createElement("p",null,"Here's the source code for this rather skeletal component:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"import")," Textentry ",n.a.createElement("span",{className:"hljs-keyword"},"from")," ",n.a.createElement("span",{className:"hljs-string"},"'./textentry'"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"Nameform"),"(",n.a.createElement("span",{className:"hljs-params"},"sources"),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," child = Textentry(sources)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," state$ = child.submit$",n.a.createElement("br",null),"    .startWith(",n.a.createElement("span",{className:"hljs-string"},"'John'"),")",n.a.createElement("br",null),"    .merge(sources.store)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," vtree$ = most.combine(",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"state,childvtree"),")=>"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," div([",n.a.createElement("br",null),"      childvtree,",n.a.createElement("br",null),"      h4(",n.a.createElement("span",{className:"hljs-string"},"'Hello, '"),"+state)",n.a.createElement("br",null),"    ]);",n.a.createElement("br",null),"  },state$,child.DOM)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"DOM"),": vtree$,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"store"),": state$",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}")),n.a.createElement("p",null,"We didn't need a proxy here since ",n.a.createElement("code",null,"Textentry")," didn't need any input from ",n.a.createElement("code",null,"Nameform"),"."),n.a.createElement("h3",{id:"introspective"},"Introspective"),n.a.createElement("p",null,"Here's an overview of how our components fit together:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-composition.svg",alt:"nameform api"})),n.a.createElement("p",null,"The red arrow shows the circular dependency we had to solve between ",n.a.createElement("code",null,"Textentry")," and ",n.a.createElement("code",null,"Confirm"),"."),n.a.createElement("p",null,"As you get used to CycleJS, doing the proxy dance becomes second nature and doesn't really feel that complicated. But it is still rather cumbersome code to write! Even when there isn't a circular dependency, like when we use ",n.a.createElement("code",null,"Texentry")," inside ",n.a.createElement("code",null,"Nameform"),", the code does feel somewhat boilerplaty."),n.a.createElement("p",null,"This spurred me to try to make a ",n.a.createElement("strong",null,"composition helper method"),". After several iterations I arrived at an API where I:"),n.a.createElement("ul",null,n.a.createElement("li",null,"expose the child sinks among the parent sources"),n.a.createElement("li",null,"provide (and proxy) needed parent sinks into child sources")),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/diagrams/cycle-helper.svg",alt:"helper pattern"})),n.a.createElement("p",null,"Let's see some details!"),n.a.createElement("h3",{id:"the-withcomponent-method"},"The ",n.a.createElement("code",null,"withComponent")," method"),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"withComponent")," helper has the following signature:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"withComponent(main, child, ...dependencies)")),n.a.createElement("p",null,"where..."),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("code",null,"main")," is a component main function"),n.a.createElement("li",null,n.a.createElement("code",null,"child")," is a main function for the child component"),n.a.createElement("li",null,n.a.createElement("code",null,"dependencies")," are names of props in the parent sink that the child wants as sources")),n.a.createElement("p",null,"The helper then ",n.a.createElement("strong",null,"returns a wrapped ",n.a.createElement("code",null,"main"))," where ",n.a.createElement("code",null,"sources")," will include a ",n.a.createElement("code",null,"childsinks")," prop. You must make sure that the ",n.a.createElement("code",null,"main")," function you are wrapping actually includes the expected streams in the sinks."),n.a.createElement("p",null,"Here is ",n.a.createElement("code",null,"Textentry")," reimplemented using ",n.a.createElement("code",null,"withComponent"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"main"),"(",n.a.createElement("span",{className:"hljs-params"},"sources"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," intents = intent(sources, sources.childsinks.submit$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," state$ = model(intents.action$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," vtree$ = view(state$, sources.childsinks.DOM)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"DOM"),": vtree$,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"submit$"),": intents.submit$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"a")," =>")," a.data),",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"disabled$"),": state$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"i")," =>")," !i).startWith(",n.a.createElement("span",{className:"hljs-literal"},"true"),")",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"const")," Textentry = withComponent(main,Confirm,",n.a.createElement("span",{className:"hljs-string"},'"disabled$"'),")")),n.a.createElement("p",null,"Comparing to the previous implementation we see that ",n.a.createElement("strong",null,"all proxy dancing went away"),". And we didn't need to touch ",n.a.createElement("code",null,"intent"),", ",n.a.createElement("code",null,"model")," or ",n.a.createElement("code",null,"view")," at all (although if we did we could do some more cleanup)."),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/exploring-composition-in-cyclejs/img/codeanim.gif",alt:"code anim"})),n.a.createElement("p",null,"We can also ",n.a.createElement("strong",null,"reimplement ",n.a.createElement("code",null,"Nameform")),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"main"),"(",n.a.createElement("span",{className:"hljs-params"},"sources"),")"),"{",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," state$ = sources.childsinks.child.submit$",n.a.createElement("br",null),"    .startWith(",n.a.createElement("span",{className:"hljs-string"},"'John'"),")",n.a.createElement("br",null),"    .merge(sources.store)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," vtree$ = most.combine(",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"state,childvtree"),")=>"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," div([",n.a.createElement("br",null),"      childvtree,",n.a.createElement("br",null),"      h4(",n.a.createElement("span",{className:"hljs-string"},"'Hello, '"),"+state)",n.a.createElement("br",null),"    ]);",n.a.createElement("br",null),"  },state$,sources.childsinks.DOM)",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"DOM"),": vtree$,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"store"),": state$",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"const")," Nameform = withComponent(main,Confirm)")),n.a.createElement("p",null,"Complexitywise it didn't make much difference since there was no circular dependency, but there is still something neat about abstracting away the entire composition to a helper call."),n.a.createElement("p",null,"Here is the ",n.a.createElement("strong",null,"source code for ",n.a.createElement("code",null,"withComponent")),". The ",n.a.createElement("code",null,"proxy")," comes from ",n.a.createElement("a",{href:"https://github.com/whitecolor/cycle-circular/"},"cycle-circular")," by ",n.a.createElement("a",{href:"Whitecolor"},"https://twitter.com/_whitecolor"),"."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"const")," withComponent = ",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"main, constructor, ...dependencies"),") =>")," ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"sources")," =>")," {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"let")," proxies = dependencies.reduce(",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"proxies,dep"),")=>"),"({",n.a.createElement("br",null),"    ...proxies,",n.a.createElement("br",null),"    [dep]: proxy()",n.a.createElement("br",null),"  }),{})",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," childsinks = ",n.a.createElement("span",{className:"hljs-keyword"},"constructor"),"({...sources,...proxies})",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," sinks = main({...sources,[config.childrensinks||",n.a.createElement("span",{className:"hljs-string"},"'childsinks'"),"]:childsinks})",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-built_in"},"Object"),".keys(proxies).forEach(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"proxy")," =>")," proxies[proxy].proxy(sinks[proxy]))",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," sinks",n.a.createElement("br",null),"}")),n.a.createElement("h3",{id:"the-withcomponents-helper"},"The ",n.a.createElement("code",null,"withComponents")," helper"),n.a.createElement("p",null,"Note the plural s at the end! This is for integrating many child components into a parent. Here's the signature:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"withComponents(main,children)")),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"children")," parameter is an object where each key is a reference to a child, and each value an array containing ",n.a.createElement("code",null,"[constructor, ...dependencies]")," for that child."),n.a.createElement("p",null,"It doesn't make too much sense since it only uses one child, but here is ",n.a.createElement("code",null,"Textentry")," using ",n.a.createElement("code",null,"withComponents")," instead:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"main"),"(",n.a.createElement("span",{className:"hljs-params"},"sources"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," intents = intent(sources, sources.childrensinks.confirm.submit$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," state$ = model(intents.action$)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," vtree$ = view(state$, sources.childrensinks.confirm.DOM)",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"DOM"),": vtree$,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"submit$"),": intents.submit$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"a")," =>")," a.data),",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"disabled$"),": state$.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"i")," =>")," !i).startWith(",n.a.createElement("span",{className:"hljs-literal"},"true"),")",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"const")," Textentry = withComponents(main,{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"confirm"),": [Confirm,",n.a.createElement("span",{className:"hljs-string"},'"disabled$"'),"]",n.a.createElement("br",null),"})")),n.a.createElement("p",null,"Note how the sinks from a child are now available at ",n.a.createElement("code",null,"sources.childrensinks[childref]"),"."),n.a.createElement("p",null,"Here's the source code for ",n.a.createElement("code",null,"withComponents"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"const")," withComponents = ",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"main,children"),") =>")," ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"sources")," =>")," {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"let")," proxies = {}",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," childrensinks = ",n.a.createElement("span",{className:"hljs-built_in"},"Object"),".keys(children).reduce(",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"childrensinks,child"),")=>"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"const")," [",n.a.createElement("span",{className:"hljs-keyword"},"constructor"),",...dependencies] = children[child]",n.a.createElement("br",null),"    const myproxies = dependencies.reduce((myproxies,dep)=>({",n.a.createElement("br",null),"      ...myproxies,",n.a.createElement("br",null),"      [dep]: proxies[dep] || (proxies[dep] = proxy())",n.a.createElement("br",null),"    }),{})",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"      ...childrensinks,",n.a.createElement("br",null),"      [child]: ",n.a.createElement("span",{className:"hljs-keyword"},"constructor"),"({",n.a.createElement("br",null),"        ...sources,",n.a.createElement("br",null),"        ...myproxies",n.a.createElement("br",null),"      })",n.a.createElement("br",null),"    }",n.a.createElement("br",null),"  },{})",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"const")," sinks = main({...sources,[config.childrensinks||",n.a.createElement("span",{className:"hljs-string"},"'childrensinks'"),"]:childrensinks})",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-built_in"},"Object"),".keys(proxies).forEach(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"proxy")," =>")," proxies[proxy].proxy(sinks[proxy]))",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," sinks",n.a.createElement("br",null),"}")),n.a.createElement("h3",{id:"wrapping-up"},"Wrapping up"),n.a.createElement("p",null,"I ",n.a.createElement("em",null,"think")," I have found a good abstraction, but I need to do more battletesting to be sure. If it holds up, and the community doesn't make me aware of something stupid I've overlooked (which is entirely possible), I'll publish it as an npm module."),n.a.createElement("p",null,"If you made it this far you are very likely already enamored with CycleJS, but in the improbable case that you're not, definitely give it a go! Whether you end up actually using it in sharp situations or not, simply trying it out will expand the way you think about application structure.")),n.a.createElement("hr",null))}},u8Ea:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/exploring-composition-in-cyclejs",function(){var e=a("JSYy");return{page:e.default||e}}])}},[["u8Ea",1,0]]]);