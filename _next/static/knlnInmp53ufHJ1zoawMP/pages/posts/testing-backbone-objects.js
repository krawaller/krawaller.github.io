(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"44l8":function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/testing-backbone-objects",function(){var e=a("s5w0");return{page:e.default||e}}])},s5w0:function(e,t,a){"use strict";a.r(t);var l=a("q1tI"),n=a.n(l),s=a("JRaF"),r=(a("YFqc"),{url:"testing-backbone-objects",id:"testingbackbone",type:"post",title:"Testing Backbone Objects",date:"2013-02-23",tags:["Backbone","Jasmine","Testing","Sinon"],author:"david",excerpt:"My thoughts on how to test Backbone objects without instantiating them. We also discuss testing methods involving chaining syntax and DOM manipulation",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2013-02-23_testingbackbone",hasStaticContent:!1,headlines:[{level:3,text:'Troll bait (or "How not to do it")',id:"troll-bait-or-how-not-to-do-it"},{level:3,text:"How to do it",id:"how-to-do-it"},{level:3,text:"A small case study",id:"a-small-case-study"},{level:4,text:"1: Analysis",id:"1-analysis"},{level:4,text:"2: Access the method",id:"2-access-the-method"},{level:4,text:"3: Context",id:"3-context"},{level:4,text:"4: Parameter data",id:"4-parameter-data"},{level:4,text:"5: Execute the method",id:"5-execute-the-method"},{level:4,text:"6: Test the result",id:"6-test-the-result"},{level:4,text:"7: Check context manipulation",id:"7-check-context-manipulation"},{level:4,text:"8: Check method calls",id:"8-check-method-calls"},{level:4,text:"End result",id:"end-result"},{level:3,text:"Case study #2 - Testing DOM methods",id:"case-study-2-testing-dom-methods"}]});t.default=function(){return n.a.createElement(s.a,{kind:"post",data:r,title:"Testing Backbone Objects",summary:"My thoughts on how to test Backbone objects without instantiating them. We also discuss testing methods involving chaining syntax and DOM manipulation",headlines:[{level:3,text:'Troll bait (or "How not to do it")',id:"troll-bait-or-how-not-to-do-it"},{level:3,text:"How to do it",id:"how-to-do-it"},{level:3,text:"A small case study",id:"a-small-case-study"},{level:4,text:"1: Analysis",id:"1-analysis"},{level:4,text:"2: Access the method",id:"2-access-the-method"},{level:4,text:"3: Context",id:"3-context"},{level:4,text:"4: Parameter data",id:"4-parameter-data"},{level:4,text:"5: Execute the method",id:"5-execute-the-method"},{level:4,text:"6: Test the result",id:"6-test-the-result"},{level:4,text:"7: Check context manipulation",id:"7-check-context-manipulation"},{level:4,text:"8: Check method calls",id:"8-check-method-calls"},{level:4,text:"End result",id:"end-result"},{level:3,text:"Case study #2 - Testing DOM methods",id:"case-study-2-testing-dom-methods"}],tags:["Backbone","Jasmine","Testing","Sinon"]},n.a.createElement("div",{className:"post","data-postid":"testingbackbone"},n.a.createElement("h3",{id:"troll-bait-or-how-not-to-do-it"},'Troll bait (or "How not to do it")'),n.a.createElement("p",null,"Here's a blanket statement to flame against:"),n.a.createElement("blockquote",null,n.a.createElement("p",null,n.a.createElement("em",null,"Instantiating Backbone views/models/collections in order to test them is an ",n.a.createElement("strong",null,"antipattern"),"!"))),n.a.createElement("p",null,"Why? When we try to test an instance, we're faced with two main problems:"),n.a.createElement("ul",null,n.a.createElement("li",null,"It will likely ",n.a.createElement("strong",null,"require lots of setup"),", as we have to call the constructor with some reasonable data."),n.a.createElement("li",null,"When testing some aspect of the instance, it is ",n.a.createElement("strong",null,"hard to make the test independent")," of other functionality aspects.")),n.a.createElement("h3",{id:"how-to-do-it"},"How to do it"),n.a.createElement("p",null,"So, then, how should it be done? Here's the approach I use when testing a method on a Backbone object:"),n.a.createElement("ol",null,n.a.createElement("li",null,"First we must of course ",n.a.createElement("strong",null,"analyse what the method actually does")," (or is supposed to do, if we're doing true BDD and writing the tests first)."),n.a.createElement("li",null,"Start the test by ",n.a.createElement("strong",null,"storing the method")," to test by stealing it from the constructor prototype."),n.a.createElement("li",null,"If the method touches ",n.a.createElement("code",null,"this")," (which is almost always the case in a Backbone object) I ",n.a.createElement("strong",null,"create a custom context")," object containing stubs, spies and dummy data as needed."),n.a.createElement("li",null,"I create eventual ",n.a.createElement("strong",null,"parameter")," data."),n.a.createElement("li",null,"I'll then ",n.a.createElement("strong",null,"call the method on the custom context"),"."),n.a.createElement("li",null,"Following that I can ",n.a.createElement("strong",null,"test the result"),"..."),n.a.createElement("li",null,"...check that the ",n.a.createElement("strong",null,"context was manipulated")," in the expected way..."),n.a.createElement("li",null,"...and also if my ",n.a.createElement("strong",null,"spies where called in the correct way"),".")),n.a.createElement("h3",{id:"a-small-case-study"},"A small case study"),n.a.createElement("p",null,"As an example, consider the (adapted) following view that a student of mine had in a recent project:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"var AddRecipeView = ",n.a.createElement("span",{className:"hljs-module-access"},n.a.createElement("span",{className:"hljs-module"},n.a.createElement("span",{className:"hljs-identifier"},"Backbone"),"."),n.a.createElement("span",{className:"hljs-module"},n.a.createElement("span",{className:"hljs-identifier"},"View"),".")),"extend({",n.a.createElement("br",null),n.a.createElement("br",null),"  initialize: ",n.a.createElement("span",{className:"hljs-keyword"},"function"),"(opts) {",n.a.createElement("br",null),"    this.model = ",n.a.createElement("span",{className:"hljs-keyword"},"new")," ",n.a.createElement("span",{className:"hljs-constructor"},"DishModel()"),";",n.a.createElement("br",null),"    this.render",n.a.createElement("span",{className:"hljs-literal"},"()"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// Listen to model validation errors"),n.a.createElement("br",null),"      .listen",n.a.createElement("span",{className:"hljs-constructor"},"To(",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"model"),", '",n.a.createElement("span",{className:"hljs-params"},"invalid"),"', ",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"renderErrors"),")"),n.a.createElement("br",null),"      .listen",n.a.createElement("span",{className:"hljs-constructor"},"To(",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"model"),", '",n.a.createElement("span",{className:"hljs-params"},"change"),"', ",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"checkErrorField"),")"),n.a.createElement("br",null),"  },",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest of functionality edited out..."),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"Using the test philosophy outlined above, how would we test the ",n.a.createElement("code",null,"initialize")," function? Here's one suggestion, using ",n.a.createElement("a",{href:"%5Bhttp://pivotal.github.com/jasmine/%5D"},"Jasmine"),", ",n.a.createElement("a",{href:"%5Bhttp://sinonjs.org/%5D"},"Sinon")," and ",n.a.createElement("a",{href:"%5Bhttps://github.com/froots/jasmine-sinon%5D"},"Jasmine-sinon")," custom matchers."),n.a.createElement("h4",{id:"1-analysis"},"1: Analysis"),n.a.createElement("p",null,"First we analyse what the method is supposed to do:"),n.a.createElement("ul",null,n.a.createElement("li",null,"It adds a Dishmodel instance to the context"),n.a.createElement("li",null,"It calls the render function"),n.a.createElement("li",null,"It sets two event listeners")),n.a.createElement("p",null,"These three things, and ",n.a.createElement("em",null,"only")," these, are what we should aim to test!"),n.a.createElement("h4",{id:"2-access-the-method"},"2: Access the method"),n.a.createElement("p",null,"We start the testcode by capturing the method to test from the constructor prototype:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-attribute"},"var initialize")," = AddRecipeView.prototype.initialize;")),n.a.createElement("h4",{id:"3-context"},"3: Context"),n.a.createElement("p",null,"We need to create a context with stubs for ",n.a.createElement("code",null,"listenTo")," and ",n.a.createElement("code",null,"render"),". As the method uses a chaining syntax, we must also have these stubs return our custom context. Finally we need to have some dummy data in ",n.a.createElement("code",null,".renderErrors")," and ",n.a.createElement("code",null,".checkErrorField"),", in order to be able to test if those properties were passed to ",n.a.createElement("code",null,"listenTo"),". Here's the full fake context:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"var context = {",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    listenTo:")," sinon.stub().returns(context),",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    render:")," sinon.stub().returns(context),",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    renderErrors:")," ",n.a.createElement("span",{className:"hljs-string"},'"RENDERFUNC"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    checkErrorField:")," ",n.a.createElement("span",{className:"hljs-string"},'"CHECKSTUFF"'),n.a.createElement("br",null),"};")),n.a.createElement("h4",{id:"4-parameter-data"},"4: Parameter data"),n.a.createElement("p",null,"The initialize method doesn't take any arguments, so we don't need to decide on any data for that."),n.a.createElement("h4",{id:"5-execute-the-method"},"5: Execute the method"),n.a.createElement("p",null,"Now we execute the method on our fake context:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-attribute"},"var result")," = initialize.call(context);")),n.a.createElement("h4",{id:"6-test-the-result"},"6: Test the result"),n.a.createElement("p",null,"As the initialize method isn't supposed to return anything, we don't need to test the result."),n.a.createElement("h4",{id:"7-check-context-manipulation"},"7: Check context manipulation"),n.a.createElement("p",null,"The method was supposed to add a dishmodel instance to the ",n.a.createElement("code",null,".model")," property, so let's make sure that happened:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"it(",n.a.createElement("span",{className:"hljs-string"},'"should set a Dishmodel instance on .model"'),",function(){",n.a.createElement("br",null),"    expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".model instanceof Dishmodel).toBe(",n.a.createElement("span",{className:"hljs-name"},"true"),")",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"})",n.a.createElement("span",{className:"hljs-comment"},";"))),n.a.createElement("h4",{id:"8-check-method-calls"},"8: Check method calls"),n.a.createElement("p",null,"Finally we need to make sure that other functions were called as expected. First we check for the expected call to ",n.a.createElement("code",null,"render"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"it(",n.a.createElement("span",{className:"hljs-string"},'"should call render"'),",function(){",n.a.createElement("br",null),"    expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".render).toHaveBeenCalledOnce()",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"})",n.a.createElement("span",{className:"hljs-comment"},";"))),n.a.createElement("p",null,"And finally we test if the two event listeners were set:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"it(",n.a.createElement("span",{className:"hljs-string"},'"added the event listeners"'),",function(){",n.a.createElement("br",null),"    expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo).toHaveBeenCalledTwice()",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo.firstCall.args).toEqual([",n.a.createElement("br",null),"        context.model,",n.a.createElement("span",{className:"hljs-string"},'"invalid"'),",context.renderErrors",n.a.createElement("br",null),"    ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo.secondCall.args).toEqual([",n.a.createElement("br",null),"        context.model,",n.a.createElement("span",{className:"hljs-string"},'"change"'),",context.checkErrorField",n.a.createElement("br",null),"    ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"})",n.a.createElement("span",{className:"hljs-comment"},";"))),n.a.createElement("h4",{id:"end-result"},"End result"),n.a.createElement("p",null,"To save you scrolling back and forth, here's the ",n.a.createElement("code",null,"initialize")," source again:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"var AddRecipeView = ",n.a.createElement("span",{className:"hljs-module-access"},n.a.createElement("span",{className:"hljs-module"},n.a.createElement("span",{className:"hljs-identifier"},"Backbone"),"."),n.a.createElement("span",{className:"hljs-module"},n.a.createElement("span",{className:"hljs-identifier"},"View"),".")),"extend({",n.a.createElement("br",null),n.a.createElement("br",null),"  initialize: ",n.a.createElement("span",{className:"hljs-keyword"},"function"),"(opts) {",n.a.createElement("br",null),"    this.model = ",n.a.createElement("span",{className:"hljs-keyword"},"new")," ",n.a.createElement("span",{className:"hljs-constructor"},"DishModel()"),";",n.a.createElement("br",null),"    this.render",n.a.createElement("span",{className:"hljs-literal"},"()"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// Listen to model validation errors"),n.a.createElement("br",null),"      .listen",n.a.createElement("span",{className:"hljs-constructor"},"To(",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"model"),", '",n.a.createElement("span",{className:"hljs-params"},"invalid"),"', ",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"renderErrors"),")"),n.a.createElement("br",null),"      .listen",n.a.createElement("span",{className:"hljs-constructor"},"To(",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"model"),", '",n.a.createElement("span",{className:"hljs-params"},"change"),"', ",n.a.createElement("span",{className:"hljs-params"},"this"),".",n.a.createElement("span",{className:"hljs-params"},"checkErrorField"),")"),n.a.createElement("br",null),"  },",n.a.createElement("br",null),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest of functionality edited out..."),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"...and here's the test code in full:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"describe(",n.a.createElement("span",{className:"hljs-string"},'"the initialize function"'),",function(){",n.a.createElement("br",null),"    var initialize = AddRecipeView.prototype.initialize,",n.a.createElement("br",null),"        context = {",n.a.createElement("br",null),"            listenTo: sinon.stub().returns(",n.a.createElement("span",{className:"hljs-name"},"context"),"),",n.a.createElement("br",null),"            render: sinon.stub().returns(",n.a.createElement("span",{className:"hljs-name"},"context"),"),",n.a.createElement("br",null),"            renderErrors: ",n.a.createElement("span",{className:"hljs-string"},'"RENDERFUNC"'),",",n.a.createElement("br",null),"            checkErrorField: ",n.a.createElement("span",{className:"hljs-string"},'"CHECKSTUFF"'),n.a.createElement("br",null),"        }",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    initialize.call(",n.a.createElement("span",{className:"hljs-name"},"context"),")",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"should set a Dishmodel instance on .model"'),",function(){",n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".model instanceof Dishmodel).toBe(",n.a.createElement("span",{className:"hljs-name"},"true"),")",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"should call render"'),",function(){",n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".render).toHaveBeenCalledOnce()",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"called listenTo correctly"'),",function(){",n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo).toHaveBeenCalledTwice()",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo.firstCall.args).toEqual([",n.a.createElement("br",null),"            context.model,",n.a.createElement("span",{className:"hljs-string"},'"invalid"'),",context.renderErrors",n.a.createElement("br",null),"        ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".listenTo.secondCall.args).toEqual([",n.a.createElement("br",null),"            context.model,",n.a.createElement("span",{className:"hljs-string"},'"change"'),",context.checkErrorField",n.a.createElement("br",null),"        ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"})",n.a.createElement("span",{className:"hljs-comment"},";"))),n.a.createElement("p",null,"All tests control one specific expected behaviour of the method, and nothing else. We're not even depending on any Backbone functionality, which is one of the badges to strive for when unit testing your Backbone apps! Achieving that will make the test simpler, smaller and less fragile."),n.a.createElement("h3",{id:"case-study-2---testing-dom-methods"},"Case study #2 - Testing DOM methods"),n.a.createElement("p",null,"The same approach can be adopted even when DOM manipulation is involved. Here is the ",n.a.createElement("code",null,"renderErrors")," method of the same view:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-keyword"},"var")," AddRecipeView = Backbone.View.extend({",n.a.createElement("br",null),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// ...other functionality edited out..."),n.a.createElement("br",null),n.a.createElement("br",null),"    renderErrors: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"model"),") "),"{",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".$(",n.a.createElement("span",{className:"hljs-string"},"'.errors'"),").html(",n.a.createElement("span",{className:"hljs-string"},"''"),");",n.a.createElement("br",null),"        _.each(model.validationError, ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"error"),") "),"{",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".$(",n.a.createElement("span",{className:"hljs-string"},"'.errors'"),").append(error.message + ",n.a.createElement("span",{className:"hljs-string"},"'<br>'"),");",n.a.createElement("br",null),"        });",n.a.createElement("br",null),"    },",n.a.createElement("br",null),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// ...other functionality edited out..."),n.a.createElement("br",null),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"How to test that? There's even quirkier chaining going on, and we're manipulating the DOM. Is testing this really feasible without instantiating the view?"),n.a.createElement("p",null,"Here's what I did, using the same approach as before:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"describe(",n.a.createElement("span",{className:"hljs-string"},'"the renderError function"'),",function(){",n.a.createElement("br",null),"    var renderErr = AddRecipeView.prototype.renderErrors,",n.a.createElement("br",null),"        model = {validationError:[",n.a.createElement("br",null),"            {message:",n.a.createElement("span",{className:"hljs-string"},'"err1"'),"},{message:",n.a.createElement("span",{className:"hljs-string"},'"err2"'),"},{message:",n.a.createElement("span",{className:"hljs-string"},'"err3"'),"}",n.a.createElement("br",null),"        ]},",n.a.createElement("br",null),"        $el = {",n.a.createElement("br",null),"            html: sinon.spy(),",n.a.createElement("br",null),"            append: sinon.spy()",n.a.createElement("br",null),"        },",n.a.createElement("br",null),"        context = {",n.a.createElement("br",null),"            $: sinon.stub().returns($el)",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        }",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    renderErr.call(",n.a.createElement("span",{className:"hljs-name"},"context"),",model)",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"should use the correct selector"'),",function(){",n.a.createElement("br",null),"        expect(",n.a.createElement("span",{className:"hljs-name"},"context"),".$).toHaveBeenAlwaysCalledWith(",n.a.createElement("span",{className:"hljs-string"},'".errors"'),")",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"should have cleared the previous html"'),",function(){",n.a.createElement("br",null),"        expect($el.html).toHaveBeenCalledWith(",n.a.createElement("span",{className:"hljs-string"},'""'),")",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    it(",n.a.createElement("span",{className:"hljs-string"},'"appends each errormsg"'),",function(){",n.a.createElement("br",null),"        expect($el.append).toHaveBeenCalledThrice()",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        expect($el.append.firstCall.args).toEqual([",n.a.createElement("br",null),"            model.validationError[",n.a.createElement("span",{className:"hljs-number"},"0"),"].message+",n.a.createElement("span",{className:"hljs-string"},'"<br>"'),n.a.createElement("br",null),"        ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        expect($el.append.secondCall.args).toEqual([",n.a.createElement("br",null),"            model.validationError[",n.a.createElement("span",{className:"hljs-number"},"1"),"].message+",n.a.createElement("span",{className:"hljs-string"},'"<br>"'),n.a.createElement("br",null),"        ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"        expect($el.append.thirdCall.args).toEqual([",n.a.createElement("br",null),"            model.validationError[",n.a.createElement("span",{className:"hljs-number"},"2"),"].message+",n.a.createElement("span",{className:"hljs-string"},'"<br>"'),n.a.createElement("br",null),"        ])",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"    })",n.a.createElement("span",{className:"hljs-comment"},";"),n.a.createElement("br",null),"})",n.a.createElement("span",{className:"hljs-comment"},";"))),n.a.createElement("p",null,"In order to deal with the chain, I made a dummy object for the element (",n.a.createElement("code",null,"$el"),"), and then I made the spy for the scoped selector ",n.a.createElement("code",null,"$")," return that dummy. This deals with the chaining problem, but is perhaps a bit too implementation specific - for example, the student might change from using ",n.a.createElement("code",null,"this.$(selector)")," to ",n.a.createElement("code",null,"this.$el.find(selector)"),", in which case my test would fail. It will however keep working even if he starts caching the result from ",n.a.createElement("code",null,"this.$(selector)"),", which he should of course do."),n.a.createElement("p",null,"Apart from the danger of becoming implementation specific, I find that this fake chain approach mostly works very well!"),n.a.createElement("p",null,"As for the DOM, the secret to testing it is NOT to test it. Here I stub out the relevant methods, and then simply check that they're called correctly. No special measure needs to be taken just because they're functions that are supposed to affect the DOM. I find this approach much easier than actually making sure that the correct html was set. In fact, I'll go as far as to end this post with another bit of troll bait:"),n.a.createElement("blockquote",null,n.a.createElement("p",null,n.a.createElement("em",null,"Testing if ",n.a.createElement("code",null,"this.$el.html() === expectedHtml")," is an ",n.a.createElement("strong",null,"antipattern"),"!")))),n.a.createElement("hr",null))}}},[["44l8",1,0]]]);