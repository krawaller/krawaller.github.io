(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{"0r6g":function(e,a,s){"use strict";s.r(a);var t=s("MX0m"),l=s.n(t),c=s("q1tI"),n=s.n(c),r=s("JRaF"),m=s("YFqc"),i=s.n(m),o={url:"explaining-callbags-via-typescript-definitions",id:"callbagtypescript",type:"post",title:"Explaining callbags via TypeScript definitions",date:"2018-02-25",tags:["callbags","typescript"],author:"david",excerpt:"Understanding callbags by splitting them into types with individual TypeScript definitions",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2018-02-25_callbagtypescript",hasStaticContent:!0,headlines:[{level:3,text:"Premise",id:"premise"},{level:3,text:"The official callbag typing",id:"the-official-callbag-typing"},{level:3,text:"The holy trinity of callbags",id:"the-holy-trinity-of-callbags"},{level:3,text:"Sources",id:"sources"},{level:3,text:"Source talkbacks",id:"source-talkbacks"},{level:3,text:"Sink talkbacks",id:"sink-talkbacks"},{level:3,text:"Source VS source talkback",id:"source-vs-source-talkback"},{level:3,text:"Sink VS sink talkback",id:"sink-vs-sink-talkback"},{level:3,text:"Operators and sinks",id:"operators-and-sinks"},{level:3,text:"Factories",id:"factories"},{level:3,text:"The new typings",id:"the-new-typings"},{level:3,text:"Reaping the rewards",id:"reaping-the-rewards"},{level:3,text:"Wrapping up",id:"wrapping-up"}]};a.default=function(){return n.a.createElement(r.a,{kind:"post",data:o,title:"Explaining callbags via TypeScript definitions",summary:"Understanding callbags by splitting them into types with individual TypeScript definitions",headlines:[{level:3,text:"Premise",id:"premise"},{level:3,text:"The official callbag typing",id:"the-official-callbag-typing"},{level:3,text:"The holy trinity of callbags",id:"the-holy-trinity-of-callbags"},{level:3,text:"Sources",id:"sources"},{level:3,text:"Source talkbacks",id:"source-talkbacks"},{level:3,text:"Sink talkbacks",id:"sink-talkbacks"},{level:3,text:"Source VS source talkback",id:"source-vs-source-talkback"},{level:3,text:"Sink VS sink talkback",id:"sink-vs-sink-talkback"},{level:3,text:"Operators and sinks",id:"operators-and-sinks"},{level:3,text:"Factories",id:"factories"},{level:3,text:"The new typings",id:"the-new-typings"},{level:3,text:"Reaping the rewards",id:"reaping-the-rewards"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["callbags","typescript"]},n.a.createElement("div",{"data-postid":"callbagtypescript",className:"jsx-564446276 post"},n.a.createElement("h3",{id:"premise",className:"jsx-564446276"},"Premise"),n.a.createElement("p",{className:"jsx-564446276"},"I've already written an ",n.a.createElement(i.a,{href:"/posts/callbags-introduction",prefetch:!0},n.a.createElement("a",{className:"jsx-564446276"},"introduction to callbags")),", but I wasn't completely happy - it still feels like the initial threshold to grokk what's going on is rather high. Callbags are a rather simple concept, but communicating the nuances is surprisingly difficult."),n.a.createElement("p",{className:"jsx-564446276"},"In this post I make a second attempt, this time via splitting up the lifecycle and definining precise TypeScript interfaces for the various parts. You are assumed to have read the introductory post and/or be familiar with the ",n.a.createElement("a",{href:"https://github.com/callbag/callbag",className:"jsx-564446276"},"callbags spec"),"."),n.a.createElement("h3",{id:"the-official-callbag-typing",className:"jsx-564446276"},"The official callbag typing"),n.a.createElement("p",{className:"jsx-564446276"},"The spec defines a callbag as..."),n.a.createElement("blockquote",{className:"jsx-564446276"},n.a.createElement("p",{className:"jsx-564446276"},"a function of signature (TypeScript syntax:)",n.a.createElement("br",{className:"jsx-564446276"})," ",n.a.createElement("code",{className:"jsx-564446276"},"(type: 0 | 1 | 2, payload?: any) => void"))),n.a.createElement("p",{className:"jsx-564446276"},"This is further reflected in the ",n.a.createElement("a",{href:"https://github.com/callbag/callbag/blob/master/types.d.ts",className:"jsx-564446276"},"official ",n.a.createElement("code",{className:"jsx-564446276"},"types.d.ts")," file")," which looks like this (slightly abbreviated):"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs"},n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"START = 0;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"DATA = 1;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"END = 2;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"Callbag = (type: START | DATA | END, payload?: any) => void;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"Factory = (",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},".."),".args: Array<any>) => Callbag;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-builtin-name"},"export"),n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"}," type "),"Operator = (",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},".."),".args: Array<any>) => (source: Callbag) => Callbag;")),n.a.createElement("p",{className:"jsx-564446276"},"The trouble is that ",n.a.createElement("code",{className:"jsx-564446276"},"START"),", ",n.a.createElement("code",{className:"jsx-564446276"},"DATA")," and ",n.a.createElement("code",{className:"jsx-564446276"},"END")," are ",n.a.createElement("em",{className:"jsx-564446276"},"not always")," valid as the first parameter to a callbag. Exactly what we can send depends on where we are in the life cycle."),n.a.createElement("p",{className:"jsx-564446276"},"Or, phrased differently: it depends on ",n.a.createElement("em",{className:"jsx-564446276"},"from where we got the callbag we're calling"),". This can be surmised from the written text of the spec, but it isn't reflected in the typings."),n.a.createElement("h3",{id:"the-holy-trinity-of-callbags",className:"jsx-564446276"},"The holy trinity of callbags"),n.a.createElement("p",{className:"jsx-564446276"},"Things become more clear when you realise that there are actually ",n.a.createElement("strong",{className:"jsx-564446276"},"three different kinds of callbags"),":"),n.a.createElement("ul",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},n.a.createElement("strong",{className:"jsx-564446276"},"Source"),": The initial callbag function that a sink can subscribe to"),n.a.createElement("li",{className:"jsx-564446276"},n.a.createElement("strong",{className:"jsx-564446276"},"Sink talkback")," The callbag sent to the source by the sink when subscribing"),n.a.createElement("li",{className:"jsx-564446276"},n.a.createElement("strong",{className:"jsx-564446276"},"Source talkback")," The callbag sent in response to the sink talkback by the source talkback")),n.a.createElement("p",{className:"jsx-564446276"},"These three kinds of callbags expect to be called in different ways. In other words, they have different signatures! Here's a lowdown in table form on how they can be called:"),n.a.createElement(l.a,{id:"564446276"},[".YEP.jsx-564446276{color:green;font-weight:bold;}",".NOPE.jsx-564446276{color:red;font-weight:bold;}",".sup.jsx-564446276{vertical-align:baseline;position:relative;font-size:70%;top:-0.6em;}",".note.jsx-564446276{font-size:0.8em;}"]),n.a.createElement("table",{className:"jsx-564446276"},n.a.createElement("thead",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("th",{className:"jsx-564446276"},"call"),n.a.createElement("th",{className:"jsx-564446276"},"source"),n.a.createElement("th",{className:"jsx-564446276"},"source talkback"),n.a.createElement("th",{className:"jsx-564446276"},"sink talkback"))),n.a.createElement("tbody",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(0, callbag)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))),n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(1)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"),n.a.createElement("span",{className:"jsx-564446276 sup"},"1")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no"))),n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(1, data)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))),n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(2)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))),n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(2, error)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"),n.a.createElement("span",{className:"jsx-564446276 sup"},"2")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))))),n.a.createElement("span",{className:"jsx-564446276 note"},n.a.createElement("span",{className:"jsx-564446276 sup"},"1")," If the source is pullable ",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 sup"},"2"),' A source likely doesn\'t care why the sink terminates, so you could argue for a "no" here'),n.a.createElement("p",{className:"jsx-564446276"},'And, applying the notion of "three different kinds of callbags" consistently, we should split the first row in the table...'),n.a.createElement("table",{className:"jsx-564446276"},n.a.createElement("thead",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("th",{className:"jsx-564446276"},"call"),n.a.createElement("th",{className:"jsx-564446276"},"source"),n.a.createElement("th",{className:"jsx-564446276"},"source talkback"),n.a.createElement("th",{className:"jsx-564446276"},"sink talkback"))),n.a.createElement("tbody",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(0, callbag)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))))),n.a.createElement("p",{className:"jsx-564446276"},"...to this:"),n.a.createElement("table",{className:"jsx-564446276"},n.a.createElement("thead",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("th",{className:"jsx-564446276"},"call"),n.a.createElement("th",{className:"jsx-564446276"},"source"),n.a.createElement("th",{className:"jsx-564446276"},"source talkback"),n.a.createElement("th",{className:"jsx-564446276"},"sink talkback"))),n.a.createElement("tbody",{className:"jsx-564446276"},n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(0, sinkTalkback)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no"))),n.a.createElement("tr",{className:"jsx-564446276"},n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276"},"(0, sourceTalkback)")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 NOPE"},"no")),n.a.createElement("td",{className:"jsx-564446276"},n.a.createElement("span",{className:"jsx-564446276 YEP"},"yes"))))),n.a.createElement("p",{className:"jsx-564446276"},"Let's take our three different types one by one and see if our observations match some real-world code. And, if they do, create individual type definitions for them!"),n.a.createElement("h3",{id:"sources",className:"jsx-564446276"},"Sources"),n.a.createElement("p",{className:"jsx-564446276"},"According to our table, a ",n.a.createElement("em",{className:"jsx-564446276"},"source")," callbag only ever expects to be called with ",n.a.createElement("code",{className:"jsx-564446276"},"(0, sinkTalkback)"),". This is reflected in the code for many source implementations in that the first parameter is called ",n.a.createElement("code",{className:"jsx-564446276"},"start"),", not ",n.a.createElement("code",{className:"jsx-564446276"},"t"),"."),n.a.createElement("p",{className:"jsx-564446276"},"For example, look at Staltz' ",n.a.createElement("a",{href:"https://github.com/staltz/callbag-interval",className:"jsx-564446276"},"callbag-interval")," source:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," interval = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"period")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start, sink"),") =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (start !== ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"return"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," i = ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," id = setInterval(",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"()")," =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"    sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),", i++);",n.a.createElement("br",{className:"jsx-564446276"}),"  }, period);",n.a.createElement("br",{className:"jsx-564446276"}),"  sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", t => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") clearInterval(id);",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"The signature in the code is called ",n.a.createElement("code",{className:"jsx-564446276"},"(start, sink)"),", and if ",n.a.createElement("code",{className:"jsx-564446276"},"start")," doesn't equal ",n.a.createElement("code",{className:"jsx-564446276"},"0")," we bail because nothing else makes sense at this point. This function will never receive data requests ",n.a.createElement("code",{className:"jsx-564446276"},"(1)")," or terminations ",n.a.createElement("code",{className:"jsx-564446276"},"(2)")," - those will be sent to a source talkback."),n.a.createElement("p",{className:"jsx-564446276"},"In other words, a TypeScript definition for a ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," could be:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Source = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sinkTalkback: SinkTalkback"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("h3",{id:"source-talkbacks",className:"jsx-564446276"},"Source talkbacks"),n.a.createElement("p",{className:"jsx-564446276"},"In our table we noted ",n.a.createElement("code",{className:"jsx-564446276"},"(1)")," and ",n.a.createElement("code",{className:"jsx-564446276"},"(2)")," (and maybe ",n.a.createElement("code",{className:"jsx-564446276"},"(2, error)"),") as valid calls to the ",n.a.createElement("em",{className:"jsx-564446276"},"source talkback"),". Peeking back at the code for ",n.a.createElement("code",{className:"jsx-564446276"},"interval"),", the source talkback is implemented as:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"t => {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") clearInterval(id);",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"It only ever handles terminations ",n.a.createElement("code",{className:"jsx-564446276"},"(2)"),". This makes sense since ",n.a.createElement("code",{className:"jsx-564446276"},"interval")," isn't pullable, so it doesn't care about data requests ",n.a.createElement("code",{className:"jsx-564446276"},"(1)"),"."),n.a.createElement("p",{className:"jsx-564446276"},"To take a pullable example, here's Staltz' ",n.a.createElement("a",{href:"https://github.com/staltz/callbag-from-pull-stream",className:"jsx-564446276"},"callbag-from-pull-stream"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," fromPullStream = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"read")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start, sink"),") =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (start !== ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"return"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (t, d) => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- source talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),")",n.a.createElement("br",{className:"jsx-564446276"}),"      read(",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"null"),", (end, data) => {",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (end === ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"true"),") sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),");",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"else")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (end) sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),", end);",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"else")," sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),", data);",n.a.createElement("br",{className:"jsx-564446276"}),"      });",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") read(d || ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"true"),", () => {});",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"Here we can see the source talkback definition dealing with both ",n.a.createElement("code",{className:"jsx-564446276"},"(1)")," and ",n.a.createElement("code",{className:"jsx-564446276"},"(2)"),"."),n.a.createElement("p",{className:"jsx-564446276"},"Let's now tie up our observations about the source talkback into a TypeScript definition:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"type SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type: DATA | END, payload: any"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"If we accept the notion that a source is never interested in why a sink terminates, we could skip the second parameter since it is only used for ",n.a.createElement("code",{className:"jsx-564446276"},"(2, error)"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"type SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type: DATA | END"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"We could also potentially split this into separate interfaces for pullable and listenable sources:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"type PullableSourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type: DATA | END"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),"type ListenableSourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type: END"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"And then define a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback")," as being one or the other:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"type SourceTalkback = PullableSourceTalkback | ListenableSourceTalkback;")),n.a.createElement("h3",{id:"sink-talkbacks",className:"jsx-564446276"},"Sink talkbacks"),n.a.createElement("p",{className:"jsx-564446276"},"Now for the third and final type - sink talkbacks! In our table we had them listed as accepting all three types ",n.a.createElement("code",{className:"jsx-564446276"},"START"),", ",n.a.createElement("code",{className:"jsx-564446276"},"DATA")," and ",n.a.createElement("code",{className:"jsx-564446276"},"END"),". This makes sense since they..."),n.a.createElement("ul",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},"must be greeted back by the source with a source talkback, which means ",n.a.createElement("code",{className:"jsx-564446276"},"START")),n.a.createElement("li",{className:"jsx-564446276"},"will receive data from the source, which means ",n.a.createElement("code",{className:"jsx-564446276"},"DATA")),n.a.createElement("li",{className:"jsx-564446276"},"can be terminated by the source, which means ",n.a.createElement("code",{className:"jsx-564446276"},"END"))),n.a.createElement("p",{className:"jsx-564446276"},"Here is Staltz' ",n.a.createElement("a",{href:"https://github.com/staltz/callbag-for-each",className:"jsx-564446276"},"callbag-for-each"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," forEach = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"operation")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source")," =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," talkback;",n.a.createElement("br",{className:"jsx-564446276"}),"  source(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (t, d) => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- sink talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") talkback = d;",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),") operation(d);",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1")," || t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") talkback(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),");",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"It doesn't handle ",n.a.createElement("code",{className:"jsx-564446276"},"(2)"),", but it doesn't need to - if there's no more data coming in, nothing more will happen. There's nothing going on downstream from ",n.a.createElement("code",{className:"jsx-564446276"},"forEach")," and nothing to clean up, so we don't need to act."),n.a.createElement("p",{className:"jsx-564446276"},"To see termination handling we must look at something that needs to clean up. Or something that isn't at the end of the chain - in other words, a sink used by an operator to make a new source! As an example, here is my ",n.a.createElement("a",{href:"https://github.com/krawaller/callbag-latest",className:"jsx-564446276"},"callbag-latest")," which turns a listenable source into a pullable one:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," latest = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"listenable")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start, sink"),") =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (start !== ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"return"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," ltalkback;",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," latestValue;",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," hasLatestValue = ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"false"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  listenable(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (lt, ld) => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- sink talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (lt === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") {",n.a.createElement("br",{className:"jsx-564446276"}),"      ltalkback = ld;",n.a.createElement("br",{className:"jsx-564446276"}),"      sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (st, sd) => {",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (st === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1")," && hasLatestValue) sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),", latestValue);",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (st === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") ltalkback(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),", sd);",n.a.createElement("br",{className:"jsx-564446276"}),"      });",n.a.createElement("br",{className:"jsx-564446276"}),"    }",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (lt === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),") {",n.a.createElement("br",{className:"jsx-564446276"}),"      latestValue = ld;",n.a.createElement("br",{className:"jsx-564446276"}),"      hasLatestValue = ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"true"),";",n.a.createElement("br",{className:"jsx-564446276"}),"    }",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (lt === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),", ld);",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"Here we can clearly see the sink talkback handling all three cases including terminations ",n.a.createElement("code",{className:"jsx-564446276"},"(2)")," - although, as is often the case, the only thing it does with the termination is to pass it down the chain."),n.a.createElement("p",{className:"jsx-564446276"},"Since sink talkbacks actually handle all three cases, they are the first kind of callbag that matches the official callbag typing!"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type"),": START | DATA | END, payload?: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"We can clarify the second parameter by splitting this into three different types and joining them via an ",n.a.createElement("a",{href:"https://www.typescriptlang.org/docs/handbook/advanced-types.html",className:"jsx-564446276"},"intersection type")," using ",n.a.createElement("code",{className:"jsx-564446276"},"&"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sourceTalkback: SourceTalkback"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"deliver: DATA, data: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END, error?: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");"))),n.a.createElement("p",{className:"jsx-564446276"},"The extra parenthesises around the three function types are needed for TypeScript not to throw a fit."),n.a.createElement("p",{className:"jsx-564446276"},"This gives us rather nice intellisense help in a TypeScript setting:"),n.a.createElement("p",{className:"jsx-564446276"},n.a.createElement("img",{src:"/static/posts/explaining-callbags-via-typescript-definitions/img/callbag-typing.gif",alt:"",className:"jsx-564446276"})),n.a.createElement("p",{className:"jsx-564446276"},"In fact, that's so nice that we should split up ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback")," in the same way so that it too gets separate parameter names per call type:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"request: DATA"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") & (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");"))),n.a.createElement("h3",{id:"source-vs-source-talkback",className:"jsx-564446276"},"Source VS source talkback"),n.a.createElement("p",{className:"jsx-564446276"},"Our tour of the three different kinds of callbags - source, source talkback and sink talkback - is now concluded!"),n.a.createElement("p",{className:"jsx-564446276"},"But let's zoom out and discuss the difference between ",n.a.createElement("em",{className:"jsx-564446276"},"source")," and ",n.a.createElement("em",{className:"jsx-564446276"},"source talkback")," for a bit. Our TypeScript definition for ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," was:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Source = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sinkTalkback: SinkTalkback"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"...and ",n.a.createElement("code",{className:"jsx-564446276"},"Source talkback"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"request: DATA"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") & (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");"))),n.a.createElement("p",{className:"jsx-564446276"},"But what exactly does the spec say about ",n.a.createElement("strong",{className:"jsx-564446276"},"source"),"? Well:"),n.a.createElement("blockquote",{className:"jsx-564446276"},n.a.createElement("p",{className:"jsx-564446276"},"a callbag which is expected to deliver data")),n.a.createElement("p",{className:"jsx-564446276"},"Hmm. Who is it that delivers data - is it the ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," or the ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback"),"? Well, that actually depends!"),n.a.createElement("p",{className:"jsx-564446276"},"In a ",n.a.createElement("em",{className:"jsx-564446276"},"pullable source")," it is the ",n.a.createElement("em",{className:"jsx-564446276"},"source talkback"),". Check again at the source for ",n.a.createElement("code",{className:"jsx-564446276"},"fromPullStream"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," fromPullStream = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"read")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start, sink"),") =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (start !== ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"return"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (t, d) => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- source talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),")",n.a.createElement("br",{className:"jsx-564446276"}),"      read(",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"null"),", (end, data) => {",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (end === ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"true"),") sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),");",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"else")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (end) sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),", end);",n.a.createElement("br",{className:"jsx-564446276"}),"        ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"else")," sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),", data); ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- delivery call"),n.a.createElement("br",{className:"jsx-564446276"}),"      });",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") read(d || ",n.a.createElement("span",{className:"jsx-564446276 hljs-literal"},"true"),", () => {});",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"sink(1, data)")," call takes place inside the source talkback. But if we look at a listenable source like ",n.a.createElement("code",{className:"jsx-564446276"},"interval"),"..."),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," interval = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"period")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start, sink"),") =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (start !== ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"return"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," i = ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),";",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," id = setInterval(",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"()")," =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"    sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),", i++); ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <---- delivery call"),n.a.createElement("br",{className:"jsx-564446276"}),"  }, period);",n.a.createElement("br",{className:"jsx-564446276"}),"  sink(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", t => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <---- source talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"2"),") clearInterval(id);",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"...you'll note the ",n.a.createElement("code",{className:"jsx-564446276"},"sink(1, data)")," call is taking place inside the ",n.a.createElement("em",{className:"jsx-564446276"},"source"),"."),n.a.createElement("p",{className:"jsx-564446276"},"This means that the word ",n.a.createElement("strong",{className:"jsx-564446276"},"source")," as defined in the spec encompasses ",n.a.createElement("em",{className:"jsx-564446276"},"both")," ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," and ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback"),". The concept includes both typings. Or you could argue that ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback")," is an implementation detail of ",n.a.createElement("code",{className:"jsx-564446276"},"Source"),"."),n.a.createElement("p",{className:"jsx-564446276"},"Either way, using the name ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," for a type seems like needless confusion potential. To mitigate that, let's rename what we've defined as ",n.a.createElement("code",{className:"jsx-564446276"},"Source")," and call it ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator")," instead:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceInitiator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sinkTalkback: SinkTalkback"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"Now the words make more sense - the definition of ",n.a.createElement("em",{className:"jsx-564446276"},"source")," in the spec includes both concepts of ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator")," and ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback"),"."),n.a.createElement("h3",{id:"sink-vs-sink-talkback",className:"jsx-564446276"},"Sink VS sink talkback"),n.a.createElement("p",{className:"jsx-564446276"},"The obvious next question - what, then, is the difference between a sink and a sink talkback? What even ",n.a.createElement("em",{className:"jsx-564446276"},"is")," a sink?"),n.a.createElement("p",{className:"jsx-564446276"},"The spec simply says..."),n.a.createElement("blockquote",{className:"jsx-564446276"},n.a.createElement("p",{className:"jsx-564446276"},"a callbag which is expected to be delivered data")),n.a.createElement("p",{className:"jsx-564446276"},"...which clearly fits the sink talkback. That will always be what receives the data. However, that doesn't answer our question of what a sink actually is."),n.a.createElement("p",{className:"jsx-564446276"},"But if a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator")," is what provides a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback"),", an interesting thing might be to look at what provides the ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback"),"! Let's look again at ",n.a.createElement("code",{className:"jsx-564446276"},"forEach"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"const")," forEach = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"operation")," =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source")," =>")," {",n.a.createElement("br",{className:"jsx-564446276"}),"  ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"let")," talkback;",n.a.createElement("br",{className:"jsx-564446276"}),"  source(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),", (t, d) => {",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// <--- sink talkback"),n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") talkback = d;",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),") operation(d);",n.a.createElement("br",{className:"jsx-564446276"}),"    ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"if")," (t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1")," || t === ",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"0"),") talkback(",n.a.createElement("span",{className:"jsx-564446276 hljs-number"},"1"),");",n.a.createElement("br",{className:"jsx-564446276"}),"  });",n.a.createElement("br",{className:"jsx-564446276"}),"};")),n.a.createElement("p",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"sourceInitiator(0, sinkTalkback)")," call takes place inside a function that takes a source parameter and returns nothing. Is perhaps that a sink? Or, by the previous logic, a sink initiator?"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkInitiator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"I'd say yes, that is a sink (initiator)!"),n.a.createElement("p",{className:"jsx-564446276"},"Except this time the typescript definition isn't as helpful, since it doesn't encode the fact that to be a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkInitiator")," you must also ",n.a.createElement("em",{className:"jsx-564446276"},"call the passed source")," in a specific way. It is kind of implied through the type of the passed in ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator"),", but, still."),n.a.createElement("p",{className:"jsx-564446276"},"Perhaps we can make the implication stronger still by calling it ",n.a.createElement("code",{className:"jsx-564446276"},"SinkConnector")," instead of ",n.a.createElement("code",{className:"jsx-564446276"},"SinkInitiator"),"? Yeah, let's do that!"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-javascript"},"type SinkConnector = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},'However, we can note that every single usage of the word "sink" in the spec fits what we\'ve labeled as a ',n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback"),". In other words, we could have called that a ",n.a.createElement("code",{className:"jsx-564446276"},"Sink"),". But it seems nice to be constistent in suffixing the type for a callbag that is passed in to another callbag with ",n.a.createElement("code",{className:"jsx-564446276"},"-Talkback"),"."),n.a.createElement("h3",{id:"operators-and-sinks",className:"jsx-564446276"},"Operators and sinks"),n.a.createElement("p",{className:"jsx-564446276"},"In the official typings, ",n.a.createElement("em",{className:"jsx-564446276"},"operators")," are defined as:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Operator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," (source: Callbag) => Callbag;")),n.a.createElement("p",{className:"jsx-564446276"},"We can replace ",n.a.createElement("code",{className:"jsx-564446276"},"Callbag")," with what we've called ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Operator = (",n.a.createElement("br",{className:"jsx-564446276"}),"  ...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">",n.a.createElement("br",{className:"jsx-564446276"}),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," SourceInitiator;")),n.a.createElement("p",{className:"jsx-564446276"},"So what's returned from calling the operators with some arguments is ",n.a.createElement("em",{className:"jsx-564446276"},"almost")," a sink connector, except it returns ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator")," instead of ",n.a.createElement("code",{className:"jsx-564446276"},"void"),"!"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkConnector = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," ReturnedFromOp = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," SourceInitiator;")),n.a.createElement("p",{className:"jsx-564446276"},"Do we want to be able to say that an operator returns a sink connector? Or should we invent a new concept for this?"),n.a.createElement("p",{className:"jsx-564446276"},"I'm voting for the former - it makes sense to say that an operator returns a sink connector. We can do that by merging the two types above thusly:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkConnector = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," SourceInitiator | ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";")),n.a.createElement("p",{className:"jsx-564446276"},"This has four benefits:"),n.a.createElement("ul",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},"no need for a separate type to describe what is returned by an operator"),n.a.createElement("li",{className:"jsx-564446276"},"we can type operators who ",n.a.createElement("em",{className:"jsx-564446276"},"don't")," return anything (in other words, an operator for a sink)"),n.a.createElement("li",{className:"jsx-564446276"},"we can type sinks who returns a source initiator, allowing for the chain to continue"),n.a.createElement("li",{className:"jsx-564446276"},"the chainability is now visible in the typings!")),n.a.createElement("p",{className:"jsx-564446276"},"So our revised type for ",n.a.createElement("code",{className:"jsx-564446276"},"Operator")," is now:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Operator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SinkConnector")),n.a.createElement("h3",{id:"factories",className:"jsx-564446276"},"Factories"),n.a.createElement("p",{className:"jsx-564446276"},"The official typings also had a typing for ",n.a.createElement("code",{className:"jsx-564446276"},"Factory"),":"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Factory = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," Callbag;")),n.a.createElement("p",{className:"jsx-564446276"},"We can now clarify that into:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceFactory = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SourceInitiator;")),n.a.createElement("p",{className:"jsx-564446276"},"What about a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkFactory"),"? It turns out we don't need one - a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkFactory")," is simply an ",n.a.createElement("code",{className:"jsx-564446276"},"Operator")," that returns a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkConnector")," that ",n.a.createElement("em",{className:"jsx-564446276"},"doesn't")," return a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator"),"!"),n.a.createElement("h3",{id:"the-new-typings",className:"jsx-564446276"},"The new typings"),n.a.createElement("p",{className:"jsx-564446276"},"Here are all our new typings collected:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-comment"},"// Source"),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceFactory = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SourceInitiator;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceInitiator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sinkTalkback: SinkTalkback"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"request: DATA"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") & (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),"// ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"Sink"),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"SinkConnector")," = (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," SourceInitiator | ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sourceTalkback: SourceTalkback"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"deliver: DATA, data: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END, error?: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),"// ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"Other"),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"Operator")," = (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SinkConnector;")),n.a.createElement("p",{className:"jsx-564446276"},"However, if we want to avoid using types that haven't been defined yet, we can look at the dependency graph of the types..."),n.a.createElement("p",{className:"jsx-564446276"},n.a.createElement("img",{src:"/static/posts/explaining-callbags-via-typescript-definitions/diagrams/callbag-typedefs.svg",alt:"",className:"jsx-564446276"})),n.a.createElement("p",{className:"jsx-564446276"},"...and reorder them backwards according to that:"),n.a.createElement("pre",{className:"jsx-564446276"},n.a.createElement("code",{className:"jsx-564446276 hljs language-typescript"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceTalkback = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"request: DATA"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") & (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"SinkTalkback")," = (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"start: START, sourceTalkback: SourceTalkback"),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"deliver: DATA, data: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),") &",n.a.createElement("br",{className:"jsx-564446276"}),"  (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"terminate: END, error?: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any")),") => ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void")),");",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"type")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"SourceInitiator")," = (",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type"),": START, payload: SinkTalkback"),") =>")," ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SinkConnector = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"source: SourceInitiator"),") =>")," SourceInitiator | ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"void"),";",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," SourceFactory = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SourceInitiator;",n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("br",{className:"jsx-564446276"}),n.a.createElement("span",{className:"jsx-564446276 hljs-keyword"},"type")," Operator = ",n.a.createElement("span",{className:"jsx-564446276 hljs-function"},"(",n.a.createElement("span",{className:"jsx-564446276 hljs-params"},"...args: ",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"Array"),"<",n.a.createElement("span",{className:"jsx-564446276 hljs-built_in"},"any"),">"),") =>")," SinkConnector;")),n.a.createElement("h3",{id:"reaping-the-rewards",className:"jsx-564446276"},"Reaping the rewards"),n.a.createElement("p",{className:"jsx-564446276"},"With these typings down we can use them as a very precise vocabulary for explaining the process of using callbags!"),n.a.createElement("p",{className:"jsx-564446276"},"Here's the setup and handshake:"),n.a.createElement("ol",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},"We call a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkConnector")," passing in a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator"),": ",n.a.createElement("code",{className:"jsx-564446276"},"sinkConnector(sourceInitiator)")),n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SourceInitiator")," is called with a ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback"),": ",n.a.createElement("code",{className:"jsx-564446276"},"sourceInitiator(0,sinkTalkback)")),n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback")," is called with a ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback"),": ",n.a.createElement("code",{className:"jsx-564446276"},"sinkTalkback(0,sourceTalkback)"))),n.a.createElement("p",{className:"jsx-564446276"},"And data passing:"),n.a.createElement("ol",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback")," is called with a request for data (if pullable): ",n.a.createElement("code",{className:"jsx-564446276"},"sourceTalkback(1)")),n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback")," is called with data delivery: ",n.a.createElement("code",{className:"jsx-564446276"},"sinkTalkback(1,data)"))),n.a.createElement("p",{className:"jsx-564446276"},"And termination:"),n.a.createElement("ul",{className:"jsx-564446276"},n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SourceTalkback")," can be called to terminate the relationship: ",n.a.createElement("code",{className:"jsx-564446276"},"sourceTalkback(2)")),n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback")," can be called to terminate the relationship: ",n.a.createElement("code",{className:"jsx-564446276"},"sinkTalkback(2)")),n.a.createElement("li",{className:"jsx-564446276"},"The ",n.a.createElement("code",{className:"jsx-564446276"},"SinkTalkback")," can be called to terminate the relationship due to an error: ",n.a.createElement("code",{className:"jsx-564446276"},"sinkTalkback(2,error)"))),n.a.createElement("h3",{id:"wrapping-up",className:"jsx-564446276"},"Wrapping up"),n.a.createElement("p",{className:"jsx-564446276"},"Creating the types definitely helped me cement my own understanding of callbags, but I'm not sure if they have a pedagogic power in general. I can only hope you found this instructive, otherwise you just made a very long journey for nothing. :)")),n.a.createElement("hr",null))}},"3niX":function(e,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.flush=function(){var e=o.cssRules();return o.flush(),e},a.default=void 0;var t,l=s("q1tI");function c(e){return(c="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,a){for(var s=0;s<a.length;s++){var t=a[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function r(e,a){return!a||"object"!==c(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,a){return(i=Object.setPrototypeOf||function(e,a){return e.__proto__=a,e})(e,a)}var o=new(((t=s("SevZ"))&&t.__esModule?t:{default:t}).default),j=function(e){function a(e){var s;return function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,a),(s=r(this,m(a).call(this,e))).prevProps={},s}var s,t,c;return function(e,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&i(e,a)}(a,l.Component),s=a,c=[{key:"dynamic",value:function(e){return e.map(function(e){var a=e[0],s=e[1];return o.computeId(a,s)}).join(" ")}}],(t=[{key:"shouldComponentUpdate",value:function(e){return this.props.id!==e.id||String(this.props.dynamic)!==String(e.dynamic)}},{key:"componentWillUnmount",value:function(){o.remove(this.props)}},{key:"render",value:function(){return this.shouldComponentUpdate(this.prevProps)&&(this.prevProps.id&&o.remove(this.prevProps),o.add(this.props),this.prevProps=this.props),null}}])&&n(s.prototype,t),c&&n(s,c),a}();a.default=j},"7NuE":function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/explaining-callbags-via-typescript-definitions",function(){var e=s("0r6g");return{page:e.default||e}}])},"8oxB":function(e,a){var s,t,l=e.exports={};function c(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(s===setTimeout)return setTimeout(e,0);if((s===c||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(a){try{return s.call(null,e,0)}catch(a){return s.call(this,e,0)}}}!function(){try{s="function"===typeof setTimeout?setTimeout:c}catch(e){s=c}try{t="function"===typeof clearTimeout?clearTimeout:n}catch(e){t=n}}();var m,i=[],o=!1,j=-1;function p(){o&&m&&(o=!1,m.length?i=m.concat(i):j=-1,i.length&&h())}function h(){if(!o){var e=r(p);o=!0;for(var a=i.length;a;){for(m=i,i=[];++j<a;)m&&m[j].run();j=-1,a=i.length}m=null,o=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===n||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(a){try{return t.call(null,e)}catch(a){return t.call(this,e)}}}(e)}}function u(e,a){this.fun=e,this.array=a}function x(){}l.nextTick=function(e){var a=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)a[s-1]=arguments[s];i.push(new u(e,a)),1!==i.length||o||r(h)},u.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=x,l.addListener=x,l.once=x,l.off=x,l.removeListener=x,l.removeAllListeners=x,l.emit=x,l.prependListener=x,l.prependOnceListener=x,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},"9kyW":function(e,a,s){"use strict";e.exports=function(e){for(var a=5381,s=e.length;s;)a=33*a^e.charCodeAt(--s);return a>>>0}},MX0m:function(e,a,s){e.exports=s("3niX")},SevZ:function(e,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var t=c(s("9kyW")),l=c(s("bVZc"));function c(e){return e&&e.__esModule?e:{default:e}}function n(e,a){for(var s=0;s<a.length;s++){var t=a[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var r=function(){function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=a.styleSheet,t=void 0===s?null:s,c=a.optimizeForSpeed,n=void 0!==c&&c,r=a.isBrowser,m=void 0===r||r;!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this._sheet=t||new l.default({name:"styled-jsx",optimizeForSpeed:n}),this._sheet.inject(),t&&"boolean"===typeof n&&(this._sheet.setOptimizeForSpeed(n),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._isBrowser=m,this._fromServer=void 0,this._indices={},this._instancesCounts={},this.computeId=this.createComputeId(),this.computeSelector=this.createComputeSelector()}var a,s,c;return a=e,(s=[{key:"add",value:function(e){var a=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._isBrowser&&!this._fromServer&&(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,a){return e[a]=0,e},{}));var s=this.getIdAndRules(e),t=s.styleId,l=s.rules;if(t in this._instancesCounts)this._instancesCounts[t]+=1;else{var c=l.map(function(e){return a._sheet.insertRule(e)}).filter(function(e){return-1!==e});this._indices[t]=c,this._instancesCounts[t]=1}}},{key:"remove",value:function(e){var a=this,s=this.getIdAndRules(e).styleId;if(function(e,a){if(!e)throw new Error("StyleSheetRegistry: ".concat(a,"."))}(s in this._instancesCounts,"styleId: `".concat(s,"` not found")),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var t=this._fromServer&&this._fromServer[s];t?(t.parentNode.removeChild(t),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return a._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}}},{key:"update",value:function(e,a){this.add(a),this.remove(e)}},{key:"flush",value:function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={},this.computeId=this.createComputeId(),this.computeSelector=this.createComputeSelector()}},{key:"cssRules",value:function(){var e=this,a=this._fromServer?Object.keys(this._fromServer).map(function(a){return[a,e._fromServer[a]]}):[],s=this._sheet.cssRules();return a.concat(Object.keys(this._indices).map(function(a){return[a,e._indices[a].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return Boolean(e[1])}))}},{key:"createComputeId",value:function(){var e={};return function(a,s){if(!s)return"jsx-".concat(a);var l=String(s),c=a+l;return e[c]||(e[c]="jsx-".concat((0,t.default)("".concat(a,"-").concat(l)))),e[c]}}},{key:"createComputeSelector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:/__jsx-style-dynamic-selector/g,a={};return function(s,t){this._isBrowser||(t=t.replace(/\/style/gi,"\\/style"));var l=s+t;return a[l]||(a[l]=t.replace(e,s)),a[l]}}},{key:"getIdAndRules",value:function(e){var a=this,s=e.children,t=e.dynamic,l=e.id;if(t){var c=this.computeId(l,t);return{styleId:c,rules:Array.isArray(s)?s.map(function(e){return a.computeSelector(c,e)}):[this.computeSelector(c,s)]}}return{styleId:this.computeId(l),rules:Array.isArray(s)?s:[s]}}},{key:"selectFromServer",value:function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,a){return e[a.id.slice(2)]=a,e},{})}}])&&n(a.prototype,s),c&&n(a,c),e}();a.default=r},bVZc:function(e,a,s){"use strict";(function(e){function s(e,a){for(var s=0;s<a.length;s++){var t=a[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var t=e.env&&!0,l=function(e){return"[object String]"===Object.prototype.toString.call(e)},c=function(){function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=a.name,c=void 0===s?"stylesheet":s,r=a.optimizeForSpeed,m=void 0===r?t:r,i=a.isBrowser,o=void 0===i||i;!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),n(l(c),"`name` must be a string"),this._name=c,this._deletedRulePlaceholder="#".concat(c,"-deleted-rule____{}"),n("boolean"===typeof m,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=m,this._isBrowser=o,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var j=this._isBrowser&&document.querySelector('meta[property="csp-nonce"]');this._nonce=j?j.getAttribute("content"):null}var a,c,r;return a=e,(c=[{key:"setOptimizeForSpeed",value:function(e){n("boolean"===typeof e,"`setOptimizeForSpeed` accepts a boolean"),n(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()}},{key:"isOptimizeForSpeed",value:function(){return this._optimizeForSpeed}},{key:"inject",value:function(){var e=this;if(n(!this._injected,"sheet already injected"),this._injected=!0,this._isBrowser&&this._optimizeForSpeed)return this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),void(this._optimizeForSpeed||(t||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0));this._serverSheet={cssRules:[],insertRule:function(a,s){return"number"===typeof s?e._serverSheet.cssRules[s]={cssText:a}:e._serverSheet.cssRules.push({cssText:a}),s},deleteRule:function(a){e._serverSheet.cssRules[a]=null}}}},{key:"getSheetForTag",value:function(e){if(e.sheet)return e.sheet;for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].ownerNode===e)return document.styleSheets[a]}},{key:"getSheet",value:function(){return this.getSheetForTag(this._tags[this._tags.length-1])}},{key:"insertRule",value:function(e,a){if(n(l(e),"`insertRule` accepts only strings"),!this._isBrowser)return"number"!==typeof a&&(a=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,a),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!==typeof a&&(a=s.cssRules.length);try{s.insertRule(e,a)}catch(r){return t||console.warn("StyleSheet: illegal rule: \n\n".concat(e,"\n\nSee https://stackoverflow.com/q/20007992 for more info")),-1}}else{var c=this._tags[a];this._tags.push(this.makeStyleTag(this._name,e,c))}return this._rulesCount++}},{key:"replaceRule",value:function(e,a){if(this._optimizeForSpeed||!this._isBrowser){var s=this._isBrowser?this.getSheet():this._serverSheet;if(a.trim()||(a=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(a,e)}catch(c){t||console.warn("StyleSheet: illegal rule: \n\n".concat(a,"\n\nSee https://stackoverflow.com/q/20007992 for more info")),s.insertRule(this._deletedRulePlaceholder,e)}}else{var l=this._tags[e];n(l,"old rule at index `".concat(e,"` not found")),l.textContent=a}return e}},{key:"deleteRule",value:function(e){if(this._isBrowser)if(this._optimizeForSpeed)this.replaceRule(e,"");else{var a=this._tags[e];n(a,"rule at index `".concat(e,"` not found")),a.parentNode.removeChild(a),this._tags[e]=null}else this._serverSheet.deleteRule(e)}},{key:"flush",value:function(){this._injected=!1,this._rulesCount=0,this._isBrowser?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]}},{key:"cssRules",value:function(){var e=this;return this._isBrowser?this._tags.reduce(function(a,s){return s?a=a.concat(e.getSheetForTag(s).cssRules.map(function(a){return a.cssText===e._deletedRulePlaceholder?null:a})):a.push(null),a},[]):this._serverSheet.cssRules}},{key:"makeStyleTag",value:function(e,a,s){a&&n(l(a),"makeStyleTag acceps only strings as second parameter");var t=document.createElement("style");this._nonce&&t.setAttribute("nonce",this._nonce),t.type="text/css",t.setAttribute("data-".concat(e),""),a&&t.appendChild(document.createTextNode(a));var c=document.head||document.getElementsByTagName("head")[0];return s?c.insertBefore(t,s):c.appendChild(t),t}},{key:"length",get:function(){return this._rulesCount}}])&&s(a.prototype,c),r&&s(a,r),e}();function n(e,a){if(!e)throw new Error("StyleSheet: ".concat(a,"."))}a.default=c}).call(this,s("8oxB"))}},[["7NuE",1,0]]]);