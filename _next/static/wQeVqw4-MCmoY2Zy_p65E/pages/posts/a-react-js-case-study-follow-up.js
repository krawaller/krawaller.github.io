(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{dTGZ:function(e,a,t){"use strict";t.r(a);var l=t("q1tI"),n=t.n(l),s=t("JRaF"),r=t("YFqc"),c=t.n(r),m={url:"a-react-js-case-study-follow-up",id:"reactfollowup",title:"A React.js case study follow-up",author:"david",tags:["react","underscore","case study"],date:"2014-09-05",excerpt:"This post details a refactoring of the previous React case study. We also touch on some Underscore usage.",type:"post",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2014-09-05_reactfollowup",hasStaticContent:!1,headlines:[{level:3,text:"React Memory Game version 2",id:"react-memory-game-version-2"},{level:3,text:"ES6 Transformation",id:"es6-transformation"},{level:3,text:"The new Game component code",id:"the-new-game-component-code"},{level:3,text:"Show &amp; hide versus rendering only relevant components",id:"show-amp-hide-versus-rendering-only-relevant-components"},{level:3,text:"Decoupling through callback names",id:"decoupling-through-callback-names"},{level:3,text:"The new Wordform component code",id:"the-new-wordform-component-code"},{level:3,text:"Defining expected properties through propTypes",id:"defining-expected-properties-through-proptypes"},{level:3,text:"Semi-defining the state variables",id:"semidefining-the-state-variables"},{level:3,text:"Underscore elitism",id:"underscore-elitism"},{level:3,text:"The new Board component code",id:"the-new-board-component-code"},{level:3,text:"Waiting is boring",id:"waiting-is-boring"},{level:3,text:"Property-generated constant",id:"propertygenerated-constant"},{level:3,text:"State variable VS instance variable",id:"state-variable-vs-instance-variable"},{level:3,text:"The new Status component code",id:"the-new-status-component-code"},{level:3,text:"The state of a tile",id:"the-state-of-a-tile"},{level:3,text:"More underscore shenanigans",id:"more-underscore-shenanigans"},{level:3,text:"Tile click catching attempt #1 - passing back instance",id:"tile-click-catching-attempt-1-passing-back-instance"},{level:3,text:"Tile click catching attempt #2 - passing back index",id:"tile-click-catching-attempt-2-passing-back-index"},{level:3,text:"Tile click catching attempt #3 - calling prefilled callback",id:"tile-click-catching-attempt-3-calling-prefilled-callback"},{level:3,text:"Tile click catching attempt #4 - moving the `unturned` check up to `Board`",id:"tile-click-catching-attempt-4-moving-the-unturned-check-up-to-board"},{level:3,text:"Tile click catching final version - catching click in Board",id:"tile-click-catching-final-version-catching-click-in-board"},{level:3,text:"The new Tile component code",id:"the-new-tile-component-code"},{level:3,text:"Wrapping up (again)",id:"wrapping-up-again"}]};a.default=function(){return n.a.createElement(s.a,{kind:"post",data:m,title:"A React.js case study follow-up",summary:"This post details a refactoring of the previous React case study. We also touch on some Underscore usage.",headlines:[{level:3,text:"React Memory Game version 2",id:"react-memory-game-version-2"},{level:3,text:"ES6 Transformation",id:"es6-transformation"},{level:3,text:"The new Game component code",id:"the-new-game-component-code"},{level:3,text:"Show &amp; hide versus rendering only relevant components",id:"show-amp-hide-versus-rendering-only-relevant-components"},{level:3,text:"Decoupling through callback names",id:"decoupling-through-callback-names"},{level:3,text:"The new Wordform component code",id:"the-new-wordform-component-code"},{level:3,text:"Defining expected properties through propTypes",id:"defining-expected-properties-through-proptypes"},{level:3,text:"Semi-defining the state variables",id:"semidefining-the-state-variables"},{level:3,text:"Underscore elitism",id:"underscore-elitism"},{level:3,text:"The new Board component code",id:"the-new-board-component-code"},{level:3,text:"Waiting is boring",id:"waiting-is-boring"},{level:3,text:"Property-generated constant",id:"propertygenerated-constant"},{level:3,text:"State variable VS instance variable",id:"state-variable-vs-instance-variable"},{level:3,text:"The new Status component code",id:"the-new-status-component-code"},{level:3,text:"The state of a tile",id:"the-state-of-a-tile"},{level:3,text:"More underscore shenanigans",id:"more-underscore-shenanigans"},{level:3,text:"Tile click catching attempt #1 - passing back instance",id:"tile-click-catching-attempt-1-passing-back-instance"},{level:3,text:"Tile click catching attempt #2 - passing back index",id:"tile-click-catching-attempt-2-passing-back-index"},{level:3,text:"Tile click catching attempt #3 - calling prefilled callback",id:"tile-click-catching-attempt-3-calling-prefilled-callback"},{level:3,text:"Tile click catching attempt #4 - moving the `unturned` check up to `Board`",id:"tile-click-catching-attempt-4-moving-the-unturned-check-up-to-board"},{level:3,text:"Tile click catching final version - catching click in Board",id:"tile-click-catching-final-version-catching-click-in-board"},{level:3,text:"The new Tile component code",id:"the-new-tile-component-code"},{level:3,text:"Wrapping up (again)",id:"wrapping-up-again"}],tags:["react","underscore","case study"]},n.a.createElement("div",{className:"post","data-postid":"reactfollowup"},n.a.createElement("h3",{id:"react-memory-game-version-2"},"React Memory Game version 2"),n.a.createElement("p",null,"A week ago I wrote a ",n.a.createElement(c.a,{href:"/posts/a-react-js-case-study",prefetch:!0},n.a.createElement("a",null,"case study on a small React experiment")),", a memory game I whipped up to learn the ins and outs of React. Here's the game in an iframe again (here's a ",n.a.createElement("a",{href:"https://blog.krawaller.se/reactexperiment/"},"link")," if you want it in a separate tab), to save you from hopping back to refresh your memory (...). The repo, as before, can be found ",n.a.createElement("a",{href:"https://github.com/krawaller/reactexperiment/"},"here"),"."),n.a.createElement("iframe",{src:"https://blog.krawaller.se/reactexperiment/",style:{height:240,width:"100%"}}),n.a.createElement("p",null,"Since this was my first foray into React the code was, well, less than perfect. But I was fortunate to receive lots of excellent feedback in the comments and ",n.a.createElement("a",{href:"https://news.ycombinator.com/item?id=8247223"},"on Hacker News"),", foremost of which was Facebook's ",n.a.createElement("a",{href:"http://ianobermiller.com/"},"Ian Obermiller")," who took the time to do a ",n.a.createElement("a",{href:"https://github.com/ianobermiller/reactexperiment/"},"fork of the repo")," with ",n.a.createElement("a",{href:"https://github.com/ianobermiller/reactexperiment/commits/"},"in-depth comments to each commit"),"."),n.a.createElement("p",null,"After digesting all the feedback, and having spent more time with the React docs, I went over the Memory game code again. This post walks through those changes and the lessons learned. The text assumes you've already read the ",n.a.createElement(c.a,{href:"/posts/a-react-js-case-study",prefetch:!0},n.a.createElement("a",null,"previous post")),", so please hop over there if you came straight here."),n.a.createElement("h3",{id:"es6-transformation"},"ES6 Transformation"),n.a.createElement("p",null,"First off, Ian and others pointed out that the JSX Transformation also contains support for some ES6 features, so there's really no reason not to use them! Throughout the new code I've therefore made use of these, primarily the ",n.a.createElement("a",{href:"http://tc39wiki.calculist.org/es6/arrow-functions/"},"Arrow Functions")," and ",n.a.createElement("a",{href:"http://tc39wiki.calculist.org/es6/object-literal-enhancements/"},"Method Definition Shorthand"),"."),n.a.createElement("p",null,"The Arrow Function syntax has many nuances, but primarily it is a way to define a function more succinctly. The created function is also bound to the current scope."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"// old way"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," myFunc = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"arg"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// do stuff"),n.a.createElement("br",null),"}.bind(",n.a.createElement("span",{className:"hljs-built_in"},"this"),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"// ES6 way"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," myFunc = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"arg")," =>")," {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// do stuff"),n.a.createElement("br",null),"};")),n.a.createElement("p",null,"And here's the method definition shorthand example:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"// old way"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," o = {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"method"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-string"},'"Hello!"'),";",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"//ES6 way"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," o = {",n.a.createElement("br",null),"  method() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-string"},'"Hello!"'),";",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};")),n.a.createElement("h3",{id:"the-new-game-component-code"},"The new Game component code"),n.a.createElement("p",null,"Now to the React stuff! Starting again with the top-level ",n.a.createElement("code",null,"Game")," component, here's the updated code:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"/** ",n.a.createElement("span",{className:"hljs-doctag"},"@jsx "),"React.DOM */"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Game = React.createClass({",n.a.createElement("br",null),"  getInitialState() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {};",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  startGame(words) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"words"),": _.shuffle(words.concat(words))",n.a.createElement("br",null),"    });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  endGame() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"words"),": ",n.a.createElement("span",{className:"hljs-literal"},"undefined")," });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.words ? (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Board")," ",n.a.createElement("span",{className:"hljs-attr"},"onEndGame"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.endGame}")," ",n.a.createElement("span",{className:"hljs-attr"},"words"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.words}")," />")),n.a.createElement("br",null),"    ) : (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Wordform")," ",n.a.createElement("span",{className:"hljs-attr"},"onWordsEntered"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.startGame}")," />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Props"),n.a.createElement("th",null,"State"),n.a.createElement("th",null,"Sub components"),n.a.createElement("th",null,"Instance variables"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null),n.a.createElement("td",null,n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"playing"),n.a.createElement("br",null),"tiles"),n.a.createElement("td",null,"Wordform",n.a.createElement("br",null),"Board"),n.a.createElement("td",null)))),n.a.createElement("p",null,"For each component I'll also show the same table as before, highlighting any differences."),n.a.createElement("p",null,"As you can see here, I removed the ",n.a.createElement("code",null,"playing")," flag from ",n.a.createElement("code",null,"Game"),", opting instead to set ",n.a.createElement("code",null,"words")," to undefined on game end. Slightly less obvious code, but one less state variable. Which is preferrable is pure philosophy, and mine is to go for brevity."),n.a.createElement("h3",{id:"show--hide-versus-rendering-only-relevant-components"},"Show & hide versus rendering only relevant components"),n.a.createElement("p",null,"in my first version I alternated between showing the ",n.a.createElement("code",null,"Board")," and ",n.a.createElement("code",null,"Wordform")," through always rendering both, but showing and hiding them as appropriate. This is the old render function containing this approach:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.playing"),' ? "',n.a.createElement("span",{className:"hljs-attr"},"showing"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "',n.a.createElement("span",{className:"hljs-attr"},"hidden"),'"}>'),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Board"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"endGame"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.endGame}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"tiles"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.tiles}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"max"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.tiles.length")," / ",n.a.createElement("span",{className:"hljs-attr"},"2"),"}",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.seed}"),n.a.createElement("br",null),"      />"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.playing"),' ? "',n.a.createElement("span",{className:"hljs-attr"},"hidden"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "',n.a.createElement("span",{className:"hljs-attr"},"showing"),'"}>'),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Wordform")," ",n.a.createElement("span",{className:"hljs-attr"},"startGame"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.startGame}")," />"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),");")),n.a.createElement("p",null,"By misreading the docs and misunderstanding an error message, I was fooled into believing that this was the way to go, instead of choosing what component to render. As it turns out, there is no problem with the latter approach, which of course makes for much cleaner code:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.words ? (",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Board")," ",n.a.createElement("span",{className:"hljs-attr"},"onEndGame"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.endGame}")," ",n.a.createElement("span",{className:"hljs-attr"},"words"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.words}")," />")),n.a.createElement("br",null),") : (",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Wordform")," ",n.a.createElement("span",{className:"hljs-attr"},"onWordsEntered"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.startGame}")," />")),n.a.createElement("br",null),");")),n.a.createElement("p",null,"Note also how we no longer need to throw a random seed into the ",n.a.createElement("code",null,"key")," property of ",n.a.createElement("code",null,"Board")," to force it to rerender, as it will always be a new board since it previously didn't exist in the virtual DOM."),n.a.createElement("p",null,"A side note; if we used React with addons, we could use ",n.a.createElement("a",{href:"http://facebook.github.io/react/docs/animation.html"},"ReactCSSTransitionGroup")," to animate the components as they enter/leave."),n.a.createElement("h3",{id:"decoupling-through-callback-names"},"Decoupling through callback names"),n.a.createElement("p",null,"Sharp eyes will also note how the new version passes ",n.a.createElement("code",null,"this.startGame")," to ",n.a.createElement("code",null,"Wordform")," as a property called ",n.a.createElement("code",null,"onWordsEntered")," instead of ",n.a.createElement("code",null,"startGame"),". This was another ",n.a.createElement("a",{href:"https://github.com/ianobermiller/reactexperiment/commit/1d2335876ba85d17929212e538e5823db84eabe7"},"good point of feedback from Ian"),"; name your properties to make the child less coupled to the parent. ",n.a.createElement("code",null,"Wordform")," doesn't care what happens when the words are submitted, it merely calls a callback when that happens. The name should reflect that."),n.a.createElement("p",null,"Similar renamings have been done throughout the code base."),n.a.createElement("h3",{id:"the-new-wordform-component-code"},"The new Wordform component code"),n.a.createElement("p",null,"Here's what the new ",n.a.createElement("code",null,"Wordform")," component code looks like:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"/** ",n.a.createElement("span",{className:"hljs-doctag"},"@jsx "),"React.DOM */"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Wordform = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"onWordsEntered"),": React.PropTypes.func.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  getInitialState() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"error"),": ",n.a.createElement("span",{className:"hljs-string"},'""')," };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  setError(msg) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"error"),": msg });",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"setTimeout"),"(",n.a.createElement("span",{className:"hljs-function"},"() =>")," {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"error"),": ",n.a.createElement("span",{className:"hljs-string"},'""')," });",n.a.createElement("br",null),"    }, ",n.a.createElement("span",{className:"hljs-number"},"2000"),");",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  submitWords(e) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," node = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".refs[",n.a.createElement("span",{className:"hljs-string"},'"wordfield"'),"].getDOMNode(),",n.a.createElement("br",null),"      words = (node.value || ",n.a.createElement("span",{className:"hljs-string"},'""'),")",n.a.createElement("br",null),"        .trim()",n.a.createElement("br",null),"        .replace(",n.a.createElement("span",{className:"hljs-regexp"},"/\\W+/g"),", ",n.a.createElement("span",{className:"hljs-string"},'" "'),")",n.a.createElement("br",null),"        .split(",n.a.createElement("span",{className:"hljs-string"},'" "'),");",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (words.length <= ",n.a.createElement("span",{className:"hljs-number"},"2"),") {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setError(",n.a.createElement("span",{className:"hljs-string"},'"Enter at least 3 words!"'),");",n.a.createElement("br",null),"    } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (words.length !== _.unique(words).length) {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setError(",n.a.createElement("span",{className:"hljs-string"},'"Don\'t enter duplicate words!"'),");",n.a.createElement("br",null),"    } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (_.find(words, ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-params"},"w")," =>")," w.length > ",n.a.createElement("span",{className:"hljs-number"},"8"),")) {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setError(",n.a.createElement("span",{className:"hljs-string"},'"Words should not be longer than 8 characters!"'),");",n.a.createElement("br",null),"    } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.onWordsEntered(words);",n.a.createElement("br",null),"      node.value = ",n.a.createElement("span",{className:"hljs-string"},'""'),";",n.a.createElement("br",null),"    }",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-literal"},"false"),";",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"form")," ",n.a.createElement("span",{className:"hljs-attr"},"onSubmit"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.submitWords}"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),"Enter words separated by spaces!",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"input")," ",n.a.createElement("span",{className:"hljs-attr"},"type"),"=",n.a.createElement("span",{className:"hljs-string"},'"text"')," ",n.a.createElement("span",{className:"hljs-attr"},"ref"),"=",n.a.createElement("span",{className:"hljs-string"},'"wordfield"')," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button")," ",n.a.createElement("span",{className:"hljs-attr"},"type"),"=",n.a.createElement("span",{className:"hljs-string"},'"submit"'),">"),"Start!",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"error"')," ",n.a.createElement("span",{className:"hljs-attr"},"ref"),"=",n.a.createElement("span",{className:"hljs-string"},'"errormsg"'),">"),n.a.createElement("br",null),"          {this.state.error}",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"form"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Props"),n.a.createElement("th",null,"State"),n.a.createElement("th",null,"Sub components"),n.a.createElement("th",null,"Instance variables"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"*onWordsEntered()*"),n.a.createElement("td",null,"error"),n.a.createElement("td",null),n.a.createElement("td",null)))),n.a.createElement("p",null,"The only change in the table is the already mentioned renaming, shown here through the italizicing of ",n.a.createElement("code",null,"onWordsEntered"),"."),n.a.createElement("h3",{id:"defining-expected-properties-through-proptypes"},"Defining expected properties through propTypes"),n.a.createElement("p",null,"The primary point of interest in ",n.a.createElement("code",null,"Wordform")," is up top; Ian made me aware of the ",n.a.createElement("code",null,"propTypes")," property which allows you to clearly communicate what properties your component expects (and also validate them while in development mode)."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"propTypes: {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"onWordsEntered"),": React.PropTypes.func.isRequired",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"As we see here ",n.a.createElement("code",null,"Wordform")," just expects the one, namely the previously mentioned callback which got a new name."),n.a.createElement("h3",{id:"semi-defining-the-state-variables"},"Semi-defining the state variables"),n.a.createElement("p",null,"Note our call to ",n.a.createElement("code",null,"getInitialState"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"getInitialState(){",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("span",{className:"hljs-attr"},"error"),":",n.a.createElement("span",{className:"hljs-string"},"''"),"};",n.a.createElement("br",null),"}")),n.a.createElement("p",null,"Returning an empty object here would suffice, but explicitly setting the ",n.a.createElement("code",null,"error")," property to an empty string communicates that the component will make use of this state variable."),n.a.createElement("p",null,"This, along with the ",n.a.createElement("code",null,"propTypes")," literal above, goes a long way to help the reader to gain immediate understanding of the component's functionality. Together they give you the same information as my data table!"),n.a.createElement("h3",{id:"underscore-elitism"},"Underscore elitism"),n.a.createElement("p",null,"There is one other tiny change regarding ",n.a.createElement("code",null,"Wordform"),"; in the old code, I used the following expression to test if any word was too long;"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"_.filter(words, ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"w"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," w.length > ",n.a.createElement("span",{className:"hljs-number"},"8"),";",n.a.createElement("br",null),"}).length;")),n.a.createElement("p",null,"...while in the new code, I'm doing this (shown here without ES6 stuff):"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"_.find(words, ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"w"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," w.length > ",n.a.createElement("span",{className:"hljs-number"},"8"),";",n.a.createElement("br",null),"});")),n.a.createElement("p",null,'Functionally it makes absolutely no difference, but it touches on something I feel is important, albeight on a pedantic level - knowing your tools is important. Learning Underscore/Lodash (along with functional programming) levelled me up quite a bit as a programmer, and I took pride in being able to write shorter code. Making this "mistake" therefore itched quite a bit.'),n.a.createElement("h3",{id:"the-new-board-component-code"},"The new Board component code"),n.a.createElement("p",null,"Now for the big one! ",n.a.createElement("code",null,"Board")," was already the most complex component, so it is only natural that it contains the most changes. Here's the new code in full:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"/** ",n.a.createElement("span",{className:"hljs-doctag"},"@jsx "),"React.DOM */"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Board = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"words"),": React.PropTypes.arrayOf(React.PropTypes.string).isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"onEndGame"),": React.PropTypes.func.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  getInitialState() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"found"),": ",n.a.createElement("span",{className:"hljs-number"},"0"),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"choosetile"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.map(_.range(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.length), ",n.a.createElement("span",{className:"hljs-function"},"() =>")," ",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),")",n.a.createElement("br",null),"    };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  componentWillMount() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".max = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.length / ",n.a.createElement("span",{className:"hljs-number"},"2"),";",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  clickedTile(index) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates[index] === ",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),") {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// turn up lone tile"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedTileIndex === ",n.a.createElement("span",{className:"hljs-literal"},"undefined"),") {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedTileIndex = index;",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),",",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"            _.object([index], [",n.a.createElement("span",{className:"hljs-string"},'"revealed"'),"])",n.a.createElement("br",null),"          )",n.a.createElement("br",null),"        });",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// clicked second tile"),n.a.createElement("br",null),"      } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"var")," otherindex = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedTileIndex,",n.a.createElement("br",null),"          matched = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words[index] === ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words[otherindex];",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"delete")," ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedTileIndex;",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// found mathing pair"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (matched) {",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"found"),": ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.found + ",n.a.createElement("span",{className:"hljs-number"},"1"),",",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"foundmate"'),",",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"              _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"correct"'),", ",n.a.createElement("span",{className:"hljs-string"},'"correct"'),"])",n.a.createElement("br",null),"            )",n.a.createElement("br",null),"          });",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-comment"},"// pair didn't match"),n.a.createElement("br",null),"        } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),",",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"              _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),", ",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),"])",n.a.createElement("br",null),"            )",n.a.createElement("br",null),"          });",n.a.createElement("br",null),"        }",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// restore UI message after 1500, and flip back eventual failed attempt"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"setTimeout"),"(",n.a.createElement("span",{className:"hljs-function"},"() =>")," {",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".isMounted()) {",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"message"),":",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.message === ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),n.a.createElement("br",null),"                  ? ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),n.a.createElement("br",null),"                  : ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".max === ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.found",n.a.createElement("br",null),"                  ? ",n.a.createElement("span",{className:"hljs-string"},'"foundall"'),n.a.createElement("br",null),"                  : ",n.a.createElement("span",{className:"hljs-string"},'"choosetile"'),",",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": matched",n.a.createElement("br",null),"                ? ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates",n.a.createElement("br",null),"                : _.extend(",n.a.createElement("br",null),"                    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"                    _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),", ",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),"])",n.a.createElement("br",null),"                  )",n.a.createElement("br",null),"            });",n.a.createElement("br",null),"          }",n.a.createElement("br",null),"        }, ",n.a.createElement("span",{className:"hljs-number"},"1500"),");",n.a.createElement("br",null),"      }",n.a.createElement("br",null),"    }",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button")," ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.props.onEndGame}"),">"),"End game",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Status"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-attr"},"found"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.found}"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-attr"},"max"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.max}"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-attr"},"message"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.message}"),n.a.createElement("br",null),"        />"),n.a.createElement("br",null),"        {this.props.words.map((b, n) => (",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(this.clickedTile,")," ",n.a.createElement("span",{className:"hljs-attr"},"n"),")}>"),n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Tile")," ",n.a.createElement("span",{className:"hljs-attr"},"word"),"=",n.a.createElement("span",{className:"hljs-string"},"{b}")," ",n.a.createElement("span",{className:"hljs-attr"},"status"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.tilestates[n]}")," />"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ))}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Props"),n.a.createElement("th",null,"State"),n.a.createElement("th",null,"Sub components"),n.a.createElement("th",null,"Instance variables"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"*words*",n.a.createElement("br",null),"*onEndGame()*"),n.a.createElement("td",null,"found",n.a.createElement("br",null),"message",n.a.createElement("br",null),n.a.createElement("span",{style:{color:"green"}},"**tilestates**")),n.a.createElement("td",null,"Status",n.a.createElement("br",null),"Tile"),n.a.createElement("td",null,n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"wait"),n.a.createElement("br",null),"*flippedTileIndex*",n.a.createElement("br",null),n.a.createElement("span",{style:{color:"green"}},"**max**"))))),n.a.createElement("p",null,"As said, lots of changes, which we'll now walk through!"),n.a.createElement("h3",{id:"waiting-is-boring"},"Waiting is boring"),n.a.createElement("p",null,"First off, the old version contained a ",n.a.createElement("code",null,"wait"),' flag which made sure that after you turned up a pair, you couldn\'t click a new tile for 2 seconds while the succeed/fail animations took place. This "feature" was badly communicated and rather frustrating, and most people thought it was a bug.'),n.a.createElement("p",null,"Therefore I decided to simply remove it, hence the stricken out ",n.a.createElement("code",null,"wait")," instance variable in the component data table."),n.a.createElement("h3",{id:"property-generated-constant"},"Property-generated constant"),n.a.createElement("p",null,"In the previous version ",n.a.createElement("code",null,"Board")," didn't make use of ",n.a.createElement("code",null,"max"),". It was just passed as a property to ",n.a.createElement("code",null,"Status"),", calculated at that point:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"<Status",n.a.createElement("br",null),"  found={",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.found}",n.a.createElement("br",null),"  max={",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.tiles.length / ",n.a.createElement("span",{className:"hljs-number"},"2"),"}",n.a.createElement("br",null),"  message={",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.message}",n.a.createElement("br",null),"/>")),n.a.createElement("p",null,"Inside ",n.a.createElement("code",null,"Status")," we used the ",n.a.createElement("code",null,"max")," information to decide what to display when the message instruction from ",n.a.createElement("code",null,"Board")," was ",n.a.createElement("code",null,"choosetile"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.message === ",n.a.createElement("span",{className:"hljs-string"},'"choosetile"')," && found === max",n.a.createElement("br",null),"  ? ",n.a.createElement("span",{className:"hljs-string"},'"foundall"'),n.a.createElement("br",null),"  : ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.message;")),n.a.createElement("p",null,"Going over the code it felt weird to have just that particular logic in ",n.a.createElement("code",null,"Status"),". It seemed to belong in the parent, so I decided to move it there. But that means ",n.a.createElement("code",null,"Board")," now needs to use the ",n.a.createElement("code",null,"max")," value, which raised a seemingly innocent question - how to handle that?"),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"max")," value is calculated by doing ",n.a.createElement("code",null,"words.length/2"),", but I don't want to calculate it on the fly every time I need it. An older version of the code passed ",n.a.createElement("code",null,"max")," along with ",n.a.createElement("code",null,"words")," from ",n.a.createElement("code",null,"Game")," to ",n.a.createElement("code",null,"Board"),", but that seems silly too. It should be calculated from ",n.a.createElement("code",null,"words")," when the ",n.a.createElement("code",null,"Board")," instance is initialized."),n.a.createElement("p",null,"The premier place for turned out to be the ",n.a.createElement("code",null,"componentWillMount")," hook. At this point in the component life cycle the properties are accessible, so ",n.a.createElement("code",null,"max")," can be set as an instance variable like thus:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"componentWillMount() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".max = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.length/",n.a.createElement("span",{className:"hljs-number"},"2"),";",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"Throughout the rest of the code I could then replace ",n.a.createElement("code",null,"this.props.max")," with ",n.a.createElement("code",null,"this.max"),". A small gain, but the real win was cleaning up the logic in the child component, ",n.a.createElement("code",null,"Status"),", without having to increase the complexity of ",n.a.createElement("code",null,"Board"),"'s signature by expecting ",n.a.createElement("code",null,"max")," as a property."),n.a.createElement("p",null,"Note how the ",n.a.createElement("code",null,"componentWillMount")," call sits up top with ",n.a.createElement("code",null,"propTypes")," and ",n.a.createElement("code",null,"getInitialState"),", as it also is communicating contents from my component data table!"),n.a.createElement("h3",{id:"state-variable-vs-instance-variable"},"State variable VS instance variable"),n.a.createElement("p",null,"I noticed Ian refactored the old ",n.a.createElement("code",null,"wait")," instance variable to be a state variable, but I can't (yet?) see the advantage to that. Why put variables in this.state, with all the overhead that means, if they will never affect the output of the ",n.a.createElement("code",null,"render")," method?"),n.a.createElement("p",null,"That's why I didn't make ",n.a.createElement("code",null,"max")," a state variable, which would of course also have worked:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"getInitialState() {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"max"),": ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.length/",n.a.createElement("span",{className:"hljs-number"},"2"),",",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// the other variables redacted"),n.a.createElement("br",null),"  };",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"It would even mean less code, as the one extra line in the ",n.a.createElement("code",null,"getInitialState")," object literal replaced the call to ",n.a.createElement("code",null,"componentWillMount"),". Still, in my head, using ",n.a.createElement("code",null,"this.state")," solely for rendering-affecting state took precedence."),n.a.createElement("h3",{id:"the-new-status-component-code"},"The new Status component code"),n.a.createElement("p",null,"Here's the full code for the updated Status component."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"/** ",n.a.createElement("span",{className:"hljs-doctag"},"@jsx "),"React.DOM */"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Status = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"found"),": React.PropTypes.number.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"max"),": React.PropTypes.number.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"message"),": React.PropTypes.oneOf([",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"choosetile"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"foundmate"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"foundall"'),n.a.createElement("br",null),"    ]).isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render() {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," found = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.found,",n.a.createElement("br",null),"      max = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.max,",n.a.createElement("br",null),"      texts = {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"choosetile"),": ",n.a.createElement("span",{className:"hljs-string"},'"Choose a tile!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"findmate"),": ",n.a.createElement("span",{className:"hljs-string"},'"Now try to find the matching tile!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"wrong"),": ",n.a.createElement("span",{className:"hljs-string"},'"Sorry, those didn\'t match!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"foundmate"),": ",n.a.createElement("span",{className:"hljs-string"},'"Yey, they matched!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"foundall"),": ",n.a.createElement("span",{className:"hljs-string"},'"You\'ve found all "')," + max + ",n.a.createElement("span",{className:"hljs-string"},'" pairs! Well done!"'),n.a.createElement("br",null),"      };",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"        ({found}/{max})",n.a.createElement("span",{className:"hljs-symbol"},"&nbsp;"),n.a.createElement("span",{className:"hljs-symbol"},"&nbsp;"),"{texts[this.props.message]}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Props"),n.a.createElement("th",null,"State"),n.a.createElement("th",null,"Sub components"),n.a.createElement("th",null,"Instance variables"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"found",n.a.createElement("br",null),"max",n.a.createElement("br",null),"message"),n.a.createElement("td",null),n.a.createElement("td",null),n.a.createElement("td",null)))),n.a.createElement("p",null,"The only change is the already discussed extraction of logic deciding whether to show ",n.a.createElement("code",null,"foundall")," or ",n.a.createElement("code",null,"choosetile"),"."),n.a.createElement("p",null,"Note also the neat syntax for defining an enum proptype, used here for the ",n.a.createElement("code",null,"message")," property."),n.a.createElement("p",null,"Performance-wise it would probably be beneficial to move the ",n.a.createElement("code",null,"texts")," variable out of the ",n.a.createElement("code",null,"createClass")," call, to prevent it having to be created everytime ",n.a.createElement("code",null,"render")," is called. As is, though, it hardly matters."),n.a.createElement("h3",{id:"the-state-of-a-tile"},"The state of a tile"),n.a.createElement("p",null,"In the old version, the ",n.a.createElement("code",null,"Tile")," component made use of three state variables; ",n.a.createElement("code",null,"flipped"),", ",n.a.createElement("code",null,"correct")," and ",n.a.createElement("code",null,"wrong"),". This was really bad design on my part, which also made for needlessly complex code. When a tile is flipped, it is either correct or wrong. If wrong, I'll reset flipped to false after 2 seconds."),n.a.createElement("p",null,"A much better design is to bake this into a single tile status variable with the possible values of ",n.a.createElement("code",null,"unturned"),", ",n.a.createElement("code",null,"correct")," and ",n.a.createElement("code",null,"wrong"),"!"),n.a.createElement("p",null,"So why are we discussing the innards of ",n.a.createElement("code",null,"Tile")," while going over changes to ",n.a.createElement("code",null,"Board"),"? Because having refactored everything into that single ",n.a.createElement("code",null,"status")," enum variable, I realised that this value should be passed to ",n.a.createElement("code",null,"Tile")," from ",n.a.createElement("code",null,"Board"),". Before, when they were three different variables, I didn't even see the possibility. Ian did, so his ",n.a.createElement("a",{href:"https://github.com/ianobermiller/reactexperiment/commit/eb99289124a0154edfcd59486afc45e47bfefa77"},"new version of ",n.a.createElement("code",null,"Board"))," contains two state arrays tracking this; ",n.a.createElement("code",null,"wrongIndexes")," and ",n.a.createElement("code",null,"correctIndexes"),"."),n.a.createElement("p",null,"Having baked it all together into an enum variable, my approach was instead to give ",n.a.createElement("code",null,"Board")," a single ",n.a.createElement("code",null,"tilestates")," array containing these values. We initially set them all to ",n.a.createElement("code",null,"unturned"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"getInitialState() {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.map(_.range(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.length),",n.a.createElement("span",{className:"hljs-function"},"()=>"),n.a.createElement("span",{className:"hljs-string"},"'unturned'"),"),",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// the other variables redacted"),n.a.createElement("br",null),"  };",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"When we render the tiles, each tile is passed its status as a property along with the word:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"<Tile word={b} status={",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates[n]} />")),n.a.createElement("p",null,"As the game progresses, we merely need to update the corresponding indexes in ",n.a.createElement("code",null,"tilestates")," in ",n.a.createElement("code",null,"Board"),', and the faux data binding of React\'s "rerender everything" approach will take care of the rest!'),n.a.createElement("h3",{id:"more-underscore-shenanigans"},"More underscore shenanigans"),n.a.createElement("p",null,"Speaking of updating the ",n.a.createElement("code",null,"tilestates")," array, here's a closer look at the code where that is done:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"// revealing a lone tile"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates, _.object([index], [",n.a.createElement("span",{className:"hljs-string"},'"revealed"'),"]))",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"// marking a pair as correct"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"found"),": ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.found + ",n.a.createElement("span",{className:"hljs-number"},"1"),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"foundmate"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"    _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"correct"'),", ",n.a.createElement("span",{className:"hljs-string"},'"correct"'),"])",n.a.createElement("br",null),"  )",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"// marking a pair as wrong"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"message"),": ",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": _.extend(",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"    _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),", ",n.a.createElement("span",{className:"hljs-string"},'"wrong"'),"])",n.a.createElement("br",null),"  )",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"// turning a pair back down"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"message"),":",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.message === ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),n.a.createElement("br",null),"      ? ",n.a.createElement("span",{className:"hljs-string"},'"findmate"'),n.a.createElement("br",null),"      : ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".max === ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.found",n.a.createElement("br",null),"      ? ",n.a.createElement("span",{className:"hljs-string"},'"foundall"'),n.a.createElement("br",null),"      : ",n.a.createElement("span",{className:"hljs-string"},'"choosetile"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"tilestates"),": matched",n.a.createElement("br",null),"    ? ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates",n.a.createElement("br",null),"    : _.extend(",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates,",n.a.createElement("br",null),"        _.object([index, otherindex], [",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),", ",n.a.createElement("span",{className:"hljs-string"},'"unturned"'),"])",n.a.createElement("br",null),"      )",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"_.extend")," call calculating the new ",n.a.createElement("code",null,"tilestates")," array is succinct to the point of arrogance, but I feel it is warranted here. Expressing this functionality as a one-liner makes the code much less verbose, which I argue is worth the heightened cognitive cost of understanding what the hell the line actually does. This is understood contextually, even for those who can't decipher the code."),n.a.createElement("p",null,"There's another reason why I didn't make a helper function containing the same functionality in a more readable way; we should never mutate anything in ",n.a.createElement("code",null,"this.state")," except through calls to ",n.a.createElement("code",null,"this.setState"),". And not mutating an array while we're operating on it over several LOC's isn't feasible. That means we'd have to copy the array, mutate the copy, and then finally pass that to ",n.a.createElement("code",null,"setState"),"."),n.a.createElement("p",null,"Doing it that way would amount to lots of work and lots of LOC's, which I use as an excuse to get away with my arrogant one-liner. I concede that there are probably times when I make this exact argument that I'm in the wrong, but the point remains; wielded with responsibility, the powerful expressiveness of Underscore/Lodash can really help you make the code less bulky."),n.a.createElement("h3",{id:"tile-click-catching-attempt-1---passing-back-instance"},"Tile click catching attempt #1 - passing back instance"),n.a.createElement("p",null,"When a ",n.a.createElement("code",null,"Tile")," is clicked, we need to act on this in ",n.a.createElement("code",null,"Board"),". In my first version, I pass a click handler from ",n.a.createElement("code",null,"Board")," to ",n.a.createElement("code",null,"Tile"),". Inside tile, the tile will then call the handler passing itself as a parameter."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"// old click handler inside `Tile`"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-attr"},"catchClick"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (!",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.flipped){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.clickedTile(",n.a.createElement("span",{className:"hljs-built_in"},"this"),");",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"This way board got access to the instance, and can call the relevant methods on the tile to show or hide it."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-comment"},"// old clickedTile method in Board was passed tile instance and called methods on that"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-attr"},"clickedTile"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"tile"),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (!",n.a.createElement("span",{className:"hljs-built_in"},"this"),".wait){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (!",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedtile){",n.a.createElement("br",null),"      tile.reveal();",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest redacted..."),n.a.createElement("br",null),"    } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".wait = ",n.a.createElement("span",{className:"hljs-literal"},"true"),";",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedtile.props.word === tile.props.word){",n.a.createElement("br",null),"        tile.succeed();",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedtile.succeed();",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest redacted..."),n.a.createElement("br",null),"      } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"        tile.fail();",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".flippedtile.fail();",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest redacted..."),n.a.createElement("br",null),"      }",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// ...rest redacted..."),n.a.createElement("br",null),"    }",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"},")),n.a.createElement("p",null,"This is needlessly complex, and, as Ian pointed out, an antipattern when React structure is concerned. You should never pass a component instance upstream, there's always a better choice."),n.a.createElement("h3",{id:"tile-click-catching-attempt-2---passing-back-index"},"Tile click catching attempt #2 - passing back index"),n.a.createElement("p",null,"After refactoring the tile status to the ",n.a.createElement("code",null,"tilestates")," array in ",n.a.createElement("code",null,"Board"),", it would be enough if we told ",n.a.createElement("code",null,"Board")," the index of the clicked ",n.a.createElement("code",null,"Tile"),". In this version the rendering of the tiles inside the ",n.a.createElement("code",null,"Board")," render method looked like this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"w, n"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Tile"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"clickedTile"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.clickedTile}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"word"),"=",n.a.createElement("span",{className:"hljs-string"},"{w}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"status"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.tilestates[n]}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{n}"),n.a.createElement("br",null),"      />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  });",n.a.createElement("br",null),"}")),n.a.createElement("p",null,"And in ",n.a.createElement("code",null,"Tile"),", the click handler passes the ",n.a.createElement("code",null,"key")," property instead of the instance as in attempt #1."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"catchClick: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.status===",n.a.createElement("span",{className:"hljs-string"},"'unturned'"),"){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.clickedTile(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.key);",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"},")),n.a.createElement("h3",{id:"tile-click-catching-attempt-3---calling-prefilled-callback"},"Tile click catching attempt #3 - calling prefilled callback"),n.a.createElement("p",null,"In attempt #2, we're passing ",n.a.createElement("code",null,"key")," to ",n.a.createElement("code",null,"Tile")," only to have ",n.a.createElement("code",null,"Tile")," pass it right back in the click handler. That seems needlessly clunky. There's no computation done inside ",n.a.createElement("code",null,"Tile")," that ",n.a.createElement("code",null,"Board")," is interested in, we're just getting back stuff we already know."),n.a.createElement("p",null,"But we have to pass a callback to ",n.a.createElement("code",null,"Tile"),", and we have to know the index of the clicked tile. That gave me the idea for attempt #3 - how about, instead of passing ",n.a.createElement("code",null,"clickedTile"),", we pass a function wich calls ",n.a.createElement("code",null,"clickedTile")," with the correct index? Here's the new render loop doing that, using ",n.a.createElement("code",null,"_.partial")," to create the callback:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"{",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.map(",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"w,n"),")"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Tile")," ",n.a.createElement("span",{className:"hljs-attr"},"clickedTile"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(this.clickedTile,n))}")," ",n.a.createElement("span",{className:"hljs-attr"},"word"),"=",n.a.createElement("span",{className:"hljs-string"},"{w}")," ",n.a.createElement("span",{className:"hljs-attr"},"status"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.state.tilestates[n]}")," ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{n}/"),">")),");",n.a.createElement("br",null),"  }",n.a.createElement("br",null),")}")),n.a.createElement("p",null,"And here's the new ",n.a.createElement("code",null,"catchClick")," in ",n.a.createElement("code",null,"Tile"),", which now just calls the callback:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"catchClick: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.status===",n.a.createElement("span",{className:"hljs-string"},"'unturned'"),"){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.clickedTile();",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"},")),n.a.createElement("h3",{id:"tile-click-catching-attempt-4---moving-the-unturned-check-up-to-board"},"Tile click catching attempt #4 - moving the ",n.a.createElement("code",null,"unturned")," check up to ",n.a.createElement("code",null,"Board")),n.a.createElement("p",null,"Having the check to prevent clicking turned tiles inside ",n.a.createElement("code",null,"Tile")," didn't really sit right with me. All other computations regarding the ",n.a.createElement("code",null,"status")," of a tile is right there in ",n.a.createElement("code",null,"Board"),"'s ",n.a.createElement("code",null,"clickedTile")," method. I therefore moved the check here:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"clickedTile(index){",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state.tilestates[index]===",n.a.createElement("span",{className:"hljs-string"},"'unturned'"),"){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// ...redacted ..."),n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}")),n.a.createElement("p",null,"The click handler inside ",n.a.createElement("code",null,"Tile")," is now reduced to this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"catchClick: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.clickedTile();",n.a.createElement("br",null),"},")),n.a.createElement("h3",{id:"tile-click-catching-final-version---catching-click-in-board"},"Tile click catching final version - catching click in Board"),n.a.createElement("p",null,"It's getting cleaner, but even this sleek version felt weird. Why bother catching the click event inside ",n.a.createElement("code",null,"Tile")," at all? There's absolutely no computations going on, and we're not passing anything back. Why not simply catch the clicks in Board?"),n.a.createElement("p",null,"I decided to try this, wrapping all tiles in a div which container the click handler. Here's the final version of the render loop:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"{",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.words.map(",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-function"},"(",n.a.createElement("span",{className:"hljs-params"},"b,n"),") =>")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (<div onClick={_.partial(this.clickedTile,n)}>",n.a.createElement("br",null),"      <Tile word={b} status={this.state.tilestates[n]} />",n.a.createElement("br",null),"    <div>)",n.a.createElement("br",null),"  }",n.a.createElement("br",null),")}")),n.a.createElement("p",null,"There's an added cost in form of the wrapping div tags, but the upside is that ",n.a.createElement("code",null,"Tile")," no longer contains a click handler at all."),n.a.createElement("p",null,"Whether this final version is actually cleaner than attempt #4 is definitely debatable. As ",n.a.createElement("code",null,"clickedTile")," is already very complex, you could even argue that attempt #3, where the ",n.a.createElement("code",null,"unturned")," check lives in the Tile click handler, is the ideal solution."),n.a.createElement("p",null,"Having the click handler inside Tile also lets you put it on the clickable side. Here's the ",n.a.createElement("code",null,"render")," code for ",n.a.createElement("code",null,"Tile")," before this final version:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"render(){",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"    <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className={",n.a.createElement("span",{className:"hljs-string"},"'brick '"),"+",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props.status}>",n.a.createElement("br",null),"      <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className=",n.a.createElement("span",{className:"hljs-string"},'"front"')," onClick={",n.a.createElement("span",{className:"hljs-keyword"},"this"),".catchClick}>?</",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"      <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className=",n.a.createElement("span",{className:"hljs-string"},'"back"'),">{",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props.word}</",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"    </",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"  );",n.a.createElement("br",null),"}")),n.a.createElement("p",null,'However, the value of the "correct" placement of the click handler is limited - since we\'re animating the flipping of tiles, we still need to check the status of a clicked tile, as it would otherwise be possible to do a quick doubleclick on a tile and match it to itself.'),n.a.createElement("h3",{id:"the-new-tile-component-code"},"The new Tile component code"),n.a.createElement("p",null,"Finally, here's what's left of the now pitiful Tile component:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-comment"},"/** @jsx React.DOM */"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Tile = React.createClass({",n.a.createElement("br",null),"  propTypes: {",n.a.createElement("br",null),"    status: React.PropTypes.",n.a.createElement("span",{className:"hljs-built_in"},"string"),".isRequired,",n.a.createElement("br",null),"    word: React.PropTypes.",n.a.createElement("span",{className:"hljs-built_in"},"string"),".isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render(){",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className={",n.a.createElement("span",{className:"hljs-string"},"'brick '"),"+this.props.status}>",n.a.createElement("br",null),"        <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className=",n.a.createElement("span",{className:"hljs-string"},"'front'"),">?</",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"        <",n.a.createElement("span",{className:"hljs-keyword"},"div")," className=",n.a.createElement("span",{className:"hljs-string"},"'back'"),">{this.props.word}</",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"      </",n.a.createElement("span",{className:"hljs-keyword"},"div"),">",n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("table",null,n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Props"),n.a.createElement("th",null,"State"),n.a.createElement("th",null,"Sub components"),n.a.createElement("th",null,"Instance variables"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"word",n.a.createElement("br",null),n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"clickedTile()"),n.a.createElement("br",null),n.a.createElement("span",{style:{color:"green"}},"**status**")),n.a.createElement("td",null,n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"flipped"),n.a.createElement("br",null),n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"wrong"),n.a.createElement("br",null),n.a.createElement("span",{style:{color:"red",textDecoration:"line-through"}},"correct")),n.a.createElement("td",null),n.a.createElement("td",null)))),n.a.createElement("p",null,"Because of my ",n.a.createElement("code",null,"status")," refactoring I no longer need the css class shenanigans of the previous version, I merely add the value of ",n.a.createElement("code",null,"this.props.status")," as a class. But if I had kept the previous approach of separate flag variables, I would be better of using the ",n.a.createElement("a",{href:"http://facebook.github.io/react/docs/class-name-manipulation.html"},"classSet")," addon. See ",n.a.createElement("a",{href:"https://github.com/ianobermiller/reactexperiment/commit/072431f2d81dd37ff8c30d5eecb6b338f1244a91"},"Ian's version")," for what that might look like."),n.a.createElement("h3",{id:"wrapping-up-again"},"Wrapping up (again)"),n.a.createElement("p",null,"Diving back down, and diving this deep into sometimes trivial details, was again a powerful learning experience for me! I am hugely grateful to Ian for supplying his fork, which really helped me propelling my understanding along."),n.a.createElement("p",null,"I hope you poor souls who survived through all these ramblings also managed to get something out of it!"),n.a.createElement("p",null,"And again, the main takeaway for me was: React is really, really powerful stuff. Absolutely loving it, and can't wait to explore the flux architecture and routing solutions!")),n.a.createElement("hr",null))}},xzrJ:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/a-react-js-case-study-follow-up",function(){var e=t("dTGZ");return{page:e.default||e}}])}},[["xzrJ",1,0]]]);