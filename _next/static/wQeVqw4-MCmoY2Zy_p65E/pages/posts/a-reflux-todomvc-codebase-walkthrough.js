(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"+N59":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/a-reflux-todomvc-codebase-walkthrough",function(){var e=t("2+LP");return{page:e.default||e}}])},"2+LP":function(e,a,t){"use strict";t.r(a);var l=t("q1tI"),s=t.n(l),n=t("JRaF"),r=t("YFqc"),c=t.n(r),m={url:"a-reflux-todomvc-codebase-walkthrough",id:"refluxtodo",title:"A Reflux TodoMVC codebase walkthrough",author:"david",tags:["react","reflux","case study","todomvc"],date:"2014-11-19",excerpt:"A closer look at the code and data flow in the Reflux TodoMVC implementation",type:"post",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2014-11-19_refluxtodo",hasStaticContent:!0,headlines:[{level:3,text:"The TodoMVC project",id:"the-todomvc-project"},{level:3,text:"The Reflux version",id:"the-reflux-version"},{level:3,text:"The Reflux data flow model",id:"the-reflux-data-flow-model"},{level:3,text:"Ready, set...",id:"ready-set"},{level:3,text:"The Store story",id:"the-store-story"},{level:3,text:"A component overview",id:"a-component-overview"},{level:3,text:"The React router root",id:"the-react-router-root"},{level:3,text:"The TodoApp component",id:"the-todoapp-component"},{level:3,text:"The TodoHeader component",id:"the-todoheader-component"},{level:3,text:"The TodoFooter component",id:"the-todofooter-component"},{level:3,text:"The TodoMain component",id:"the-todomain-component"},{level:3,text:"The TodoItem component",id:"the-todoitem-component"},{level:3,text:"Comparing to Flux",id:"comparing-to-flux"},{level:3,text:"Wrapping up",id:"wrapping-up"}]};a.default=function(){return s.a.createElement(n.a,{kind:"post",data:m,title:"A Reflux TodoMVC codebase walkthrough",summary:"A closer look at the code and data flow in the Reflux TodoMVC implementation",headlines:[{level:3,text:"The TodoMVC project",id:"the-todomvc-project"},{level:3,text:"The Reflux version",id:"the-reflux-version"},{level:3,text:"The Reflux data flow model",id:"the-reflux-data-flow-model"},{level:3,text:"Ready, set...",id:"ready-set"},{level:3,text:"The Store story",id:"the-store-story"},{level:3,text:"A component overview",id:"a-component-overview"},{level:3,text:"The React router root",id:"the-react-router-root"},{level:3,text:"The TodoApp component",id:"the-todoapp-component"},{level:3,text:"The TodoHeader component",id:"the-todoheader-component"},{level:3,text:"The TodoFooter component",id:"the-todofooter-component"},{level:3,text:"The TodoMain component",id:"the-todomain-component"},{level:3,text:"The TodoItem component",id:"the-todoitem-component"},{level:3,text:"Comparing to Flux",id:"comparing-to-flux"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["react","reflux","case study","todomvc"]},s.a.createElement("div",{className:"post","data-postid":"refluxtodo"},s.a.createElement("h3",{id:"the-todomvc-project"},"The TodoMVC project"),s.a.createElement("p",null,"Very likely you're already familiar with ",s.a.createElement("a",{href:"http://todomvc.com/"},"TodoMVC"),", ",s.a.createElement("a",{href:"http://addyosmani.com/"},"Addy Osmani"),"'s project to help comparing JavaScript frameworks. The idea is to code the exact same app in the different frameworks, and since we know the app, it's easier to get an understanding for the framework that was used in the particular code version you're looking at."),s.a.createElement("p",null,"For this to work the app itself has to be very simple, and it is:"),s.a.createElement("p",null,s.a.createElement("img",{src:"/static/posts/a-reflux-todomvc-codebase-walkthrough/img/refluxtodoapp.png",alt:"Reflux TodoMVC app"})),s.a.createElement("p",null,"There is full CRUD for todo items, and some aggregation such as toggling all, clearing all finished items and filtering."),s.a.createElement("p",null,"In spite of being simple, however, it turns out that it is still complex enough to enable building an understanding for what the framework in question takes like. Addy made an excellent job to hit that sweet spot, which is most likely the secret behind the popularity of the project."),s.a.createElement("h3",{id:"the-reflux-version"},"The Reflux version"),s.a.createElement("p",null,"To help curious window shoppers check out ",s.a.createElement("a",{href:"https://github.com/spoike/refluxjs"},"Reflux"),", creator ",s.a.createElement("a",{href:"http://spoike.ghost.io/"},"Mikael Brassman")," made a ",s.a.createElement("a",{href:"https://github.com/spoike/refluxjs-todo"},"TodoMVC version")," using Reflux, ",s.a.createElement("a",{href:"http://facebook.github.io/react/"},"React")," and ",s.a.createElement("a",{href:"https://github.com/rackt/react-router"},"react-router"),"."),s.a.createElement("p",null,"This post will walk through the code, although I'll use ",s.a.createElement("a",{href:"https://github.com/krawaller/refluxjs-todo"},"my own fork")," which has some modifications which at the time of writing haven't been merged into the official repo."),s.a.createElement("h3",{id:"the-reflux-data-flow-model"},"The Reflux data flow model"),s.a.createElement("p",null,"As detailed in our ",s.a.createElement("a",{href:"https://blog.krawaller.se/posts/the-reflux-data-flow-model/"},"post on the Reflux data flow model"),", Reflux takes a global pubsub approach but negates the bad parts of that by having lots of parallell channel who all transmit just one kind of event."),s.a.createElement("p",null,"We used this pucture to illustrate the model:"),s.a.createElement("p",null,s.a.createElement("img",{src:"/static/posts/a-reflux-todomvc-codebase-walkthrough/img/refluxflow2.jpeg",alt:"Reflux data flow"})),s.a.createElement("p",null,"As we will find, this model holds true for the TodoMVC app as well (apart from it not having a separate database)."),s.a.createElement("h3",{id:"ready-set"},"Ready, set..."),s.a.createElement("p",null,"First off - the actions. Since they are in essence a list of all available events in the app, and also serve as the glue between the Store and the components, the action definition is very central to the app. For the TodoMVC app they are located in ",s.a.createElement("code",null,"src/actions.js")," and look like this:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoActions = Reflux.createActions([",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"toggleItem"'),",",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"toggleAllItems"'),",",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"addItem"'),",",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"removeItem"'),",",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"clearCompleted"'),",",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-string"},'"editItem"'),s.a.createElement("br",null),"]);")),s.a.createElement("h3",{id:"the-store-story"},"The Store story"),s.a.createElement("p",null,"A central Store is listening to the actions and will update the todo data. Often by communicating with some kind of database API, as shown in the picture above, but in the Reflux TodoMVC app the Store merely uses localStorage."),s.a.createElement("p",null,"Each store should just be concerned with one kind of data, so a larger app commonly consists of many stores. TodoMVC however only deals with todo items, and thus it only contains the one store. Here's the code for that store, located in ",s.a.createElement("code",null,"src/store.js"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// some variables and helpers for our fake database stuff"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," todoCounter = ",s.a.createElement("span",{className:"hljs-number"},"0"),",",s.a.createElement("br",null),"    localStorageKey = ",s.a.createElement("span",{className:"hljs-string"},'"todos"'),";",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function")," ",s.a.createElement("span",{className:"hljs-title"},"getItemByKey"),"(",s.a.createElement("span",{className:"hljs-params"},"list,itemKey"),")"),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," _.find(list, ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," item.key === itemKey;",s.a.createElement("br",null),"    });",s.a.createElement("br",null),"}",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," todoListStore = Reflux.createStore({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// this will set up listeners to all publishers in TodoActions, using onKeyname (or keyname) as callbacks"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"listenables"),": [TodoActions],",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onEditItem"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"itemKey, newLabel"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," foundItem = getItemByKey(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list,itemKey);",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (!foundItem) {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"return"),";",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"        foundItem.label = newLabel;",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list);",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onAddItem"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"label"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList([{",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"key"),": todoCounter++,",s.a.createElement("br",null),"            created: ",s.a.createElement("span",{className:"hljs-keyword"},"new")," ",s.a.createElement("span",{className:"hljs-built_in"},"Date"),"(),",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"isComplete"),": ",s.a.createElement("span",{className:"hljs-literal"},"false"),",",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"label"),": label",s.a.createElement("br",null),"        }].concat(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onRemoveItem"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"itemKey"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList(_.filter(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list,",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),")"),"{",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"return")," item.key!==itemKey;",s.a.createElement("br",null),"        }));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onToggleItem"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"itemKey"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," foundItem = getItemByKey(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list,itemKey);",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (foundItem) {",s.a.createElement("br",null),"            foundItem.isComplete = !foundItem.isComplete;",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list);",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onToggleAllItems"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"checked"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList(_.map(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list, ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),") "),"{",s.a.createElement("br",null),"            item.isComplete = checked;",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"return")," item;",s.a.createElement("br",null),"        }));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"onClearCompleted"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".updateList(_.filter(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list, ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),") "),"{",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"return")," !item.isComplete;",s.a.createElement("br",null),"        }));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// called whenever we change a list. normally this would mean a database API call"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"updateList"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"list"),")"),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"localStorage"),".setItem(localStorageKey, ",s.a.createElement("span",{className:"hljs-built_in"},"JSON"),".stringify(list));",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// if we used a real database, we would likely do the below in a callback"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list = list;",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".trigger(list); ",s.a.createElement("span",{className:"hljs-comment"},"// sends the updated list to all listening components (TodoApp)"),s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// this will be called by all listening components as they register their listeners"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"getDefaultData"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," loadedList = ",s.a.createElement("span",{className:"hljs-built_in"},"localStorage"),".getItem(localStorageKey);",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (!loadedList) {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-comment"},"// If no list is in localstorage, start out with a default one"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list = [{",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-attr"},"key"),": todoCounter++,",s.a.createElement("br",null),"                created: ",s.a.createElement("span",{className:"hljs-keyword"},"new")," ",s.a.createElement("span",{className:"hljs-built_in"},"Date"),"(),",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-attr"},"isComplete"),": ",s.a.createElement("span",{className:"hljs-literal"},"false"),",",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-attr"},"label"),": ",s.a.createElement("span",{className:"hljs-string"},"'Rule the web'"),s.a.createElement("br",null),"            }];",s.a.createElement("br",null),"        } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list = _.map(",s.a.createElement("span",{className:"hljs-built_in"},"JSON"),".parse(loadedList), ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),") "),"{",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-comment"},"// just resetting the key property for each todo item"),s.a.createElement("br",null),"                item.key = todoCounter++;",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-keyword"},"return")," item;",s.a.createElement("br",null),"            });",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".list;",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});",s.a.createElement("br",null))),s.a.createElement("p",null,"Quite a mouthful, but if you bear with it the structure is rather clear! Each action is caught in a callback which changes the data and calls ",s.a.createElement("code",null,"updateList"),", which in turn stores the new data and ",s.a.createElement("code",null,"triggers")," it to all listeners."),s.a.createElement("p",null,"The initial load from localStorage is done in ",s.a.createElement("code",null,"getDefaultData"),", which is what all listeners is initially seeded with when they first register their interest."),s.a.createElement("h3",{id:"a-component-overview"},"A component overview"),s.a.createElement("p",null,"Before we dive into the individual components, here's a high-level look at how they are related, and where the various action calls are located:"),s.a.createElement("p",null,s.a.createElement("img",{src:"/static/posts/a-reflux-todomvc-codebase-walkthrough/img/refluxtodocomps.png",alt:"Reflux TodoMVC components"})),s.a.createElement("p",null,"As you can see the app is made up from 5 different components, all defined in ",s.a.createElement("code",null,"src/components.jsx.js"),"."),s.a.createElement("h3",{id:"the-react-router-root"},"The React router root"),s.a.createElement("p",null,"However, the app doesn't start with ",s.a.createElement("code",null,"TodoApp"),", but with a router definition using ",s.a.createElement("code",null,"ReactRouter"),"! This is used to handle the different routes that the app is supposed to contain; the root (showing all todos), ",s.a.createElement("code",null,"completed")," showing only completed todos, and ",s.a.createElement("code",null,"active")," showing only those who haven't been completed."),s.a.createElement("p",null,"Here's the code, located at the bottom of ",s.a.createElement("code",null,"src/components.jsx.js"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," routes = (",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Route")," ",s.a.createElement("span",{className:"hljs-attr"},"handler"),"=",s.a.createElement("span",{className:"hljs-string"},"{TodoApp}"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Route")," ",s.a.createElement("span",{className:"hljs-attr"},"name"),"=",s.a.createElement("span",{className:"hljs-string"},'"All"')," ",s.a.createElement("span",{className:"hljs-attr"},"path"),"=",s.a.createElement("span",{className:"hljs-string"},'"/"')," ",s.a.createElement("span",{className:"hljs-attr"},"handler"),"=",s.a.createElement("span",{className:"hljs-string"},"{TodoMain}")," />"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Route")," ",s.a.createElement("span",{className:"hljs-attr"},"name"),"=",s.a.createElement("span",{className:"hljs-string"},'"Completed"')," ",s.a.createElement("span",{className:"hljs-attr"},"path"),"=",s.a.createElement("span",{className:"hljs-string"},'"/completed"')," ",s.a.createElement("span",{className:"hljs-attr"},"handler"),"=",s.a.createElement("span",{className:"hljs-string"},"{TodoMain}")," />"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Route")," ",s.a.createElement("span",{className:"hljs-attr"},"name"),"=",s.a.createElement("span",{className:"hljs-string"},'"Active"')," ",s.a.createElement("span",{className:"hljs-attr"},"path"),"=",s.a.createElement("span",{className:"hljs-string"},'"/active"')," ",s.a.createElement("span",{className:"hljs-attr"},"handler"),"=",s.a.createElement("span",{className:"hljs-string"},"{TodoMain}")," />"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Route"),">")),s.a.createElement("br",null),");",s.a.createElement("br",null),s.a.createElement("br",null),"ReactRouter.run(routes, ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"Handler"),") "),"{",s.a.createElement("br",null),"    React.render(",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Handler"),"/>")),", ",s.a.createElement("span",{className:"hljs-built_in"},"document"),".getElementById(",s.a.createElement("span",{className:"hljs-string"},"'todoapp'"),"));",s.a.createElement("br",null),"});")),s.a.createElement("p",null,"All three routes actually render the same component (",s.a.createElement("code",null,"TodoMain")," inside ",s.a.createElement("code",null,"TodoApp"),"), but it will act differently depending on the path."),s.a.createElement("h3",{id:"the-todoapp-component"},"The TodoApp component"),s.a.createElement("p",null,"Finally we get to the actual React components! First off ",s.a.createElement("code",null,"TodoApp"),", which is used as a wrapper for all routes:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// Renders the full application"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// RouteHandler will always be TodoMain, but with different 'showing' prop (all/completed/active)"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoApp = React.createClass({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// this will cause setState({list:updatedlist}) whenever the store does trigger(updatedlist)"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"mixins"),": [Reflux.connect(todoListStore,",s.a.createElement("span",{className:"hljs-string"},'"list"'),")],",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"list"),": []",s.a.createElement("br",null),"        };",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"TodoHeader")," />"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.RouteHandler")," ",s.a.createElement("span",{className:"hljs-attr"},"list"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.state.list}")," />"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"TodoFooter")," ",s.a.createElement("span",{className:"hljs-attr"},"list"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.state.list}")," />"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});")),s.a.createElement("p",null,"Note that ",s.a.createElement("code",null,"TodoApp")," is listening to ",s.a.createElement("code",null,"todoListStore"),". That means it will update its state with whatever ",s.a.createElement("code",null,"todoListStore")," triggers, which will cause a rerender."),s.a.createElement("p",null,"Apart from that there isn't much going on - ",s.a.createElement("code",null,"TodoApp")," has no user interaction, but merely renders ",s.a.createElement("code",null,"TodoHeader"),", ",s.a.createElement("code",null,"TodoMain")," and ",s.a.createElement("code",null,"TodoFooter"),", passing ",s.a.createElement("code",null,"this.state.list")," along as a property."),s.a.createElement("h3",{id:"the-todoheader-component"},"The TodoHeader component"),s.a.createElement("p",null,"This component renders the top part of the app, including the form which creates new todo items by calling the ",s.a.createElement("code",null,"addItem")," action."),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// Renders the headline and the form for creating new todos."),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// Used in TodoApp"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// Observe that the toogleall button is NOT rendered here, but in TodoMain (it is then moved up to the header with CSS)"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoHeader = React.createClass({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleValueChange"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"evt"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," text = evt.target.value;",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (evt.which === ",s.a.createElement("span",{className:"hljs-number"},"13")," && text) { ",s.a.createElement("span",{className:"hljs-comment"},"// hit enter, create new item if field isn't empty"),s.a.createElement("br",null),"            TodoActions.addItem(text);",s.a.createElement("br",null),"            evt.target.value = ",s.a.createElement("span",{className:"hljs-string"},"''"),";",s.a.createElement("br",null),"        } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (evt.which === ",s.a.createElement("span",{className:"hljs-number"},"27"),") { ",s.a.createElement("span",{className:"hljs-comment"},"// hit escape, clear without creating"),s.a.createElement("br",null),"            evt.target.value = ",s.a.createElement("span",{className:"hljs-string"},"''"),";",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"header")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"header"'),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"h1"),">"),"todos",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"h1"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"input")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"new-todo"')," ",s.a.createElement("span",{className:"hljs-attr"},"placeholder"),"=",s.a.createElement("span",{className:"hljs-string"},'"What needs to be done?"')," ",s.a.createElement("span",{className:"hljs-attr"},"autoFocus")," ",s.a.createElement("span",{className:"hljs-attr"},"onKeyUp"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleValueChange}/"),">"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"header"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});")),s.a.createElement("p",null,"Note that the toggleall button, although physically located in the header, is actually defined in ",s.a.createElement("code",null,"TodoMain"),", and then moved through CSS."),s.a.createElement("p",null,"The reason I suspect is that this way ",s.a.createElement("code",null,"TodoHeader")," doesn't need the todo data at all. Also, if we have no todos at all ",s.a.createElement("code",null,"TodoMain")," should be hidden as well as the toggleall button, so by making the toggleall button part of ",s.a.createElement("code",null,"TodoMain")," we don't have to duplicate any hiding logic here."),s.a.createElement("h3",{id:"the-todofooter-component"},"The TodoFooter component"),s.a.createElement("p",null,"The ",s.a.createElement("code",null,"TodoFooter")," component shows aggregation information and controls, as well as the navigation bar."),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// Renders the bottom item count, navigation bar and clearallcompleted button"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// Used in TodoApp"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoFooter = React.createClass({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"list"),": React.PropTypes.arrayOf(React.PropTypes.object).isRequired,",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," nbrcompleted = _.filter(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list, ",s.a.createElement("span",{className:"hljs-string"},'"isComplete"'),").length,",s.a.createElement("br",null),"            nbrtotal = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list.length,",s.a.createElement("br",null),"            nbrincomplete = nbrtotal-nbrcompleted,",s.a.createElement("br",null),"            clearButtonClass = React.addons.classSet({",s.a.createElement("span",{className:"hljs-attr"},"hidden"),": nbrcompleted < ",s.a.createElement("span",{className:"hljs-number"},"1"),"}),",s.a.createElement("br",null),"            footerClass = React.addons.classSet({",s.a.createElement("span",{className:"hljs-attr"},"hidden"),": !nbrtotal }),",s.a.createElement("br",null),"            completedLabel = ",s.a.createElement("span",{className:"hljs-string"},'"Clear completed ("')," + nbrcompleted + ",s.a.createElement("span",{className:"hljs-string"},'")"'),",",s.a.createElement("br",null),"            itemsLeftLabel = nbrincomplete === ",s.a.createElement("span",{className:"hljs-number"},"1")," ? ",s.a.createElement("span",{className:"hljs-string"},'" item left"')," : ",s.a.createElement("span",{className:"hljs-string"},'" items left"'),";",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"footer")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"footer"')," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},"{footerClass}"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"span")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"todo-count"'),">"),s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),"{nbrincomplete}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),"{itemsLeftLabel}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"span"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ul")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"filters"'),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link")," ",s.a.createElement("span",{className:"hljs-attr"},"activeClassName"),"=",s.a.createElement("span",{className:"hljs-string"},'"selected"')," ",s.a.createElement("span",{className:"hljs-attr"},"to"),"=",s.a.createElement("span",{className:"hljs-string"},'"All"'),">"),"All",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link")," ",s.a.createElement("span",{className:"hljs-attr"},"activeClassName"),"=",s.a.createElement("span",{className:"hljs-string"},'"selected"')," ",s.a.createElement("span",{className:"hljs-attr"},"to"),"=",s.a.createElement("span",{className:"hljs-string"},'"Active"'),">"),"Active",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link")," ",s.a.createElement("span",{className:"hljs-attr"},"activeClassName"),"=",s.a.createElement("span",{className:"hljs-string"},'"selected"')," ",s.a.createElement("span",{className:"hljs-attr"},"to"),"=",s.a.createElement("span",{className:"hljs-string"},'"Completed"'),">"),"Completed",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ReactRouter.Link"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"li"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ul"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"button")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"clear-completed"')," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},"{clearButtonClass}")," ",s.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{TodoActions.clearCompleted}"),">"),"{completedLabel}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"button"),">"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"footer"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});")),s.a.createElement("h3",{id:"the-todomain-component"},"The TodoMain component"),s.a.createElement("p",null,"Now finally for the ",s.a.createElement("code",null,"TodoMain")," component. It renders the previously mentioned toggleall button which is moved through CSS to the header, and also the list of todo items. "),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// Renders the todo list as well as the toggle all button"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// Used in TodoApp"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoMain = React.createClass({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"mixins"),": [ ReactRouter.State ],",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"list"),": React.PropTypes.arrayOf(React.PropTypes.object).isRequired,",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"toggleAll"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"evt"),") "),"{",s.a.createElement("br",null),"        TodoActions.toggleAllItems(evt.target.checked);",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," filteredList;",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"switch"),"(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".getPath()){",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"case")," ",s.a.createElement("span",{className:"hljs-string"},"'/completed'"),":",s.a.createElement("br",null),"                filteredList = _.filter(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list,",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),")"),"{ ",s.a.createElement("span",{className:"hljs-keyword"},"return")," item.isComplete; });",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-keyword"},"break"),";",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"case")," ",s.a.createElement("span",{className:"hljs-string"},"'/active'"),":",s.a.createElement("br",null),"                filteredList = _.filter(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list,",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"item"),")"),"{ ",s.a.createElement("span",{className:"hljs-keyword"},"return")," !item.isComplete; });",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-keyword"},"break"),";",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-keyword"},"default"),":",s.a.createElement("br",null),"                filteredList = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list;",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," classes = React.addons.classSet({",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-string"},'"hidden"'),": ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.list.length < ",s.a.createElement("span",{className:"hljs-number"},"1"),s.a.createElement("br",null),"        });",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"section")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"main"')," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},"{classes}"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"input")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"toggle-all"')," ",s.a.createElement("span",{className:"hljs-attr"},"type"),"=",s.a.createElement("span",{className:"hljs-string"},'"checkbox"')," ",s.a.createElement("span",{className:"hljs-attr"},"onChange"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.toggleAll}")," />"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"label")," ",s.a.createElement("span",{className:"hljs-attr"},"htmlFor"),"=",s.a.createElement("span",{className:"hljs-string"},'"toggle-all"'),">"),"Mark all as complete",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"label"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ul")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},'"todo-list"'),">"),s.a.createElement("br",null),"                    { filteredList.map(function(item){",s.a.createElement("br",null),"                        return ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"TodoItem")," ",s.a.createElement("span",{className:"hljs-attr"},"label"),"=",s.a.createElement("span",{className:"hljs-string"},"{item.label}")," ",s.a.createElement("span",{className:"hljs-attr"},"isComplete"),"=",s.a.createElement("span",{className:"hljs-string"},"{item.isComplete}")," ",s.a.createElement("span",{className:"hljs-attr"},"id"),"=",s.a.createElement("span",{className:"hljs-string"},"{item.key}")," ",s.a.createElement("span",{className:"hljs-attr"},"key"),"=",s.a.createElement("span",{className:"hljs-string"},"{item.key}/"),">"),";",s.a.createElement("br",null),"                    })}",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ul"),">"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"section"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});")),s.a.createElement("p",null,"Clicking the toggleall button will cause a call to the ",s.a.createElement("code",null,"toggleAllItems")," action."),s.a.createElement("h3",{id:"the-todoitem-component"},"The TodoItem component"),s.a.createElement("p",null,"The final piece of the puzzle is ",s.a.createElement("code",null,"TodoItem"),", responsible for displaying a single item in the list. It contains lots of user interactions; ",s.a.createElement("code",null,"toggleItem"),", ",s.a.createElement("code",null,"editItem")," and ",s.a.createElement("code",null,"removeItem"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-comment"},"// Renders a single Todo item in the list"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// Used in TodoMain"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," TodoItem = React.createClass({",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"label"),": React.PropTypes.string.isRequired,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"isComplete"),": React.PropTypes.bool.isRequired,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"id"),": React.PropTypes.number",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"mixins"),": [React.addons.LinkedStateMixin], ",s.a.createElement("span",{className:"hljs-comment"},"// exposes this.linkState used in render"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," {};",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleToggle"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"evt"),") "),"{",s.a.createElement("br",null),"        TodoActions.toggleItem(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.id);",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleEditStart"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"evt"),") "),"{",s.a.createElement("br",null),"        evt.preventDefault();",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// because of linkState call in render, field will get value from this.state.editValue"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"isEditing"),": ",s.a.createElement("span",{className:"hljs-literal"},"true"),",",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-attr"},"editValue"),": ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.label",s.a.createElement("br",null),"        }, ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".refs.editInput.getDOMNode().focus();",s.a.createElement("br",null),"        });",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleValueChange"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"evt"),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," text = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".state.editValue; ",s.a.createElement("span",{className:"hljs-comment"},"// because of the linkState call in render, this is the contents of the field"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// we pressed enter, if text isn't empty we blur the field which will cause a save"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (evt.which === ",s.a.createElement("span",{className:"hljs-number"},"13")," && text) {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".refs.editInput.getDOMNode().blur();",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// pressed escape. set editing to false before blurring so we won't save"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"else")," ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (evt.which === ",s.a.createElement("span",{className:"hljs-number"},"27"),") {",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",s.a.createElement("span",{className:"hljs-attr"},"isEditing"),": ",s.a.createElement("span",{className:"hljs-literal"},"false")," },",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),")"),"{",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".refs.editInput.getDOMNode().blur();",s.a.createElement("br",null),"            });",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleBlur"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," text = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".state.editValue; ",s.a.createElement("span",{className:"hljs-comment"},"// because of the linkState call in render, this is the contents of the field"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// unless we're not editing (escape was pressed) or text is empty, save!"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (",s.a.createElement("span",{className:"hljs-built_in"},"this"),".state.isEditing && text) {",s.a.createElement("br",null),"            TodoActions.editItem(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.id, text);",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// whatever the outcome, if we left the field we're not editing anymore"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",s.a.createElement("span",{className:"hljs-attr"},"isEditing"),":",s.a.createElement("span",{className:"hljs-literal"},"false"),"});",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"handleDestroy"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        TodoActions.removeItem(",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.id);",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"var")," classes = React.addons.classSet({",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-string"},"'completed'"),": ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.isComplete,",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-string"},"'editing'"),": ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".state.isEditing",s.a.createElement("br",null),"        });",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"li")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},"{classes}"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"view"'),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"input")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"toggle"')," ",s.a.createElement("span",{className:"hljs-attr"},"type"),"=",s.a.createElement("span",{className:"hljs-string"},'"checkbox"')," ",s.a.createElement("span",{className:"hljs-attr"},"checked"),"=",s.a.createElement("span",{className:"hljs-string"},"{!!this.props.isComplete}")," ",s.a.createElement("span",{className:"hljs-attr"},"onChange"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleToggle}")," />"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"label")," ",s.a.createElement("span",{className:"hljs-attr"},"onDoubleClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleEditStart}"),">"),"{this.props.label}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"label"),">"),s.a.createElement("br",null),"                    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"button")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"destroy"')," ",s.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleDestroy}"),">"),s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"button"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">"),s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"input")," ",s.a.createElement("span",{className:"hljs-attr"},"ref"),"=",s.a.createElement("span",{className:"hljs-string"},'"editInput"')," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"edit"')," ",s.a.createElement("span",{className:"hljs-attr"},"valueLink"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.linkState("),"'",s.a.createElement("span",{className:"hljs-attr"},"editValue"),"')} ",s.a.createElement("span",{className:"hljs-attr"},"onKeyUp"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleValueChange}")," ",s.a.createElement("span",{className:"hljs-attr"},"onBlur"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.handleBlur}")," />"),s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"li"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"});")),s.a.createElement("p",null,"Note how Mikael cleverly keeps the value of the input field as state, and then acts with that state when the field is blurred. If the user pressed escape or the input is empty then nothing happens, otherwise a call to ",s.a.createElement("code",null,"editItem")," is made."),s.a.createElement("h3",{id:"comparing-to-flux"},"Comparing to Flux"),s.a.createElement("p",null,"Now that you've come to know what the Reflux solution to the TodoMVC problem looks like, take a look at the ",s.a.createElement("a",{href:"http://facebook.github.io/flux/docs/todo-list.html"},"Flux version"),". You'll find that even though it has the same React advantage, the code base is much more opaque."),s.a.createElement("p",null,"We've also done a more direct ",s.a.createElement(c.a,{href:"/posts/react-js-architecture-flux-vs-reflux",prefetch:!0},s.a.createElement("a",null,"comparison between Flux and Reflux"))," here on this blog, should you need more convincing."),s.a.createElement("h3",{id:"wrapping-up"},"Wrapping up"),s.a.createElement("p",null,"I hope the Reflux TodoMVC app and this walkthrough showcased the strengths of the Reflux approach. I've really come to love React, but it was only when I paired it with Reflux - and ReactRouter and Firebase - that things took off for real."),s.a.createElement("p",null,"Intellectually I realise that I'm probably just infatuated as usual by the latest shiny toy, but I'll say it anyway: I can see myself working on this stack for a long time to come!")),s.a.createElement("hr",null))}}},[["+N59",1,0]]]);