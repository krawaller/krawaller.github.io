(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{WlKn:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/a-react-redux-example-app",function(){var e=t("ruxB");return{page:e.default||e}}])},ruxB:function(e,a,t){"use strict";t.r(a);var l=t("q1tI"),s=t.n(l),n=t("JRaF"),r=t("YFqc"),c=t.n(r),m={url:"a-react-redux-example-app",id:"superheroes",title:"A React-Redux example app",author:"david",tags:["react","redux","case study"],date:"2015-10-29",excerpt:"Dissecting a small React-Redux example application",type:"post",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2015-10-29_superheroes",hasStaticContent:!0,headlines:[{level:3,text:"The Superhero battler app",id:"the-superhero-battler-app"},{level:3,text:"Under the hood",id:"under-the-hood"},{level:3,text:"Data model",id:"data-model"},{level:3,text:"Mutating the data",id:"mutating-the-data"},{level:3,text:"Components",id:"components"},{level:3,text:"Getting dirty",id:"getting-dirty"},{level:3,text:"Wrapping up",id:"wrapping-up"}]};a.default=function(){return s.a.createElement(n.a,{kind:"post",data:m,title:"A React-Redux example app",summary:"Dissecting a small React-Redux example application",headlines:[{level:3,text:"The Superhero battler app",id:"the-superhero-battler-app"},{level:3,text:"Under the hood",id:"under-the-hood"},{level:3,text:"Data model",id:"data-model"},{level:3,text:"Mutating the data",id:"mutating-the-data"},{level:3,text:"Components",id:"components"},{level:3,text:"Getting dirty",id:"getting-dirty"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["react","redux","case study"]},s.a.createElement("div",{className:"post","data-postid":"superheroes"},s.a.createElement("p",null,s.a.createElement("span",{style:{color:"red"}},s.a.createElement("strong",null,"Note"),": This example app has a bug due to bad flow design. See the explanation and the solution in ",s.a.createElement(c.a,{href:"/posts/a-react-redux-example-followup",prefetch:!0},s.a.createElement("a",null,"this follow-up post")),"!")),s.a.createElement("h3",{id:"the-superhero-battler-app"},"The Superhero battler app"),s.a.createElement("p",null,"This post presents a simple React-Redux example app. The aim was to have a small example to complement the official Redux ones, that is also more portable. It uses React, Redux, React-Router, React-Redux and browserify. And (almost) no ES6 syntax."),s.a.createElement("p",null,'Instead of the venerable ToDo, the app is a tiny "game" where superheroes battle it out until there\'s only one left standing:'),s.a.createElement("iframe",{src:"https://blog.krawaller.se/riastart2015/index.html",style:{height:500,width:"100%"}}),s.a.createElement("p",null,"The url for the app is ",s.a.createElement("a",{href:"https://blog.krawaller.se/riastart2015/"},"https://blog.krawaller.se/riastart2015/"),", and the source code is at ",s.a.createElement("a",{href:"https://github.com/krawaller/riastart2015"},"https://github.com/krawaller/riastart2015"),"."),s.a.createElement("p",null,"Kick the tires for a bit so you get a feel for what's going on, then read on to see how it is all put together!"),s.a.createElement("h3",{id:"under-the-hood"},"Under the hood"),s.a.createElement("p",null,"These are the involved files (along with ",s.a.createElement("code",null,"index.html")," and the generated ",s.a.createElement("code",null,"bundle.js"),"):"),s.a.createElement("p",null,s.a.createElement("img",{src:"/static/posts/a-react-redux-example-app/img/superherofiles.png",alt:"components"})),s.a.createElement("p",null,"Before we look at the components, let's examine the main plumbing first. The entry point is ",s.a.createElement("code",null,"index.js"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ReactDOM = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-dom"'),"),",s.a.createElement("br",null),"  Router = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Router,",s.a.createElement("br",null),"  Provider = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-redux"'),").Provider,",s.a.createElement("br",null),"  store = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./store"'),"),",s.a.createElement("br",null),"  routes = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./routes"'),");",s.a.createElement("br",null),s.a.createElement("br",null),"ReactDOM.render(",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-comment"},"// The top-level Provider is what allows us to `connect` components to the store"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-comment"},"// using ReactRedux.connect (see components Home and Hero)"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Provider")," ",s.a.createElement("span",{className:"hljs-attr"},"store"),"=",s.a.createElement("span",{className:"hljs-string"},"{store}"),">"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Router")," ",s.a.createElement("span",{className:"hljs-attr"},"routes"),"=",s.a.createElement("span",{className:"hljs-string"},"{routes}")," />"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"Provider"),">")),",",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-built_in"},"document"),".getElementById(",s.a.createElement("span",{className:"hljs-string"},'"root"'),")",s.a.createElement("br",null),");")),s.a.createElement("p",null,"In here we load ",s.a.createElement("code",null,"routes.js"),", hook up ",s.a.createElement("code",null,"store.js"),", and feed it all to ",s.a.createElement("code",null,"ReactDOM.render"),"!"),s.a.createElement("h3",{id:"data-model"},"Data model"),s.a.createElement("p",null,"Now we enter Redux land! I won't go into too much detail on how Redux works, as ",s.a.createElement("a",{href:"http://redux.js.org/"},"the official docs")," are just marvelous at doing that. Instead we'll focus on how this app uses Redux."),s.a.createElement("p",null,"Here's what our store (in Redux there's only one) looks like:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," Redux = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"redux"'),"),",s.a.createElement("br",null),"  heroReducer = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./reducers/heroes"'),"),",s.a.createElement("br",null),"  battlefieldReducer = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./reducers/battlefield"'),"),",s.a.createElement("br",null),"  initialState = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./initialstate"'),"),",s.a.createElement("br",null),"  thunk = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"redux-thunk"'),"); ",s.a.createElement("span",{className:"hljs-comment"},"// allows us to use asynchronous actions"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," rootReducer = Redux.combineReducers({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"heroes"),": heroReducer, ",s.a.createElement("span",{className:"hljs-comment"},"// this means heroReducer will operate on appState.heroes"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"battlefield"),": battlefieldReducer ",s.a.createElement("span",{className:"hljs-comment"},"// battlefieldReducer will operate on appState.battlefield,"),s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Redux.applyMiddleware(thunk)(Redux.createStore)(",s.a.createElement("br",null),"  rootReducer,",s.a.createElement("br",null),"  initialState()",s.a.createElement("br",null),");")),s.a.createElement("p",null,"There are some weird parts to this, but what's relevant for our app is ",s.a.createElement("code",null,"initialstate")," and the two reducers, ",s.a.createElement("code",null,"heroReducer")," and ",s.a.createElement("code",null,"battlefieldReducer"),"."),s.a.createElement("p",null,"Let's peek at ",s.a.createElement("code",null,"initialstate")," first, as that will also serve as a picture of what the app data model looks like:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./constants"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"return")," {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"heroes"),": {",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"batman"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"quote"),": ",s.a.createElement("span",{className:"hljs-string"},'"I\'m batman."'),",",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"kills"),": ",s.a.createElement("span",{className:"hljs-number"},"0"),s.a.createElement("br",null),"      },",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"superman"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"quote"),": ",s.a.createElement("span",{className:"hljs-string"},'"I can fly!"'),",",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"kills"),": ",s.a.createElement("span",{className:"hljs-number"},"0"),s.a.createElement("br",null),"      },",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"spiderman"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"quote"),": ",s.a.createElement("span",{className:"hljs-string"},'"Why don\'t you love me, Lois?"'),",",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"kills"),": ",s.a.createElement("span",{className:"hljs-number"},"0"),s.a.createElement("br",null),"      },",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-string"},'"he-man"'),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"quote"),": ",s.a.createElement("span",{className:"hljs-string"},'"By the power of Grayskull!"'),",",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"kills"),": ",s.a.createElement("span",{className:"hljs-number"},"0"),s.a.createElement("br",null),"      }",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"battlefield"),": {",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"doing"),": {",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"batman"),": C.WAITING,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"superman"),": C.WAITING,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-attr"},"spiderman"),": C.WAITING,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-string"},'"he-man"'),": C.WAITING",s.a.createElement("br",null),"      },",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"standing"),": ",s.a.createElement("span",{className:"hljs-number"},"4"),",",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"log"),": [",s.a.createElement("span",{className:"hljs-string"},'"Ready.... fight!"'),"]",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"  };",s.a.createElement("br",null),"};")),s.a.createElement("p",null,"As you can see there are two main parts to the data; ",s.a.createElement("code",null,"heroes")," and ",s.a.createElement("code",null,"battlefield"),". These parts correspond to the two reducers you saw earlier in the store file."),s.a.createElement("p",null,"The constants file is merely just that, a list of constants:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs"},"module.exports = {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// ACTION TYPES"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    AIM_AT:")," ",s.a.createElement("span",{className:"hljs-string"},'"AIM_AT"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    KILL_HERO:")," ",s.a.createElement("span",{className:"hljs-string"},'"KILL_HERO"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    RESET:")," ",s.a.createElement("span",{className:"hljs-string"},'"RESET"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    DUCK_DOWN:")," ",s.a.createElement("span",{className:"hljs-string"},'"DUCK_DOWN"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    STAND_UP:")," ",s.a.createElement("span",{className:"hljs-string"},'"STAND_UP"'),",",s.a.createElement("br",null),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// HERO STATUSES"),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    AIMING:")," ",s.a.createElement("span",{className:"hljs-string"},'"AIMING"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    DUCKING:")," ",s.a.createElement("span",{className:"hljs-string"},'"DUCKING"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    WAITING:")," ",s.a.createElement("span",{className:"hljs-string"},'"WAITING"'),",",s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-symbol"},"    DEAD:")," ",s.a.createElement("span",{className:"hljs-string"},'"DEAD"'),s.a.createElement("br",null),"};")),s.a.createElement("h3",{id:"mutating-the-data"},"Mutating the data"),s.a.createElement("p",null,"Now we've seen what the data looks like; how is it updated? Through ",s.a.createElement("code",null,"actions"),", that's how! Here's what the action creators for our app looks like:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," constants = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./constants"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = {",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"reset"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// A normal action creator, returns a simple object describing the action."),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," { ",s.a.createElement("span",{className:"hljs-attr"},"type"),": constants.RESET };",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"duckDown"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"who"),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// here we take advantage of Redux-thunk; instead of returning an object describing an action,"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// we return a function that takes dispatch and getState as arguments. This function can then"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// invoke dispatch, now or later using setTimeout or similar."),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"dispatch, getState"),") "),"{",s.a.createElement("br",null),"      dispatch({ ",s.a.createElement("span",{className:"hljs-attr"},"type"),": constants.DUCK_DOWN, ",s.a.createElement("span",{className:"hljs-attr"},"coward"),": who });",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-built_in"},"setTimeout"),"(",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        dispatch({ ",s.a.createElement("span",{className:"hljs-attr"},"type"),": constants.STAND_UP, ",s.a.createElement("span",{className:"hljs-attr"},"coward"),": who });",s.a.createElement("br",null),"      }, ",s.a.createElement("span",{className:"hljs-number"},"2000"),");",s.a.createElement("br",null),"    };",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"aimAt"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"killer, victim"),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// Another async action using the Redux-thunk syntax"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"dispatch, getState"),") "),"{",s.a.createElement("br",null),"      dispatch({ ",s.a.createElement("span",{className:"hljs-attr"},"type"),": constants.AIM_AT, ",s.a.createElement("span",{className:"hljs-attr"},"killer"),": killer, ",s.a.createElement("span",{className:"hljs-attr"},"victim"),": victim });",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-built_in"},"setTimeout"),"(",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"        dispatch({ ",s.a.createElement("span",{className:"hljs-attr"},"type"),": constants.KILL_HERO, ",s.a.createElement("span",{className:"hljs-attr"},"killer"),": killer, ",s.a.createElement("span",{className:"hljs-attr"},"victim"),": victim });",s.a.createElement("br",null),"      }, ",s.a.createElement("span",{className:"hljs-number"},"2000"),");",s.a.createElement("br",null),"    };",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"};")),s.a.createElement("p",null,"These functions will be used inside components in response to user events. But before we look at those, let's see what happens when they are invoked - that magic is all in the reducers!"),s.a.createElement("p",null,"First off the ",s.a.createElement("code",null,"heroReducer"),", as that is by far the simplest. The only thing it does is increase the kill count whenever a hero kills another."),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../constants"'),"),",s.a.createElement("br",null),"  initialState = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../initialstate"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"state, action"),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"var")," newstate = ",s.a.createElement("span",{className:"hljs-built_in"},"Object"),".assign({}, state); ",s.a.createElement("span",{className:"hljs-comment"},"// sloppily copying the old state here, so we never mutate it"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"switch")," (action.type) {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.KILL_HERO:",s.a.createElement("br",null),"      newstate[action.killer].kills += ",s.a.createElement("span",{className:"hljs-number"},"1"),";",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"default"),":",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," state || initialState().heroes;",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"};")),s.a.createElement("p",null,"The ",s.a.createElement("code",null,"battlefieldReducer"),", however, has far more responsibilities!"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../constants"'),"),",s.a.createElement("br",null),"  initialState = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../initialstate"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"state, action"),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"var")," newstate = ",s.a.createElement("span",{className:"hljs-built_in"},"Object"),".assign({}, state); ",s.a.createElement("span",{className:"hljs-comment"},"// sloppily copying the old state here, so we never mutate it"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"switch")," (action.type) {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.DUCK_DOWN:",s.a.createElement("br",null),"      newstate.doing[action.coward] = C.DUCKING;",s.a.createElement("br",null),"      newstate.log.push(action.coward + ",s.a.createElement("span",{className:"hljs-string"},'" ducks down like a coward."'),");",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.STAND_UP:",s.a.createElement("br",null),"      newstate.doing[action.coward] = C.WAITING;",s.a.createElement("br",null),"      newstate.log.push(action.coward + ",s.a.createElement("span",{className:"hljs-string"},'" stands back up."'),");",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.AIM_AT:",s.a.createElement("br",null),"      newstate.doing[action.killer] = C.AIMING;",s.a.createElement("br",null),"      newstate.log.push(action.killer + ",s.a.createElement("span",{className:"hljs-string"},'" takes aim at "')," + action.victim + ",s.a.createElement("span",{className:"hljs-string"},'"!"'),");",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.KILL_HERO:",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-comment"},"// the shooter has died before he got the shot off"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.killer] === C.DEAD) {",s.a.createElement("br",null),"        newstate.log.push(",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-string"},'"The trigger finger twitches on "')," + action.killer + ",s.a.createElement("span",{className:"hljs-string"},'"\'s corpse"'),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"      } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," {",s.a.createElement("br",null),"        newstate.doing[action.killer] = C.WAITING;",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-comment"},"// the target is ducking"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.DUCKING) {",s.a.createElement("br",null),"          newstate.log.push(",s.a.createElement("br",null),"            action.victim + ",s.a.createElement("span",{className:"hljs-string"},'" dodges a blast from "')," + action.killer + ",s.a.createElement("span",{className:"hljs-string"},'"!"'),s.a.createElement("br",null),"          );",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-comment"},"// the target has already been killed"),s.a.createElement("br",null),"        } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.DEAD) {",s.a.createElement("br",null),"          newstate.log.push(",s.a.createElement("br",null),"            action.killer + ",s.a.createElement("span",{className:"hljs-string"},'" blasts "')," + action.victim + ",s.a.createElement("span",{className:"hljs-string"},'"\'s corpse."'),s.a.createElement("br",null),"          );",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-comment"},"// we kill the target!"),s.a.createElement("br",null),"        } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," {",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.AIMING) {",s.a.createElement("br",null),"            newstate.log.push(",s.a.createElement("br",null),"              action.killer +",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-string"},'" killed "')," +",s.a.createElement("br",null),"                action.victim +",s.a.createElement("br",null),"                ",s.a.createElement("span",{className:"hljs-string"},'" before he got his shot off!"'),s.a.createElement("br",null),"            );",s.a.createElement("br",null),"          } ",s.a.createElement("span",{className:"hljs-keyword"},"else")," {",s.a.createElement("br",null),"            newstate.log.push(action.killer + ",s.a.createElement("span",{className:"hljs-string"},'" killed "')," + action.victim + ",s.a.createElement("span",{className:"hljs-string"},'"!"'),");",s.a.createElement("br",null),"          }",s.a.createElement("br",null),"          newstate.doing[action.victim] = C.DEAD;",s.a.createElement("br",null),"          newstate.standing = newstate.standing - ",s.a.createElement("span",{className:"hljs-number"},"1"),";",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"if")," (newstate.standing === ",s.a.createElement("span",{className:"hljs-number"},"1"),") {",s.a.createElement("br",null),"            newstate.log.push(action.killer + ",s.a.createElement("span",{className:"hljs-string"},'" WINS!!"'),");",s.a.createElement("br",null),"          }",s.a.createElement("br",null),"        }",s.a.createElement("br",null),"      }",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"case")," C.RESET:",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," initialState().battlefield;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"default"),":",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-keyword"},"return")," state || initialState().battlefield;",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"};")),s.a.createElement("p",null,"Please take a moment to look at the various cases, and connect it to how the app behaved when you tested it earlier!"),s.a.createElement("h3",{id:"components"},"Components"),s.a.createElement("p",null,"The app are made up by these components:"),s.a.createElement("p",null,s.a.createElement("img",{src:"/static/posts/a-react-redux-example-app/img/superherocomponents.png",alt:"components"})),s.a.createElement("p",null,"The hierarchy isn't strictly true as ",s.a.createElement("code",null,"Hero")," and ",s.a.createElement("code",null,"Home")," are served through ",s.a.createElement("code",null,"routes"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ReactRouter = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-router"'),"),",s.a.createElement("br",null),"  Route = ReactRouter.Route,",s.a.createElement("br",null),"  IndexRoute = ReactRouter.IndexRoute,",s.a.createElement("br",null),"  Wrapper = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./components/wrapper"'),"),",s.a.createElement("br",null),"  Home = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./components/home"'),"),",s.a.createElement("br",null),"  Hero = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./components/hero"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = (",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Route")," ",s.a.createElement("span",{className:"hljs-attr"},"path"),"=",s.a.createElement("span",{className:"hljs-string"},'"/"')," ",s.a.createElement("span",{className:"hljs-attr"},"component"),"=",s.a.createElement("span",{className:"hljs-string"},"{Wrapper}"),">"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"IndexRoute")," ",s.a.createElement("span",{className:"hljs-attr"},"component"),"=",s.a.createElement("span",{className:"hljs-string"},"{Home}")," />"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Route")," ",s.a.createElement("span",{className:"hljs-attr"},"path"),"=",s.a.createElement("span",{className:"hljs-string"},'"/hero/:name"')," ",s.a.createElement("span",{className:"hljs-attr"},"component"),"=",s.a.createElement("span",{className:"hljs-string"},"{Hero}")," />"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"Route"),">")),s.a.createElement("br",null),");")),s.a.createElement("p",null,"The app only has two routes, either we're in the main battle arena or we are in a closeup of one of the heroes."),s.a.createElement("p",null,s.a.createElement("code",null,"Wrapper")," doesn't do anything exciting, it simply renders out the children:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Wrapper = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"wrapper"'),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"h2"),">"),"Superhero battle arena 2000!",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"h2"),">"),s.a.createElement("br",null),"        {this.props.children}",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),s.a.createElement("br",null),"    );",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Wrapper;")),s.a.createElement("p",null,"For slightly higher excitement let's take a look at ",s.a.createElement("code",null,"Hero"),", our first Redux-aware component:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ptypes = React.PropTypes,",s.a.createElement("br",null),"  Link = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Link,",s.a.createElement("br",null),"  ReactRedux = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-redux"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Hero = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"params"),": ptypes.shape({ ",s.a.createElement("span",{className:"hljs-attr"},"name"),": ptypes.string.isRequired }).isRequired, ",s.a.createElement("span",{className:"hljs-comment"},"// will be provided by react-router"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"heroes"),": ptypes.object.isRequired ",s.a.createElement("span",{className:"hljs-comment"},"// will be provided by react-redux"),s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"var")," name = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.params.name,",s.a.createElement("br",null),"      data = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.heroes[name];",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Link")," ",s.a.createElement("span",{className:"hljs-attr"},"to"),"=",s.a.createElement("span",{className:"hljs-string"},'"/"'),">"),"Back to arena",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"Link"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"p"),">"),"Here's some info on {this.props.params.name}:",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),"Quote:",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),' {data.quote}{" "}',s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),"Kills:",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"strong"),">"),' {data.kills}{" "}',s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"p"),">"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),s.a.createElement("br",null),"    );",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// connect to Redux store"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," mapStateToProps = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"state"),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-comment"},"// This component will have access to `appstate.heroes` through `this.props.heroes`"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"return")," { ",s.a.createElement("span",{className:"hljs-attr"},"heroes"),": state.heroes };",s.a.createElement("br",null),"};",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ReactRedux.connect(mapStateToProps)(Hero);")),s.a.createElement("p",null,"Through ",s.a.createElement("code",null,"ReactRedux")," we give the component access to the ",s.a.createElement("code",null,"battlefield")," part of the app state. The component can the use that just as any other property data served down from a higher-level component."),s.a.createElement("p",null,"Using ",s.a.createElement("code",null,"ReactRouter")," we learn the name of the current hero we've navigated to (there should probably be some error checking in there though), and then we can dig out the correct data."),s.a.createElement("h3",{id:"getting-dirty"},"Getting dirty"),s.a.createElement("p",null,"On to the next Redux-aware component - ",s.a.createElement("code",null,"Home"),", which is the main battle arena!"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ptypes = React.PropTypes,",s.a.createElement("br",null),"  ReactRedux = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-redux"'),"),",s.a.createElement("br",null),"  Log = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./log"'),"),",s.a.createElement("br",null),"  Battlers = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./battlers"'),"),",s.a.createElement("br",null),"  actions = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../actions"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Home = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// redux store state, imported below"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"battle"),": ptypes.shape({",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"doing"),": ptypes.object.isRequired,",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-attr"},"log"),": ptypes.arrayOf(ptypes.string)",s.a.createElement("br",null),"    }).isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"// redux action hookups, set up below"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"kill"),": ptypes.func.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"reset"),": ptypes.func.isRequired",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"var")," battleprops = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props.battle;",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Battlers"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-attr"},"doing"),"=",s.a.createElement("span",{className:"hljs-string"},"{battleprops.doing}"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-attr"},"kill"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.props.kill}"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-attr"},"duck"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.props.duck}"),s.a.createElement("br",null),"        />"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Log")," ",s.a.createElement("span",{className:"hljs-attr"},"log"),"=",s.a.createElement("span",{className:"hljs-string"},"{battleprops.log}")," />"),s.a.createElement("br",null),"        {battleprops.standing === 1 && (",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"button")," ",s.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{this.props.reset}"),">"),"Reset",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"button"),">"),s.a.createElement("br",null),"        )}",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),s.a.createElement("br",null),"    );",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-comment"},"// now we connect the component to the Redux store:"),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," mapStateToProps = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"state"),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-comment"},"// This component will have access to `state.battlefield` through `this.props.battle`"),s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"return")," { ",s.a.createElement("span",{className:"hljs-attr"},"battle"),": state.battlefield };",s.a.createElement("br",null),"};",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," mapDispatchToProps = ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"dispatch"),") "),"{",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-keyword"},"return")," {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"kill"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"killer, victim"),") "),"{",s.a.createElement("br",null),"      dispatch(actions.aimAt(killer, victim));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"duck"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"coward"),") "),"{",s.a.createElement("br",null),"      dispatch(actions.duckDown(coward));",s.a.createElement("br",null),"    },",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"reset"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"      dispatch(actions.reset());",s.a.createElement("br",null),"    }",s.a.createElement("br",null),"  };",s.a.createElement("br",null),"};",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(Home);")),s.a.createElement("p",null,"Like before we connect it to the Redux Store, but unlike before we also import the action creators we saw earlier to use as callbacks!"),s.a.createElement("p",null,"Of these, ",s.a.createElement("code",null,"reset")," is used in this very component while ",s.a.createElement("code",null,"kill")," and ",s.a.createElement("code",null,"duck")," are passed down to the ",s.a.createElement("code",null,"Battlers")," component:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ptypes = React.PropTypes,",s.a.createElement("br",null),"  Battler = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"./battler"'),"),",s.a.createElement("br",null),"  _ = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"lodash"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Battlers = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"kill"),": ptypes.func.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"doing"),": ptypes.object.isRequired",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"var")," p = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props,",s.a.createElement("br",null),"      boxes = _.map(",s.a.createElement("br",null),"        p.doing,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"doing, name"),") "),"{",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"var")," kill = p.kill.bind(",s.a.createElement("span",{className:"hljs-built_in"},"this"),", name), ",s.a.createElement("span",{className:"hljs-comment"},"// prefill the kill method so that killer is always `name`"),s.a.createElement("br",null),"            duck = p.duck.bind(",s.a.createElement("span",{className:"hljs-built_in"},"this"),", name); ",s.a.createElement("span",{className:"hljs-comment"},"// make sure battler can only duck himself"),s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Battler"),s.a.createElement("br",null),"              ",s.a.createElement("span",{className:"hljs-attr"},"key"),"=",s.a.createElement("span",{className:"hljs-string"},"{name}"),s.a.createElement("br",null),"              ",s.a.createElement("span",{className:"hljs-attr"},"name"),"=",s.a.createElement("span",{className:"hljs-string"},"{name}"),s.a.createElement("br",null),"              ",s.a.createElement("span",{className:"hljs-attr"},"doing"),"=",s.a.createElement("span",{className:"hljs-string"},"{p.doing}"),s.a.createElement("br",null),"              ",s.a.createElement("span",{className:"hljs-attr"},"kill"),"=",s.a.createElement("span",{className:"hljs-string"},"{kill}"),s.a.createElement("br",null),"              ",s.a.createElement("span",{className:"hljs-attr"},"duck"),"=",s.a.createElement("span",{className:"hljs-string"},"{duck}"),s.a.createElement("br",null),"            />")),s.a.createElement("br",null),"          );",s.a.createElement("br",null),"        },",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-built_in"},"this"),s.a.createElement("br",null),"      );",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"battlers"'),">"),"{boxes}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),";",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Battlers;")),s.a.createElement("p",null,"This components renders a ",s.a.createElement("code",null,"Battler")," component for each super hero, giving them their name, personalized versions of ",s.a.createElement("code",null,"kill")," and ",s.a.createElement("code",null,"duck"),", as well as the full ",s.a.createElement("code",null,"doing")," object containing the status of everyone. Here's the code for ",s.a.createElement("code",null,"Battler"),":"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ptypes = React.PropTypes,",s.a.createElement("br",null),"  _ = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"lodash"'),"),",s.a.createElement("br",null),"  Link = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Link,",s.a.createElement("br",null),"  C = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"../constants"'),");",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Battler = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"name"),": ptypes.string.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"kill"),": ptypes.func.isRequired,",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"var")," p = ",s.a.createElement("span",{className:"hljs-built_in"},"this"),".props,",s.a.createElement("br",null),"      name = p.name,",s.a.createElement("br",null),"      doing = p.doing,",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-comment"},"// list all enemies that aren't dead yet"),s.a.createElement("br",null),"      killable = _.reduce(",s.a.createElement("br",null),"        doing,",s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"list, status, opp"),") "),"{",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"return")," status !== C.DEAD && opp !== name ? list.concat(opp) : list;",s.a.createElement("br",null),"        },",s.a.createElement("br",null),"        []",s.a.createElement("br",null),"      ),",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-comment"},"// make buttons for all killable enemies"),s.a.createElement("br",null),"      buttons = killable",s.a.createElement("br",null),"        .map(",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"},"opp"),") "),"{",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"button")," ",s.a.createElement("span",{className:"hljs-attr"},"key"),"=",s.a.createElement("span",{className:"hljs-string"},"{opp}")," ",s.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{p.kill.bind(this,")," ",s.a.createElement("span",{className:"hljs-attr"},"opp"),")}>"),s.a.createElement("br",null),'              {"Kill " + opp}',s.a.createElement("br",null),"            ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"button"),">")),s.a.createElement("br",null),"          );",s.a.createElement("br",null),"        }, ",s.a.createElement("span",{className:"hljs-built_in"},"this"),")",s.a.createElement("br",null),"        .concat(",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"button")," ",s.a.createElement("span",{className:"hljs-attr"},"key"),"=",s.a.createElement("span",{className:"hljs-string"},'"duck"')," ",s.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",s.a.createElement("span",{className:"hljs-string"},"{p.duck}"),">"),s.a.createElement("br",null),"            duck",s.a.createElement("br",null),"          ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"button"),">")),s.a.createElement("br",null),"        );",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-comment"},"//controls depend on what we're doing"),s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"var")," controls = {",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-comment"},"// using ES6 syntax for dynamic object properties"),s.a.createElement("br",null),"      [C.WAITING]: buttons.length > ",s.a.createElement("span",{className:"hljs-number"},"1")," ? buttons : ",s.a.createElement("span",{className:"hljs-string"},'"Winner!!"'),",",s.a.createElement("br",null),"      [C.DUCKING]: ",s.a.createElement("span",{className:"hljs-string"},'"ducking"'),",",s.a.createElement("br",null),"      [C.DEAD]: ",s.a.createElement("span",{className:"hljs-string"},'"...dead..."'),",",s.a.createElement("br",null),"      [C.AIMING]: ",s.a.createElement("span",{className:"hljs-string"},'"aiming!"'),s.a.createElement("br",null),"    }[p.doing[name]];",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div")," ",s.a.createElement("span",{className:"hljs-attr"},"className"),"=",s.a.createElement("span",{className:"hljs-string"},'"battler"'),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"Link")," ",s.a.createElement("span",{className:"hljs-attr"},"to"),"=",s.a.createElement("span",{className:"hljs-string"},"{"),'"/',s.a.createElement("span",{className:"hljs-attr"},"hero"),'/" + ',s.a.createElement("span",{className:"hljs-attr"},"name"),"}>"),"{name}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"Link"),">"),s.a.createElement("br",null),"        ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"div"),">"),"{controls}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">"),s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"div"),">")),s.a.createElement("br",null),"    );",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Battler;")),s.a.createElement("p",null,"Here we finally hook up ",s.a.createElement("code",null,"kill")," and ",s.a.createElement("code",null,"duck")," to user interactions."),s.a.createElement("p",null,"For completion's sake let's also list the code for ",s.a.createElement("code",null,"Log"),", although there's nothing much going on there:"),s.a.createElement("pre",null,s.a.createElement("code",{className:"hljs language-javascript"},s.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",s.a.createElement("span",{className:"hljs-built_in"},"require"),"(",s.a.createElement("span",{className:"hljs-string"},'"react"'),"),",s.a.createElement("br",null),"  ptypes = React.PropTypes;",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-keyword"},"var")," Log = React.createClass({",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-attr"},"log"),": ptypes.arrayOf(ptypes.string).isRequired",s.a.createElement("br",null),"  },",s.a.createElement("br",null),"  ",s.a.createElement("span",{className:"hljs-attr"},"render"),": ",s.a.createElement("span",{className:"hljs-function"},s.a.createElement("span",{className:"hljs-keyword"},"function"),"(",s.a.createElement("span",{className:"hljs-params"}),") "),"{",s.a.createElement("br",null),"    ",s.a.createElement("span",{className:"hljs-keyword"},"return")," (",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"xml"},s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"ul"),">"),s.a.createElement("br",null),"        {this.props.log.map(function(txt, n) {",s.a.createElement("br",null),"          return ",s.a.createElement("span",{className:"hljs-tag"},"<",s.a.createElement("span",{className:"hljs-name"},"li")," ",s.a.createElement("span",{className:"hljs-attr"},"key"),"=",s.a.createElement("span",{className:"hljs-string"},"{n}"),">"),"{txt}",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"li"),">"),";",s.a.createElement("br",null),"        })}",s.a.createElement("br",null),"      ",s.a.createElement("span",{className:"hljs-tag"},"</",s.a.createElement("span",{className:"hljs-name"},"ul"),">")),s.a.createElement("br",null),"    );",s.a.createElement("br",null),"  }",s.a.createElement("br",null),"});",s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Log;")),s.a.createElement("h3",{id:"wrapping-up"},"Wrapping up"),s.a.createElement("p",null,"As warned I didn't explain much about how Redux works, but again, the ",s.a.createElement("a",{href:"http://redux.js.org/"},"official docs")," are really brilliant. But I hope this hands-on example helped you learn what I have; that Redux, although tiny, is one beast of a data flow library!")),s.a.createElement("hr",null))}}},[["WlKn",1,0]]]);