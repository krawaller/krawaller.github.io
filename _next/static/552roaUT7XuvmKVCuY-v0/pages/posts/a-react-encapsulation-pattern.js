(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{Ngo3:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/a-react-encapsulation-pattern",function(){var e=t("ozIn");return{page:e.default||e}}])},ozIn:function(e,a,t){"use strict";t.r(a);var l=t("q1tI"),n=t.n(l),s=t("JRaF"),r=t("YFqc"),c=t.n(r),m={url:"a-react-encapsulation-pattern",id:"reactpattern",title:"A React encapsulation pattern",author:"david",tags:["react","underscore"],date:"2014-12-10",excerpt:"Exploring how we can encapsulate concerns in React by using mixin factories",type:"post",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2014-12-10_reactpattern",hasStaticContent:!0,headlines:[{level:3,text:"Fruits!",id:"fruits"},{level:3,text:"Vegetables!",id:"vegetables"},{level:3,text:"Componentifying",id:"componentifying"},{level:3,text:"Underscore intermission",id:"underscore-intermission"},{level:3,text:"The actual problem",id:"the-actual-problem"},{level:3,text:"Tried and trusted",id:"tried-and-trusted"},{level:3,text:"The solution",id:"the-solution"},{level:3,text:"Final scare",id:"final-scare"},{level:3,text:"Passing the instance",id:"passing-the-instance"},{level:3,text:"2 in 1",id:"2-in-1"},{level:3,text:"Wrapping up",id:"wrapping-up"}]};a.default=function(){return n.a.createElement(s.a,{kind:"post",data:m,title:"A React encapsulation pattern",summary:"Exploring how we can encapsulate concerns in React by using mixin factories",headlines:[{level:3,text:"Fruits!",id:"fruits"},{level:3,text:"Vegetables!",id:"vegetables"},{level:3,text:"Componentifying",id:"componentifying"},{level:3,text:"Underscore intermission",id:"underscore-intermission"},{level:3,text:"The actual problem",id:"the-actual-problem"},{level:3,text:"Tried and trusted",id:"tried-and-trusted"},{level:3,text:"The solution",id:"the-solution"},{level:3,text:"Final scare",id:"final-scare"},{level:3,text:"Passing the instance",id:"passing-the-instance"},{level:3,text:"2 in 1",id:"2-in-1"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["react","underscore"]},n.a.createElement("div",{className:"post","data-postid":"reactpattern"},n.a.createElement("h3",{id:"fruits"},"Fruits!"),n.a.createElement("p",null,"As a first step towards a discussion on an encapsulation pattern using mixin factories, please consider this little object of intellectual fruit opinions:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," fruits = {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"apples"),": ",n.a.createElement("span",{className:"hljs-string"},'"nice"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"oranges"),": ",n.a.createElement("span",{className:"hljs-string"},'"a hassle to peel"'),",",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"bananas"),": ",n.a.createElement("span",{className:"hljs-string"},'"funny"'),n.a.createElement("br",null),"};")),n.a.createElement("p",null,"I now want the user to be able to select one a time, something like this:"),n.a.createElement("iframe",{src:"/static/posts/a-react-encapsulation-pattern/applets/reactpattern/select01.html",style:{height:70,width:"100%"}}),n.a.createElement("p",null,"What parts are involved in the select bar? Well, we need to:"),n.a.createElement("ol",null,n.a.createElement("li",null,"have an initially selected option"),n.a.createElement("li",null,"render the bar, highlighting the currently selected option"),n.a.createElement("li",null,"update state whenever another option is selected")),n.a.createElement("p",null,"Here's a na\xefve implementation of this component:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Opinion = React.createClass({",n.a.createElement("br",null),"  getInitialState: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),n.a.createElement("span",{className:"hljs-params"},"()")),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {fruit:",n.a.createElement("span",{className:"hljs-string"},'"apples"'),"};",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  chooseFruit: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),n.a.createElement("span",{className:"hljs-params"},"(c)")),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".setState({fruit:c});",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  render: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),n.a.createElement("span",{className:"hljs-params"},"()")),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," selector = (",n.a.createElement("br",null),"      <div className=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">",n.a.createElement("br",null),"        {_.map(_.keys(fruits),",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),n.a.createElement("span",{className:"hljs-params"},"(c)")),"{",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"return")," <button onClick={_.partial(",n.a.createElement("span",{className:"hljs-keyword"},"this"),".chooseFruit,c)} className={",n.a.createElement("span",{className:"hljs-string"},"'btn btn-default'"),"+(c===",n.a.createElement("span",{className:"hljs-keyword"},"this"),".state.fruit?",n.a.createElement("span",{className:"hljs-string"},"' active'"),":",n.a.createElement("span",{className:"hljs-string"},"''"),")}>{c}</button>",n.a.createElement("br",null),"        },",n.a.createElement("span",{className:"hljs-keyword"},"this"),")}",n.a.createElement("br",null),"      </div>",n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      <div className=",n.a.createElement("span",{className:"hljs-string"},'"center-block"')," style={{maxWidth:",n.a.createElement("span",{className:"hljs-string"},'"800px;"'),",padding:",n.a.createElement("span",{className:"hljs-string"},'"1em;"'),"}}>",n.a.createElement("br",null),"        I posit that {selector} are {fruits[",n.a.createElement("span",{className:"hljs-keyword"},"this"),".state.fruit]}!",n.a.createElement("br",null),"      </div>",n.a.createElement("br",null),"    )",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"We provide an initial value through the ",n.a.createElement("code",null,"getInitialState")," method, and have a click handler that updates our state with the clicked option."),n.a.createElement("h3",{id:"vegetables"},"Vegetables!"),n.a.createElement("p",null,"Seems clean enough! So, what's wrong with this? Well, not much (and we'll get to that later). But when the vegetables arrive..."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"var vegetables = {",n.a.createElement("br",null),"  carrots: ",n.a.createElement("span",{className:"hljs-comment"},'"are for bunnies"'),",",n.a.createElement("br",null),"  peas: ",n.a.createElement("span",{className:"hljs-comment"},'"are perfect for flicking at your mum"'),",",n.a.createElement("br",null),"  eggplants: ",n.a.createElement("span",{className:"hljs-comment"},'"are just weird"'),n.a.createElement("br",null),"};")),n.a.createElement("p",null,"...and we now want this..."),n.a.createElement("iframe",{src:"/static/posts/a-react-encapsulation-pattern/applets/reactpattern/select01v.html",style:{height:140,width:"100%"}}),n.a.createElement("p",null,"...things get rather messy! Extending ",n.a.createElement("code",null,"Opinion")," using the same approach as before we end up with something like this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," List = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"fruit"),": ",n.a.createElement("span",{className:"hljs-string"},'"apples"'),", ",n.a.createElement("span",{className:"hljs-attr"},"vegetable"),": ",n.a.createElement("span",{className:"hljs-string"},'"carrots"')," };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"chooseFruit"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"c"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"fruit"),": c });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"chooseVegetable"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"c"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"vegetable"),": c });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," fruitSelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"        {_.map(",n.a.createElement("br",null),"          _.keys(fruits),",n.a.createElement("br",null),"          function(c) {",n.a.createElement("br",null),"            return (",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button"),n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(this.chooseFruit,")," ",n.a.createElement("span",{className:"hljs-attr"},"c"),")}",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),n.a.createElement("br",null),'                  "',n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),'" + (',n.a.createElement("span",{className:"hljs-attr"},"c")," === ",n.a.createElement("span",{className:"hljs-string"},"this.state.fruit"),' ? " ',n.a.createElement("span",{className:"hljs-attr"},"active"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "")',n.a.createElement("br",null),"                }",n.a.createElement("br",null),"              >"),n.a.createElement("br",null),"                {c}",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"            );",n.a.createElement("br",null),"          },",n.a.createElement("br",null),"          this",n.a.createElement("br",null),"        )}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," veggySelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"        {_.map(",n.a.createElement("br",null),"          _.keys(vegetables),",n.a.createElement("br",null),"          function(c) {",n.a.createElement("br",null),"            return (",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button"),n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(this.chooseVegetable,")," ",n.a.createElement("span",{className:"hljs-attr"},"c"),")}",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),n.a.createElement("br",null),'                  "',n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),'" +',n.a.createElement("br",null),"                  (",n.a.createElement("span",{className:"hljs-attr"},"c")," === ",n.a.createElement("span",{className:"hljs-string"},"this.state.vegetable"),' ? " ',n.a.createElement("span",{className:"hljs-attr"},"active"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "")',n.a.createElement("br",null),"                }",n.a.createElement("br",null),"              >"),n.a.createElement("br",null),"                {c}",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"            );",n.a.createElement("br",null),"          },",n.a.createElement("br",null),"          this",n.a.createElement("br",null),"        )}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"center-block"'),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"maxWidth:"),' "',n.a.createElement("span",{className:"hljs-attr"},"800px"),';", ',n.a.createElement("span",{className:"hljs-attr"},"padding:"),' "',n.a.createElement("span",{className:"hljs-attr"},"1em"),';" }}',n.a.createElement("br",null),"      >"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          I posit that {fruitSelector} are {fruits[this.state.fruit]}!",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"br")," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          Also {veggySelector} are {vegetables[this.state.vegetable]}.",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"This is starting to look decidedly non-dry."),n.a.createElement("h3",{id:"componentifying"},"Componentifying"),n.a.createElement("p",null,"What springs immediately to mind is of course that we could encapsulate the rendering of the bar into a component! Let's call it ",n.a.createElement("code",null,"Select"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Select = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"options"),": React.PropTypes.arrayOf(React.PropTypes.string).isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"makeSelection"),": React.PropTypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"current"),": React.PropTypes.string.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"        {_.map(",n.a.createElement("br",null),"          this.props.options,",n.a.createElement("br",null),"          function(c) {",n.a.createElement("br",null),"            var handler = _.partial(this.props.makeSelection, c);",n.a.createElement("br",null),"            var active = c === this.props.current;",n.a.createElement("br",null),"            return (",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button"),n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{handler}"),n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),'"',n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),'" + (',n.a.createElement("span",{className:"hljs-attr"},"active"),' ? " ',n.a.createElement("span",{className:"hljs-attr"},"active"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "")}',n.a.createElement("br",null),"              >"),n.a.createElement("br",null),"                {c}",n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"            );",n.a.createElement("br",null),"          },",n.a.createElement("br",null),"          this",n.a.createElement("br",null),"        )}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"The component expects an ",n.a.createElement("strong",null,"array of options"),", a ",n.a.createElement("strong",null,"clickhandler")," and the ",n.a.createElement("strong",null,"currenly selected value"),". Note how we're using the ",n.a.createElement("code",null,"_.partial")," currying function to call the click handler with the clicked value."),n.a.createElement("p",null,"Using this component, ",n.a.createElement("code",null,"Opinion")," can now be reduced to this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Opinion = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"fruit"),": ",n.a.createElement("span",{className:"hljs-string"},'"apples"'),", ",n.a.createElement("span",{className:"hljs-attr"},"vegetable"),": ",n.a.createElement("span",{className:"hljs-string"},'"carrots"')," };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"chooseFruit"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"c"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"fruit"),": c });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"chooseVegetable"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"c"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({ ",n.a.createElement("span",{className:"hljs-attr"},"vegetable"),": c });",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," s = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," fruitSelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Select"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"options"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.keys(fruits)}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"current"),"=",n.a.createElement("span",{className:"hljs-string"},"{s.fruit}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"makeSelection"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.chooseFruit}"),n.a.createElement("br",null),"      />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," veggySelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Select"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"options"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.keys(vegetables)}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"current"),"=",n.a.createElement("span",{className:"hljs-string"},"{s.vegetable}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"makeSelection"),"=",n.a.createElement("span",{className:"hljs-string"},"{this.chooseVegetable}"),n.a.createElement("br",null),"      />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"center-block"'),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"maxWidth:"),' "',n.a.createElement("span",{className:"hljs-attr"},"800px"),';", ',n.a.createElement("span",{className:"hljs-attr"},"padding:"),' "',n.a.createElement("span",{className:"hljs-attr"},"1em"),';" }}',n.a.createElement("br",null),"      >"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          I posit that {fruitSelector} are {fruits[s.fruit]}!",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"br")," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          Also {veggySelector} are {vegetables[s.vegetable]}.",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"That is indeed much better! We still have lots of methods in our class, but the ",n.a.createElement("code",null,"render")," method is far less messy than before."),n.a.createElement("h3",{id:"underscore-intermission"},"Underscore intermission"),n.a.createElement("p",null,"Before we move on with the React ponderings, let's take an Underscore detour. Since we're already using the ",n.a.createElement("code",null,"_.partial")," curry function inside ",n.a.createElement("code",null,"Select"),", we could do it in ",n.a.createElement("code",null,"Opinion")," too to merge ",n.a.createElement("code",null,"chooseVegetable(opt)")," and ",n.a.createElement("code",null,"chooseFruit(opt)")," into a ",n.a.createElement("code",null,"choose(prop,opt)")," method:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Opinion = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"fruit"),": ",n.a.createElement("span",{className:"hljs-string"},'"apples"'),", ",n.a.createElement("span",{className:"hljs-attr"},"vegetable"),": ",n.a.createElement("span",{className:"hljs-string"},'"carrots"')," };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"choose"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"prop, c"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState(_.object([prop], [c]));",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," cb = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".choose,",n.a.createElement("br",null),"      s = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".state;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," fruitSelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Select"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"options"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.keys(fruits)}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"current"),"=",n.a.createElement("span",{className:"hljs-string"},"{s.fruit}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"makeSelection"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(cb,"),' "',n.a.createElement("span",{className:"hljs-attr"},"fruit"),'")}',n.a.createElement("br",null),"      />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," veggySelector = (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Select"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"options"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.keys(vegetables)}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"current"),"=",n.a.createElement("span",{className:"hljs-string"},"{s.vegetable}"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"makeSelection"),"=",n.a.createElement("span",{className:"hljs-string"},"{_.partial(cb,"),' "',n.a.createElement("span",{className:"hljs-attr"},"vegetable"),'")}',n.a.createElement("br",null),"      />")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"center-block"'),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"maxWidth:"),' "',n.a.createElement("span",{className:"hljs-attr"},"800px"),';", ',n.a.createElement("span",{className:"hljs-attr"},"padding:"),' "',n.a.createElement("span",{className:"hljs-attr"},"1em"),';" }}',n.a.createElement("br",null),"      >"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          I posit that {fruitSelector} are {fruits[s.fruit]}!",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"br")," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          Also {veggySelector} are {vegetables[s.vegetable]}.",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"Note the calls to ",n.a.createElement("code",null,"partial")," towards the end of the ",n.a.createElement("code",null,"fruitSelector")," and ",n.a.createElement("code",null,"veggySelector")," definitions."),n.a.createElement("p",null,"Inside ",n.a.createElement("code",null,"choose")," we use the ",n.a.createElement("code",null,"_.object")," method to create the argument to ",n.a.createElement("code",null,"setState"),". It takes two arrays, one of keys and one of values, and bakes these into an object. Thus calling it with ",n.a.createElement("code",null,'choose("fruit","apples")')," would cause ",n.a.createElement("code",null,'setState({fruit:"apples"})'),". This way we can create objects with a single line of code even when the key is dynamic."),n.a.createElement("h3",{id:"the-actual-problem"},"The actual problem"),n.a.createElement("p",null,"Now back to React. What was my problem with the code for ",n.a.createElement("code",null,"Opinion"),"? Especially the last version looks pretty sleek!"),n.a.createElement("p",null,"Here's my problem; The seeding of inital values (",n.a.createElement("code",null,"getInitialState"),") and the click handler (",n.a.createElement("code",null,"choose"),") are intimately connected to ",n.a.createElement("code",null,"Select"),". None is usable without the other two. This makes me want to package them all together! And since ",n.a.createElement("code",null,"Select")," is a component, it seems logical to somehow shove ",n.a.createElement("code",null,"choose")," and ",n.a.createElement("code",null,"getInitialState")," inside that component definition!"),n.a.createElement("p",null,"Why is that not easy? Well, because we need to deal with the state of the outer component. Then I remembered - I've been there before! As told in the ",n.a.createElement(c.a,{href:"/posts/reflux-refinement",prefetch:!0},n.a.createElement("a",null,"Reflux refinement"))," post, I made a syntax that reduced this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Cart = React.createClass({",n.a.createElement("br",null),"  mixins: [Reflux.ListenerMixin],",n.a.createElement("br",null),"  componentDidMount: ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),n.a.createElement("span",{className:"hljs-params"},"()")," "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".listenTo(appStore, ",n.a.createElement("span",{className:"hljs-keyword"},"this"),"._onStuffChange);",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// rest redacted"),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"...to this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Cart = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"mixins"),": [Reflux.listenTo(appStore, ",n.a.createElement("span",{className:"hljs-string"},'"_onStuffChange"'),")]",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// rest redacted"),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"Instead of a mixin I made a mixin factory. We pass the factory the data it needs to generate the ",n.a.createElement("code",null,"componentDidMount")," call for you, making the code far less boilerplaty."),n.a.createElement("h3",{id:"tried-and-trusted"},"Tried and trusted"),n.a.createElement("p",null,"Perchance we could use that same teqnique here? If we try to turn the ",n.a.createElement("code",null,"Select")," component into a mixin factory - what would the resulting mixin need to contain?"),n.a.createElement("ul",null,n.a.createElement("li",null,"We need to set the initial value (as currently done in ",n.a.createElement("code",null,"getInitialState"),")"),n.a.createElement("li",null,"We need a clickHandler that updates state (as currently done in ",n.a.createElement("code",null,"choose"),")"),n.a.createElement("li",null,"We need a way to render the select bar (as currently done in the ",n.a.createElement("code",null,"Select")," component)")),n.a.createElement("p",null,"To provide this, what does the mixin factory need to know?"),n.a.createElement("ul",null,n.a.createElement("li",null,"The name of the state property to use"),n.a.createElement("li",null,"The available options"),n.a.createElement("li",null,"What option is initially selected - unless we always start with the first, which I opted for here")),n.a.createElement("p",null,"Ok, so we'll have a signature like this: ",n.a.createElement("code",null,"Select(propname,options)")),n.a.createElement("p",null,"And the provided mixin object will look like this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"getInitialState"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("span",{className:"hljs-attr"},"propname"),":options[",n.a.createElement("span",{className:"hljs-number"},"0"),"]}",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"choose"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"opt"),")"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".setState({",n.a.createElement("span",{className:"hljs-attr"},"propname"),":opt})",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"renderbar"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"        // maploop blah blah",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"}")),n.a.createElement("h3",{id:"the-solution"},"The solution"),n.a.createElement("p",null,"Here's my Underscore-heavy solution for the factory mixin:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Select = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"name, opts"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," _.object(",n.a.createElement("br",null),"    [",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"getInitialState"'),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"Select"')," + name.charAt(",n.a.createElement("span",{className:"hljs-number"},"0"),").toUpperCase() + name.slice(",n.a.createElement("span",{className:"hljs-number"},"1"),")",n.a.createElement("br",null),"    ],",n.a.createElement("br",null),"    [",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"return")," _.object([name], [opts[",n.a.createElement("span",{className:"hljs-number"},"0"),"]]);",n.a.createElement("br",null),"      },",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"var")," me = ",n.a.createElement("span",{className:"hljs-built_in"},"this"),";",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"display:"),' "',n.a.createElement("span",{className:"hljs-attr"},"inline-block"),'" }}',n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),n.a.createElement("br",null),"          >"),n.a.createElement("br",null),"            {_.map(opts, function(g) {",n.a.createElement("br",null),"              return (",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button"),n.a.createElement("br",null),"                  ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{function()")," {",n.a.createElement("br",null),"                    ",n.a.createElement("span",{className:"hljs-attr"},"me.setState"),"(",n.a.createElement("span",{className:"hljs-attr"},"_.object"),"([",n.a.createElement("span",{className:"hljs-attr"},"name"),"], [",n.a.createElement("span",{className:"hljs-attr"},"g"),"]));",n.a.createElement("br",null),"                  }}",n.a.createElement("br",null),"                  ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),n.a.createElement("br",null),'                    "',n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),'" + (',n.a.createElement("span",{className:"hljs-attr"},"g")," === ",n.a.createElement("span",{className:"hljs-string"},"me.state[name]"),' ? " ',n.a.createElement("span",{className:"hljs-attr"},"active"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "")',n.a.createElement("br",null),"                  }",n.a.createElement("br",null),"                >"),n.a.createElement("br",null),"                  {g}",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"              );",n.a.createElement("br",null),"            })}",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"        );",n.a.createElement("br",null),"      }",n.a.createElement("br",null),"    ]",n.a.createElement("br",null),"  );",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"The string dancing up top is to make a better name than ",n.a.createElement("code",null,"renderbar")," - if the propname is ",n.a.createElement("code",null,"flower"),", the bar renderer will be ",n.a.createElement("code",null,"SelectFlower"),"."),n.a.createElement("p",null,"Here's what ",n.a.createElement("code",null,"Opinion")," looks like when using this mixin factory:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Opinion = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"mixins"),": [",n.a.createElement("br",null),"    Select(",n.a.createElement("span",{className:"hljs-string"},'"fruit"'),", _.keys(fruits)),",n.a.createElement("br",null),"    Select(",n.a.createElement("span",{className:"hljs-string"},'"vegetable"'),", _.keys(vegetables))",n.a.createElement("br",null),"  ],",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"center-block"'),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"maxWidth:"),' "',n.a.createElement("span",{className:"hljs-attr"},"800px"),';", ',n.a.createElement("span",{className:"hljs-attr"},"padding:"),' "',n.a.createElement("span",{className:"hljs-attr"},"1em"),';" }}',n.a.createElement("br",null),"      >"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          I posit that {this.SelectFruit()} are {fruits[this.state.fruit]}!",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"br")," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          Also {this.SelectVegetable()} are {vegetables[this.state.vegetable]}.",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("p",null,"And voil\xe0 - nothing is hanging out of the pants anymore, everything is isolated inside ",n.a.createElement("code",null,"Select"),". Our goal is achieved!"),n.a.createElement("h3",{id:"final-scare"},"Final scare"),n.a.createElement("p",null,"But as is always the case, the bad guy suddenly rises again! Happily cleaning up my code with the new mixin factory, my crusade suddenly ground to a halt when I arrived at a case where the options depended on the component properties. Translated to our example it would mean that ",n.a.createElement("code",null,"Opinion")," was rendered like this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},"<Opinion vegetables={vegetables} fruits={fruits} />")),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"vegetables")," and ",n.a.createElement("code",null,"fruits")," objects are passed as props to ",n.a.createElement("code",null,"Opinion")," by its parent. Thus inside the ",n.a.createElement("code",null,"Opinion")," definition we have no idea what the options are, and we can't make the call to the mixin factory!"),n.a.createElement("h3",{id:"passing-the-instance"},"Passing the instance"),n.a.createElement("p",null,"Since we depend on the properties, we can't make any call until we have access to them. That smells like we should be doing our thing inside the ",n.a.createElement("code",null,"componentWillMount")," method - at that point we can access ",n.a.createElement("code",null,"this.props"),", and the component isn't yet rendered. So we should be able to do something like this:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Opinion = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"componentWillMount"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    SelectSyntax2(",n.a.createElement("span",{className:"hljs-string"},'"fruit"'),", _.keys(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.fruits));",n.a.createElement("br",null),"    SelectSyntax2(",n.a.createElement("span",{className:"hljs-string"},'"vegetables"'),", _.keys(",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.vegetables));",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// rest redacted"),n.a.createElement("br",null),"});")),n.a.createElement("p",null,"Inside ",n.a.createElement("code",null,"SelectSyntax2")," we must update state to the initial value, and give access to the bar renderer. But hang on, to do that we must access the component instance! Previously we did that through using ",n.a.createElement("code",null,"this")," inside the various methods, since they became methods on the instance. But that's not the case now, and ",n.a.createElement("code",null,"this")," inside ",n.a.createElement("code",null,"SelectSyntax2")," points to god knows what!"),n.a.createElement("p",null,"Clearly we need to pass the instance into ",n.a.createElement("code",null,"SelectSyntax2"),", giving us the signature ",n.a.createElement("code",null,"SelectSyntax2(propname,opts,instance)"),". That would let us do what we need:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function")," ",n.a.createElement("span",{className:"hljs-title"},"SelectSyntax2"),"(",n.a.createElement("span",{className:"hljs-params"},"propname, opts, instance"),") "),"{",n.a.createElement("br",null),"  instance.setState(_.object([propname], [opts[",n.a.createElement("span",{className:"hljs-number"},"0"),"]]));",n.a.createElement("br",null),"  instance.renderbar = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"display:"),' "',n.a.createElement("span",{className:"hljs-attr"},"inline-block"),'" }} ',n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"        {_.map(opts, function(g) {",n.a.createElement("br",null),"          var handler = function() {",n.a.createElement("br",null),"            instance.setState(_.object([name], [g]));",n.a.createElement("br",null),"          };",n.a.createElement("br",null),"          var active = g === instance.state[name];",n.a.createElement("br",null),"          return (",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{handler}"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),'"',n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),'" + (',n.a.createElement("span",{className:"hljs-attr"},"active"),' ? " ',n.a.createElement("span",{className:"hljs-attr"},"active"),'" ',n.a.createElement("span",{className:"hljs-attr"},":"),' "")}',n.a.createElement("br",null),"            >"),n.a.createElement("br",null),"              {g}",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"          );",n.a.createElement("br",null),"        })}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  };",n.a.createElement("br",null),"}")),n.a.createElement("h3",{id:"2-in-1"},"2 in 1"),n.a.createElement("p",null,"Since the two use cases have different signatures, I opted to only have the one method and make it behave differently depending on whether or not the third argument (the instance) was provided. Here's my code:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"name,opts,instance"),")"),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// allow passing opts as an object, if so make the _.keys call here"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"var")," opts = _.isObject(opts) ? _.keys(opts) : opts;",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// build good renderer name"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"var")," rendername = ",n.a.createElement("span",{className:"hljs-string"},'"Select"'),"+name.charAt(",n.a.createElement("span",{className:"hljs-number"},"0"),").toUpperCase() + name.slice(",n.a.createElement("span",{className:"hljs-number"},"1"),")",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// create the renderer function"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"var")," renderer = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," me=",n.a.createElement("span",{className:"hljs-built_in"},"this"),";",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{display:"),'"',n.a.createElement("span",{className:"hljs-attr"},"inline-block"),'"}} ',n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"btn-group clearfix"'),">"),n.a.createElement("br",null),"          {_.map(opts,function(g){",n.a.createElement("br",null),"            return ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button")," ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{function(){"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"me.setState"),"(",n.a.createElement("span",{className:"hljs-attr"},"_.object"),"([",n.a.createElement("span",{className:"hljs-attr"},"name"),"],[",n.a.createElement("span",{className:"hljs-attr"},"g"),"]));",n.a.createElement("br",null),"            }} ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),"'",n.a.createElement("span",{className:"hljs-attr"},"btn")," ",n.a.createElement("span",{className:"hljs-attr"},"btn-default"),"'+(",n.a.createElement("span",{className:"hljs-attr"},"g"),"===",n.a.createElement("span",{className:"hljs-string"},"me.state[name]?"),"' ",n.a.createElement("span",{className:"hljs-attr"},"active"),"'",n.a.createElement("span",{className:"hljs-attr"},":"),"'')}>"),"{g}",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">"),n.a.createElement("br",null),"          })}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  };",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// second style syntax, attach renderer and set initial value"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (instance){",n.a.createElement("br",null),"    instance[rendername] = renderer;",n.a.createElement("br",null),"    instance.setState(_.object([name],[opts[",n.a.createElement("span",{className:"hljs-number"},"0"),"]]));",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// mixin syntax, return object with getInitialState and renderer"),n.a.createElement("br",null),"  } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," _.object(",n.a.createElement("br",null),"      [",n.a.createElement("span",{className:"hljs-string"},'"getInitialState"'),", rendername],",n.a.createElement("br",null),"      [",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),")"),"{",n.a.createElement("span",{className:"hljs-keyword"},"return")," _.object([name],[opts[",n.a.createElement("span",{className:"hljs-number"},"0"),"]])}, renderer]",n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"It is actually safe to use ",n.a.createElement("code",null,"this")," to access the component even in the second syntax, since the renderer will be called as a method on the instance."),n.a.createElement("p",null,"Here's the full code for ",n.a.createElement("code",null,"Opinion")," using the second syntax:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," List = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"componentWillMount"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    Select(",n.a.createElement("span",{className:"hljs-string"},'"fruit"'),", ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.fruits, ",n.a.createElement("span",{className:"hljs-built_in"},"this"),");",n.a.createElement("br",null),"    Select(",n.a.createElement("span",{className:"hljs-string"},'"vegetable"'),", ",n.a.createElement("span",{className:"hljs-built_in"},"this"),".props.vegetables, ",n.a.createElement("span",{className:"hljs-built_in"},"this"),");",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"center-block"'),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"style"),"=",n.a.createElement("span",{className:"hljs-string"},"{{")," ",n.a.createElement("span",{className:"hljs-attr"},"maxWidth:"),' "',n.a.createElement("span",{className:"hljs-attr"},"800px"),';", ',n.a.createElement("span",{className:"hljs-attr"},"padding:"),' "',n.a.createElement("span",{className:"hljs-attr"},"1em"),';" }}',n.a.createElement("br",null),"      >"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          I posit that {this.SelectFruit()} are {fruits[this.state.fruit]}!",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"br")," />"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"          Also {this.SelectVegetable()} are {vegetables[this.state.vegetable]}.",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});")),n.a.createElement("h3",{id:"wrapping-up"},"Wrapping up"),n.a.createElement("p",null,"As is my habit I took so long detailing the journey that the point risk being lost. The point is this: ",n.a.createElement("strong",null,"Using mixin factories can often be a very powerful way to package concerns together"),", especially when you find that using a component forces you to implement cruft methods in the parent."),n.a.createElement("p",null,"Since discovering the pattern I've used it in many different places, and it's a tool I'm particularly happy to have in my belt. I hope you find use for it too!")),n.a.createElement("hr",null))}}},[["Ngo3",1,0]]]);