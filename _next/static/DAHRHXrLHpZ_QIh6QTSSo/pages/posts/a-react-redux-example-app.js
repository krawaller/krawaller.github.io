(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{WlKn:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/a-react-redux-example-app",function(){var e=t("ruxB");return{page:e.default||e}}])},ruxB:function(e,a,t){"use strict";t.r(a);var l=t("q1tI"),n=t.n(l),s=t("JRaF"),r=t("YFqc"),c=t.n(r),m={url:"a-react-redux-example-app",id:"superheroes",title:"A React-Redux example app",author:"david",tags:["react","redux","case study"],date:"2015-10-29",excerpt:"Dissecting a small React-Redux example application",type:"post",folder:"/Users/davidwaller/gitreps/mine/blog2/sources/2015-10-29_superheroes",hasStaticContent:!0,headlines:[{level:3,text:"The Superhero battler app",id:"the-superhero-battler-app"},{level:3,text:"Under the hood",id:"under-the-hood"},{level:3,text:"Data model",id:"data-model"},{level:3,text:"Mutating the data",id:"mutating-the-data"},{level:3,text:"Components",id:"components"},{level:3,text:"Getting dirty",id:"getting-dirty"},{level:3,text:"Wrapping up",id:"wrapping-up"}]};a.default=function(){return n.a.createElement(s.a,{kind:"post",data:m,title:"A React-Redux example app",summary:"Dissecting a small React-Redux example application",headlines:[{level:3,text:"The Superhero battler app",id:"the-superhero-battler-app"},{level:3,text:"Under the hood",id:"under-the-hood"},{level:3,text:"Data model",id:"data-model"},{level:3,text:"Mutating the data",id:"mutating-the-data"},{level:3,text:"Components",id:"components"},{level:3,text:"Getting dirty",id:"getting-dirty"},{level:3,text:"Wrapping up",id:"wrapping-up"}],tags:["react","redux","case study"]},n.a.createElement("div",{className:"post","data-postid":"superheroes"},n.a.createElement("p",null,n.a.createElement("span",{style:{color:"red"}},n.a.createElement("strong",null,"Note"),": This example app has a bug due to bad flow design. See the explanation and the solution in ",n.a.createElement(c.a,{href:"/posts/a-react-redux-example-followup",prefetch:!0},n.a.createElement("a",null,"this follow-up post")),"!")),n.a.createElement("h3",{id:"the-superhero-battler-app"},"The Superhero battler app"),n.a.createElement("p",null,"This post presents a simple React-Redux example app. The aim was to have a small example to complement the official Redux ones, that is also more portable. It uses React, Redux, React-Router, React-Redux and browserify. And (almost) no ES6 syntax."),n.a.createElement("p",null,'Instead of the venerable ToDo, the app is a tiny "game" where superheroes battle it out until there\'s only one left standing:'),n.a.createElement("iframe",{src:"https://blog.krawaller.se/riastart2015/index.html",style:{height:500,width:"100%"}}),n.a.createElement("p",null,"The url for the app is ",n.a.createElement("a",{href:"https://blog.krawaller.se/riastart2015/"},"https://blog.krawaller.se/riastart2015/"),", and the source code is at ",n.a.createElement("a",{href:"https://github.com/krawaller/riastart2015"},"https://github.com/krawaller/riastart2015"),"."),n.a.createElement("p",null,"Kick the tires for a bit so you get a feel for what's going on, then read on to see how it is all put together!"),n.a.createElement("h3",{id:"under-the-hood"},"Under the hood"),n.a.createElement("p",null,"These are the involved files (along with ",n.a.createElement("code",null,"index.html")," and the generated ",n.a.createElement("code",null,"bundle.js"),"):"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/a-react-redux-example-app/img/superherofiles.png",alt:"components"})),n.a.createElement("p",null,"Before we look at the components, let's examine the main plumbing first. The entry point is ",n.a.createElement("code",null,"index.js"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ReactDOM = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-dom"'),"),",n.a.createElement("br",null),"  Router = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Router,",n.a.createElement("br",null),"  Provider = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-redux"'),").Provider,",n.a.createElement("br",null),"  store = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./store"'),"),",n.a.createElement("br",null),"  routes = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./routes"'),");",n.a.createElement("br",null),n.a.createElement("br",null),"ReactDOM.render(",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// The top-level Provider is what allows us to `connect` components to the store"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// using ReactRedux.connect (see components Home and Hero)"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Provider")," ",n.a.createElement("span",{className:"hljs-attr"},"store"),"=",n.a.createElement("span",{className:"hljs-string"},"{store}"),">"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Router")," ",n.a.createElement("span",{className:"hljs-attr"},"routes"),"=",n.a.createElement("span",{className:"hljs-string"},"{routes}")," />"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"Provider"),">"),",",n.a.createElement("br",null),'  document.getElementById("root")',n.a.createElement("br",null),");"))),n.a.createElement("p",null,"In here we load ",n.a.createElement("code",null,"routes.js"),", hook up ",n.a.createElement("code",null,"store.js"),", and feed it all to ",n.a.createElement("code",null,"ReactDOM.render"),"!"),n.a.createElement("h3",{id:"data-model"},"Data model"),n.a.createElement("p",null,"Now we enter Redux land! I won't go into too much detail on how Redux works, as ",n.a.createElement("a",{href:"http://redux.js.org/"},"the official docs")," are just marvelous at doing that. Instead we'll focus on how this app uses Redux."),n.a.createElement("p",null,"Here's what our store (in Redux there's only one) looks like:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," Redux = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"redux"'),"),",n.a.createElement("br",null),"  heroReducer = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./reducers/heroes"'),"),",n.a.createElement("br",null),"  battlefieldReducer = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./reducers/battlefield"'),"),",n.a.createElement("br",null),"  initialState = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./initialstate"'),"),",n.a.createElement("br",null),"  thunk = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"redux-thunk"'),"); ",n.a.createElement("span",{className:"hljs-comment"},"// allows us to use asynchronous actions"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," rootReducer = Redux.combineReducers({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"heroes"),": heroReducer, ",n.a.createElement("span",{className:"hljs-comment"},"// this means heroReducer will operate on appState.heroes"),n.a.createElement("br",null),"  battlefield: battlefieldReducer ",n.a.createElement("span",{className:"hljs-comment"},"// battlefieldReducer will operate on appState.battlefield,"),n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Redux.applyMiddleware(thunk)(Redux.createStore)(",n.a.createElement("br",null),"  rootReducer,",n.a.createElement("br",null),"  initialState()",n.a.createElement("br",null),");")),n.a.createElement("p",null,"There are some weird parts to this, but what's relevant for our app is ",n.a.createElement("code",null,"initialstate")," and the two reducers, ",n.a.createElement("code",null,"heroReducer")," and ",n.a.createElement("code",null,"battlefieldReducer"),"."),n.a.createElement("p",null,"Let's peek at ",n.a.createElement("code",null,"initialstate")," first, as that will also serve as a picture of what the app data model looks like:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./constants"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"heroes"),": {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"batman"),": {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"quote"),": ",n.a.createElement("span",{className:"hljs-string"},'"I\'m batman."'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"kills"),": ",n.a.createElement("span",{className:"hljs-number"},"0"),n.a.createElement("br",null),"      },",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"superman"),": {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"quote"),": ",n.a.createElement("span",{className:"hljs-string"},'"I can fly!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"kills"),": ",n.a.createElement("span",{className:"hljs-number"},"0"),n.a.createElement("br",null),"      },",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"spiderman"),": {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"quote"),": ",n.a.createElement("span",{className:"hljs-string"},'"Why don\'t you love me, Lois?"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"kills"),": ",n.a.createElement("span",{className:"hljs-number"},"0"),n.a.createElement("br",null),"      },",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-string"},'"he-man"'),": {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"quote"),": ",n.a.createElement("span",{className:"hljs-string"},'"By the power of Grayskull!"'),",",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"kills"),": ",n.a.createElement("span",{className:"hljs-number"},"0"),n.a.createElement("br",null),"      }",n.a.createElement("br",null),"    },",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"battlefield"),": {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"doing"),": {",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"batman"),": C.WAITING,",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"superman"),": C.WAITING,",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-attr"},"spiderman"),": C.WAITING,",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-string"},'"he-man"'),": C.WAITING",n.a.createElement("br",null),"      },",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"standing"),": ",n.a.createElement("span",{className:"hljs-number"},"4"),",",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"log"),": [",n.a.createElement("span",{className:"hljs-string"},'"Ready.... fight!"'),"]",n.a.createElement("br",null),"    }",n.a.createElement("br",null),"  };",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"As you can see there are two main parts to the data; ",n.a.createElement("code",null,"heroes")," and ",n.a.createElement("code",null,"battlefield"),". These parts correspond to the two reducers you saw earlier in the store file."),n.a.createElement("p",null,"The constants file is merely just that, a list of constants:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs"},"module.exports = {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// ACTION TYPES"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    AIM_AT:")," ",n.a.createElement("span",{className:"hljs-string"},'"AIM_AT"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    KILL_HERO:")," ",n.a.createElement("span",{className:"hljs-string"},'"KILL_HERO"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    RESET:")," ",n.a.createElement("span",{className:"hljs-string"},'"RESET"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    DUCK_DOWN:")," ",n.a.createElement("span",{className:"hljs-string"},'"DUCK_DOWN"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    STAND_UP:")," ",n.a.createElement("span",{className:"hljs-string"},'"STAND_UP"'),",",n.a.createElement("br",null),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// HERO STATUSES"),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    AIMING:")," ",n.a.createElement("span",{className:"hljs-string"},'"AIMING"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    DUCKING:")," ",n.a.createElement("span",{className:"hljs-string"},'"DUCKING"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    WAITING:")," ",n.a.createElement("span",{className:"hljs-string"},'"WAITING"'),",",n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-symbol"},"    DEAD:")," ",n.a.createElement("span",{className:"hljs-string"},'"DEAD"'),n.a.createElement("br",null),"};")),n.a.createElement("h3",{id:"mutating-the-data"},"Mutating the data"),n.a.createElement("p",null,"Now we've seen what the data looks like; how is it updated? Through ",n.a.createElement("code",null,"actions"),", that's how! Here's what the action creators for our app looks like:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," constants = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./constants"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = {",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"reset"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// A normal action creator, returns a simple object describing the action."),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"type"),": constants.RESET };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"duckDown"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"who"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// here we take advantage of Redux-thunk; instead of returning an object describing an action,"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// we return a function that takes dispatch and getState as arguments. This function can then"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// invoke dispatch, now or later using setTimeout or similar."),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"dispatch, getState"),") "),"{",n.a.createElement("br",null),"      dispatch({ ",n.a.createElement("span",{className:"hljs-attr"},"type"),": constants.DUCK_DOWN, ",n.a.createElement("span",{className:"hljs-attr"},"coward"),": who });",n.a.createElement("br",null),"      setTimeout(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"        dispatch({ ",n.a.createElement("span",{className:"hljs-attr"},"type"),": constants.STAND_UP, ",n.a.createElement("span",{className:"hljs-attr"},"coward"),": who });",n.a.createElement("br",null),"      }, ",n.a.createElement("span",{className:"hljs-number"},"2000"),");",n.a.createElement("br",null),"    };",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"aimAt"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"killer, victim"),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// Another async action using the Redux-thunk syntax"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"dispatch, getState"),") "),"{",n.a.createElement("br",null),"      dispatch({ ",n.a.createElement("span",{className:"hljs-attr"},"type"),": constants.AIM_AT, ",n.a.createElement("span",{className:"hljs-attr"},"killer"),": killer, ",n.a.createElement("span",{className:"hljs-attr"},"victim"),": victim });",n.a.createElement("br",null),"      setTimeout(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"        dispatch({ ",n.a.createElement("span",{className:"hljs-attr"},"type"),": constants.KILL_HERO, ",n.a.createElement("span",{className:"hljs-attr"},"killer"),": killer, ",n.a.createElement("span",{className:"hljs-attr"},"victim"),": victim });",n.a.createElement("br",null),"      }, ",n.a.createElement("span",{className:"hljs-number"},"2000"),");",n.a.createElement("br",null),"    };",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"These functions will be used inside components in response to user events. But before we look at those, let's see what happens when they are invoked - that magic is all in the reducers!"),n.a.createElement("p",null,"First off the ",n.a.createElement("code",null,"heroReducer"),", as that is by far the simplest. The only thing it does is increase the kill count whenever a hero kills another."),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../constants"'),"),",n.a.createElement("br",null),"  initialState = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../initialstate"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"state, action"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"var")," newstate = ",n.a.createElement("span",{className:"hljs-built_in"},"Object"),".assign({}, state); ",n.a.createElement("span",{className:"hljs-comment"},"// sloppily copying the old state here, so we never mutate it"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"switch")," (action.type) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.KILL_HERO:",n.a.createElement("br",null),"      newstate[action.killer].kills += ",n.a.createElement("span",{className:"hljs-number"},"1"),";",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"default"),":",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," state || initialState().heroes;",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"The ",n.a.createElement("code",null,"battlefieldReducer"),", however, has far more responsibilities!"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," C = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../constants"'),"),",n.a.createElement("br",null),"  initialState = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../initialstate"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"state, action"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"var")," newstate = ",n.a.createElement("span",{className:"hljs-built_in"},"Object"),".assign({}, state); ",n.a.createElement("span",{className:"hljs-comment"},"// sloppily copying the old state here, so we never mutate it"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"switch")," (action.type) {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.DUCK_DOWN:",n.a.createElement("br",null),"      newstate.doing[action.coward] = C.DUCKING;",n.a.createElement("br",null),"      newstate.log.push(action.coward + ",n.a.createElement("span",{className:"hljs-string"},'" ducks down like a coward."'),");",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.STAND_UP:",n.a.createElement("br",null),"      newstate.doing[action.coward] = C.WAITING;",n.a.createElement("br",null),"      newstate.log.push(action.coward + ",n.a.createElement("span",{className:"hljs-string"},'" stands back up."'),");",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.AIM_AT:",n.a.createElement("br",null),"      newstate.doing[action.killer] = C.AIMING;",n.a.createElement("br",null),"      newstate.log.push(action.killer + ",n.a.createElement("span",{className:"hljs-string"},'" takes aim at "')," + action.victim + ",n.a.createElement("span",{className:"hljs-string"},'"!"'),");",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.KILL_HERO:",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// the shooter has died before he got the shot off"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.killer] === C.DEAD) {",n.a.createElement("br",null),"        newstate.log.push(",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-string"},'"The trigger finger twitches on "')," + action.killer + ",n.a.createElement("span",{className:"hljs-string"},'"\'s corpse"'),n.a.createElement("br",null),"        );",n.a.createElement("br",null),"      } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"        newstate.doing[action.killer] = C.WAITING;",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-comment"},"// the target is ducking"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.DUCKING) {",n.a.createElement("br",null),"          newstate.log.push(",n.a.createElement("br",null),"            action.victim + ",n.a.createElement("span",{className:"hljs-string"},'" dodges a blast from "')," + action.killer + ",n.a.createElement("span",{className:"hljs-string"},'"!"'),n.a.createElement("br",null),"          );",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-comment"},"// the target has already been killed"),n.a.createElement("br",null),"        } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.DEAD) {",n.a.createElement("br",null),"          newstate.log.push(",n.a.createElement("br",null),"            action.killer + ",n.a.createElement("span",{className:"hljs-string"},'" blasts "')," + action.victim + ",n.a.createElement("span",{className:"hljs-string"},'"\'s corpse."'),n.a.createElement("br",null),"          );",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-comment"},"// we kill the target!"),n.a.createElement("br",null),"        } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (state.doing[action.victim] === C.AIMING) {",n.a.createElement("br",null),"            newstate.log.push(",n.a.createElement("br",null),"              action.killer +",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-string"},'" killed "')," +",n.a.createElement("br",null),"                action.victim +",n.a.createElement("br",null),"                ",n.a.createElement("span",{className:"hljs-string"},'" before he got his shot off!"'),n.a.createElement("br",null),"            );",n.a.createElement("br",null),"          } ",n.a.createElement("span",{className:"hljs-keyword"},"else")," {",n.a.createElement("br",null),"            newstate.log.push(action.killer + ",n.a.createElement("span",{className:"hljs-string"},'" killed "')," + action.victim + ",n.a.createElement("span",{className:"hljs-string"},'"!"'),");",n.a.createElement("br",null),"          }",n.a.createElement("br",null),"          newstate.doing[action.victim] = C.DEAD;",n.a.createElement("br",null),"          newstate.standing = newstate.standing - ",n.a.createElement("span",{className:"hljs-number"},"1"),";",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"if")," (newstate.standing === ",n.a.createElement("span",{className:"hljs-number"},"1"),") {",n.a.createElement("br",null),"            newstate.log.push(action.killer + ",n.a.createElement("span",{className:"hljs-string"},'" WINS!!"'),");",n.a.createElement("br",null),"          }",n.a.createElement("br",null),"        }",n.a.createElement("br",null),"      }",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," newstate;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"case")," C.RESET:",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," initialState().battlefield;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"default"),":",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-keyword"},"return")," state || initialState().battlefield;",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"};")),n.a.createElement("p",null,"Please take a moment to look at the various cases, and connect it to how the app behaved when you tested it earlier!"),n.a.createElement("h3",{id:"components"},"Components"),n.a.createElement("p",null,"The app are made up by these components:"),n.a.createElement("p",null,n.a.createElement("img",{src:"/static/posts/a-react-redux-example-app/img/superherocomponents.png",alt:"components"})),n.a.createElement("p",null,"The hierarchy isn't strictly true as ",n.a.createElement("code",null,"Hero")," and ",n.a.createElement("code",null,"Home")," are served through ",n.a.createElement("code",null,"routes"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ReactRouter = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-router"'),"),",n.a.createElement("br",null),"  Route = ReactRouter.Route,",n.a.createElement("br",null),"  IndexRoute = ReactRouter.IndexRoute,",n.a.createElement("br",null),"  Wrapper = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./components/wrapper"'),"),",n.a.createElement("br",null),"  Home = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./components/home"'),"),",n.a.createElement("br",null),"  Hero = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./components/hero"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = (",n.a.createElement("br",null),'  <Route path="/" component={Wrapper}>',n.a.createElement("br",null),"    <IndexRoute component={Home} />",n.a.createElement("br",null),'    <Route path="/hero/:name" component={Hero} />',n.a.createElement("br",null),"  </Route>",n.a.createElement("br",null),");")),n.a.createElement("p",null,"The app only has two routes, either we're in the main battle arena or we are in a closeup of one of the heroes."),n.a.createElement("p",null,n.a.createElement("code",null,"Wrapper")," doesn't do anything exciting, it simply renders out the children:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Wrapper = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"wrapper"'),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"h2"),">"),"Superhero battle arena 2000!",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"h2"),">"),n.a.createElement("br",null),"        {this.props.children}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Wrapper;")),n.a.createElement("p",null,"For slightly higher excitement let's take a look at ",n.a.createElement("code",null,"Hero"),", our first Redux-aware component:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ptypes = React.PropTypes,",n.a.createElement("br",null),"  Link = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Link,",n.a.createElement("br",null),"  ReactRedux = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-redux"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Hero = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"params"),": ptypes.shape({ ",n.a.createElement("span",{className:"hljs-attr"},"name"),": ptypes.string.isRequired }).isRequired, ",n.a.createElement("span",{className:"hljs-comment"},"// will be provided by react-router"),n.a.createElement("br",null),"    heroes: ptypes.object.isRequired ",n.a.createElement("span",{className:"hljs-comment"},"// will be provided by react-redux"),n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," name = ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props.params.name,",n.a.createElement("br",null),"      data = ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props.heroes[name];",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Link")," ",n.a.createElement("span",{className:"hljs-attr"},"to"),"=",n.a.createElement("span",{className:"hljs-string"},'"/"'),">"),"Back to arena",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"Link"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),"Here's some info on {this.props.params.name}:",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"strong"),">"),"Quote:",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"strong"),">"),' {data.quote}{" "}',n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"strong"),">"),"Kills:",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"strong"),">"),' {data.kills}{" "}',n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"p"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-comment"},"// connect to Redux store"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," mapStateToProps = ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"state"),") "),"{",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-comment"},"// This component will have access to `appstate.heroes` through `this.props.heroes`"),n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-keyword"},"return")," { ",n.a.createElement("span",{className:"hljs-attr"},"heroes"),": state.heroes };",n.a.createElement("br",null),"};",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = ReactRedux.connect(mapStateToProps)(Hero);")),n.a.createElement("p",null,"Through ",n.a.createElement("code",null,"ReactRedux")," we give the component access to the ",n.a.createElement("code",null,"battlefield")," part of the app state. The component can the use that just as any other property data served down from a higher-level component."),n.a.createElement("p",null,"Using ",n.a.createElement("code",null,"ReactRouter")," we learn the name of the current hero we've navigated to (there should probably be some error checking in there though), and then we can dig out the correct data."),n.a.createElement("h3",{id:"getting-dirty"},"Getting dirty"),n.a.createElement("p",null,"On to the next Redux-aware component - ",n.a.createElement("code",null,"Home"),", which is the main battle arena!"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ptypes = React.PropTypes,",n.a.createElement("br",null),"  ReactRedux = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-redux"'),"),",n.a.createElement("br",null),"  Log = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./log"'),"),",n.a.createElement("br",null),"  Battlers = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./battlers"'),"),",n.a.createElement("br",null),"  actions = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../actions"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Home = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// redux store state, imported below"),n.a.createElement("br",null),"    battle: ptypes.shape({",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"doing"),": ptypes.object.isRequired,",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-attr"},"log"),": ptypes.arrayOf(ptypes.string)",n.a.createElement("br",null),"    }).isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"// redux action hookups, set up below"),n.a.createElement("br",null),"    kill: ptypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"reset"),": ptypes.func.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," battleprops = ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props.battle;",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      <div>",n.a.createElement("br",null),"        <Battlers",n.a.createElement("br",null),"          doing={battleprops.doing}",n.a.createElement("br",null),"          kill={this.props.kill}",n.a.createElement("br",null),"          duck={this.props.duck}",n.a.createElement("br",null),"        />",n.a.createElement("br",null),"        <Log log={battleprops.log} />",n.a.createElement("br",null),"        {battleprops.standing === 1 && (",n.a.createElement("br",null),"          <button onClick={this.props.reset}>Reset</button>",n.a.createElement("br",null),"        )}",n.a.createElement("br",null),"      </div>",n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),"// now we connect the component to the Redux store:",n.a.createElement("br",null),n.a.createElement("br",null),"var mapStateToProps = function(state) {",n.a.createElement("br",null),"  // This component will have access to `state.battlefield` through `this.props.battle`",n.a.createElement("br",null),"  return { battle: state.battlefield };",n.a.createElement("br",null),"};",n.a.createElement("br",null),n.a.createElement("br",null),"var mapDispatchToProps = function(dispatch) {",n.a.createElement("br",null),"  return {",n.a.createElement("br",null),"    kill: function(killer, victim) {",n.a.createElement("br",null),"      dispatch(actions.aimAt(killer, victim));",n.a.createElement("br",null),"    },",n.a.createElement("br",null),"    duck: function(coward) {",n.a.createElement("br",null),"      dispatch(actions.duckDown(coward));",n.a.createElement("br",null),"    },",n.a.createElement("br",null),"    reset: function() {",n.a.createElement("br",null),"      dispatch(actions.reset());",n.a.createElement("br",null),"    }",n.a.createElement("br",null),"  };",n.a.createElement("br",null),"};",n.a.createElement("br",null),n.a.createElement("br",null),"module.exports = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(Home);")),n.a.createElement("p",null,"Like before we connect it to the Redux Store, but unlike before we also import the action creators we saw earlier to use as callbacks!"),n.a.createElement("p",null,"Of these, ",n.a.createElement("code",null,"reset")," is used in this very component while ",n.a.createElement("code",null,"kill")," and ",n.a.createElement("code",null,"duck")," are passed down to the ",n.a.createElement("code",null,"Battlers")," component:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ptypes = React.PropTypes,",n.a.createElement("br",null),"  Battler = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"./battler"'),"),",n.a.createElement("br",null),"  _ = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"lodash"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Battlers = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"kill"),": ptypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"doing"),": ptypes.object.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," p = ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props,",n.a.createElement("br",null),"      boxes = _.map(",n.a.createElement("br",null),"        p.doing,",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"doing, name"),") "),"{",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"var")," kill = p.kill.bind(",n.a.createElement("span",{className:"hljs-keyword"},"this"),", name), ",n.a.createElement("span",{className:"hljs-comment"},"// prefill the kill method so that killer is always `name`"),n.a.createElement("br",null),"            duck = p.duck.bind(",n.a.createElement("span",{className:"hljs-keyword"},"this"),", name); ",n.a.createElement("span",{className:"hljs-comment"},"// make sure battler can only duck himself"),n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Battler"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{name}"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"name"),"=",n.a.createElement("span",{className:"hljs-string"},"{name}"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"doing"),"=",n.a.createElement("span",{className:"hljs-string"},"{p.doing}"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"kill"),"=",n.a.createElement("span",{className:"hljs-string"},"{kill}"),n.a.createElement("br",null),"              ",n.a.createElement("span",{className:"hljs-attr"},"duck"),"=",n.a.createElement("span",{className:"hljs-string"},"{duck}"),n.a.createElement("br",null),"            />"),n.a.createElement("br",null),"          );",n.a.createElement("br",null),"        },",n.a.createElement("br",null),"        this",n.a.createElement("br",null),"      );",n.a.createElement("br",null),"    return ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"battlers"'),">"),"{boxes}",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),";",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),"module.exports = Battlers;"))),n.a.createElement("p",null,"This components renders a ",n.a.createElement("code",null,"Battler")," component for each super hero, giving them their name, personalized versions of ",n.a.createElement("code",null,"kill")," and ",n.a.createElement("code",null,"duck"),", as well as the full ",n.a.createElement("code",null,"doing")," object containing the status of everyone. Here's the code for ",n.a.createElement("code",null,"Battler"),":"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ptypes = React.PropTypes,",n.a.createElement("br",null),"  _ = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"lodash"'),"),",n.a.createElement("br",null),"  Link = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react-router"'),").Link,",n.a.createElement("br",null),"  C = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"../constants"'),");",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Battler = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"name"),": ptypes.string.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"kill"),": ptypes.func.isRequired,",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"duck"),": ptypes.func.isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," p = ",n.a.createElement("span",{className:"hljs-keyword"},"this"),".props,",n.a.createElement("br",null),"      name = p.name,",n.a.createElement("br",null),"      doing = p.doing,",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// list all enemies that aren't dead yet"),n.a.createElement("br",null),"      killable = _.reduce(",n.a.createElement("br",null),"        doing,",n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"list, status, opp"),") "),"{",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"return")," status !== C.DEAD && opp !== name ? list.concat(opp) : list;",n.a.createElement("br",null),"        },",n.a.createElement("br",null),"        []",n.a.createElement("br",null),"      ),",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// make buttons for all killable enemies"),n.a.createElement("br",null),"      buttons = killable",n.a.createElement("br",null),"        .map(",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"},"opp"),") "),"{",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button")," ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{opp}")," ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{p.kill.bind(this,")," ",n.a.createElement("span",{className:"hljs-attr"},"opp"),")}>"),n.a.createElement("br",null),'              {"Kill " + opp}',n.a.createElement("br",null),"            ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">")),n.a.createElement("br",null),"          );",n.a.createElement("br",null),"        }, ",n.a.createElement("span",{className:"hljs-keyword"},"this"),")",n.a.createElement("br",null),"        .concat(",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"button")," ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},'"duck"')," ",n.a.createElement("span",{className:"hljs-attr"},"onClick"),"=",n.a.createElement("span",{className:"hljs-string"},"{p.duck}"),">"),n.a.createElement("br",null),"            duck",n.a.createElement("br",null),"          ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"button"),">")),n.a.createElement("br",null),"        );",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-comment"},"//controls depend on what we're doing"),n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"var")," controls = {",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-comment"},"// using ES6 syntax for dynamic object properties"),n.a.createElement("br",null),"      [C.WAITING]: buttons.length > ",n.a.createElement("span",{className:"hljs-number"},"1")," ? buttons : ",n.a.createElement("span",{className:"hljs-string"},'"Winner!!"'),",",n.a.createElement("br",null),"      [C.DUCKING]: ",n.a.createElement("span",{className:"hljs-string"},'"ducking"'),",",n.a.createElement("br",null),"      [C.DEAD]: ",n.a.createElement("span",{className:"hljs-string"},'"...dead..."'),",",n.a.createElement("br",null),"      [C.AIMING]: ",n.a.createElement("span",{className:"hljs-string"},'"aiming!"'),n.a.createElement("br",null),"    }[p.doing[name]];",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div")," ",n.a.createElement("span",{className:"hljs-attr"},"className"),"=",n.a.createElement("span",{className:"hljs-string"},'"battler"'),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"Link")," ",n.a.createElement("span",{className:"hljs-attr"},"to"),"=",n.a.createElement("span",{className:"hljs-string"},"{"),'"/',n.a.createElement("span",{className:"hljs-attr"},"hero"),'/" + ',n.a.createElement("span",{className:"hljs-attr"},"name"),"}>"),"{name}",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"Link"),">"),n.a.createElement("br",null),"        ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"div"),">"),"{controls}",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">"),n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"div"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Battler;")),n.a.createElement("p",null,"Here we finally hook up ",n.a.createElement("code",null,"kill")," and ",n.a.createElement("code",null,"duck")," to user interactions."),n.a.createElement("p",null,"For completion's sake let's also list the code for ",n.a.createElement("code",null,"Log"),", although there's nothing much going on there:"),n.a.createElement("pre",null,n.a.createElement("code",{className:"hljs language-javascript"},n.a.createElement("span",{className:"hljs-keyword"},"var")," React = ",n.a.createElement("span",{className:"hljs-built_in"},"require"),"(",n.a.createElement("span",{className:"hljs-string"},'"react"'),"),",n.a.createElement("br",null),"  ptypes = React.PropTypes;",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-keyword"},"var")," Log = React.createClass({",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"propTypes"),": {",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-attr"},"log"),": ptypes.arrayOf(ptypes.string).isRequired",n.a.createElement("br",null),"  },",n.a.createElement("br",null),"  ",n.a.createElement("span",{className:"hljs-attr"},"render"),": ",n.a.createElement("span",{className:"hljs-function"},n.a.createElement("span",{className:"hljs-keyword"},"function"),"(",n.a.createElement("span",{className:"hljs-params"}),") "),"{",n.a.createElement("br",null),"    ",n.a.createElement("span",{className:"hljs-keyword"},"return")," (",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"xml"},n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"ul"),">"),n.a.createElement("br",null),"        {this.props.log.map(function(txt, n) {",n.a.createElement("br",null),"          return ",n.a.createElement("span",{className:"hljs-tag"},"<",n.a.createElement("span",{className:"hljs-name"},"li")," ",n.a.createElement("span",{className:"hljs-attr"},"key"),"=",n.a.createElement("span",{className:"hljs-string"},"{n}"),">"),"{txt}",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"li"),">"),";",n.a.createElement("br",null),"        })}",n.a.createElement("br",null),"      ",n.a.createElement("span",{className:"hljs-tag"},"</",n.a.createElement("span",{className:"hljs-name"},"ul"),">")),n.a.createElement("br",null),"    );",n.a.createElement("br",null),"  }",n.a.createElement("br",null),"});",n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("span",{className:"hljs-built_in"},"module"),".exports = Log;")),n.a.createElement("h3",{id:"wrapping-up"},"Wrapping up"),n.a.createElement("p",null,"As warned I didn't explain much about how Redux works, but again, the ",n.a.createElement("a",{href:"http://redux.js.org/"},"official docs")," are really brilliant. But I hope this hands-on example helped you learn what I have; that Redux, although tiny, is one beast of a data flow library!")),n.a.createElement("hr",null))}}},[["WlKn",1,0]]]);