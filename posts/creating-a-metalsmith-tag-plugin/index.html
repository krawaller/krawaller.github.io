<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/static/styles/nprogress.css"/><link rel="stylesheet" href="/static/styles/code.css"/><link rel="stylesheet" href="/static/styles/site.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Lexend+Zetta&amp;display=swap" rel="stylesheet"/><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-11433118-1', 'auto');
  ga("send", "pageview");</script><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>Creating a Metalsmith tag plugin</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/creating-a-metalsmith-tag-plugin.js" as="script"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ebbfd942159f83091516.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-c1620565ee9f1f33603c.js" as="script"/></head><body><div id="__next"><div style="margin-bottom:20px"></div><div class="master"><h1><a href="/"><span>k</span><span>r</span><span>a</span><span>w</span><span>a</span><span>l</span><span>l</span><span>e</span><span>r</span></a></h1><hr/><div class="summary">A walkthrough of creating a tag plugin for Metalsmith and some accompanying Handlebars helpers</div><hr/><h2>Creating a Metalsmith tag plugin</h2><p class="taglist">Tags:<!-- --> <a href="/tags/metalsmith/">metalsmith</a><a href="/tags/handlebars/">handlebars</a></p><div class="page-content"><div class="post" data-postid="metalsmithtagplugin"><h3 id="metalsmith">Metalsmith</h3><p>Metalsmith is mostly used as a static site generator, but it is really an all-purpose tool for iterating over files in a folder structure and doing something with them. Everything you want to do is a plugin. Here&#x27;s what the Metalsmith code looks like for generating this blog:</p><pre><code class="hljs language-javascript">Metalsmith(__dirname)<br/>  .use(<br/>    collections({<br/>      <span class="hljs-attr">articles</span>: { <span class="hljs-attr">pattern</span>: <span class="hljs-string">&quot;posts/*.md&quot;</span>, <span class="hljs-attr">sortBy</span>: <span class="hljs-string">&quot;date&quot;</span>, <span class="hljs-attr">reverse</span>: <span class="hljs-literal">true</span> }<br/>    })<br/>  )<br/>  .use(tags({ <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;tags/&quot;</span> }))<br/>  .use(metallic({ <span class="hljs-attr">classPrefix</span>: <span class="hljs-string">&quot;&quot;</span> }))<br/>  .use(markdown())<br/>  .use(sass({ <span class="hljs-attr">outputStyle</span>: <span class="hljs-string">&quot;expanded&quot;</span> }))<br/>  .use(permalinks({ <span class="hljs-attr">pattern</span>: <span class="hljs-string">&quot;posts/:title&quot;</span> }))<br/>  .use(templates({ <span class="hljs-attr">engine</span>: <span class="hljs-string">&quot;handlebars&quot;</span>, <span class="hljs-attr">directory</span>: <span class="hljs-string">&quot;./templates&quot;</span> }))<br/>  .source(<span class="hljs-string">&quot;./files&quot;</span>)<br/>  .destination(<span class="hljs-string">&quot;../.&quot;</span>)<br/>  .build(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, h</span>) </span>{<br/>    <span class="hljs-keyword">if</span> (e) {<br/>      <span class="hljs-keyword">throw</span> e;<br/>    }<br/>  });</code></pre><p>Each <code>use</code> call is a plugin. Abstracting the actual file transformations to plugins is a very conscious call made by Metalsmith creators, serving to keep the Metalsmith API very small and lean.</p><p>When we first set up this blog, there was no tag plugin for Metalsmith. Now there is a <a href="https://github.com/totocaster/metalsmith-tags">pretty solid-looking one</a>, but we had to roll our own. This post walks through that code, serving mostly as a rundown of how to create a Metalsmith plugin.</p><p>Note the second row, <code>.use(tags({...}))</code>. That&#x27;s our plugin!</p><h3 id="plugin-structure">Plugin structure</h3><p>As you saw earlier, each plugin is a function that takes an options object as an argument. Here&#x27;s the skeleton of a plugin&#x27;s code:</p><pre><code class="hljs language-javascript">tags = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opts</span>) </span>{<br/>  <span class="hljs-comment">// commonly set default options here</span><br/><br/>  <span class="hljs-comment">// return the function to be given to the `.use` call.</span><br/>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files, metalsmith, done</span>) </span>{<br/>    <span class="hljs-comment">// ...do something with `files` here...</span><br/><br/>    done();<br/>  };<br/>};</code></pre><p>The function returned by the plugin, which then is what is passed to <code>use</code>, is given three arguments:</p><ul><li>The <code>files</code> object given to the plugin function contains information of all processed files so far. The keys are the paths to the files. A plugin commonly loops through all these files, editing them accordingly.</li><li>The <code>metalsmith</code> object exposes the Metalsmith API. A common usecase is to access the metadata through <code>metalsmith.metadata()</code> and read/edit that.</li><li>To allow plugins to do asynchronous stuff, control isn&#x27;t handed back to Metalsmith until the <code>done</code> callback is called.</li></ul><p>Each <code>file</code> object contains the contents of the file, and also information from optional YAML frontmatter. For example, below is the YAML for this very blog post. Note the <code>tags</code> data - that&#x27;s of course meant to be consumed by our tags plugin!</p><pre><code class="hljs language-yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">Creating</span> <span class="hljs-string">a</span> <span class="hljs-string">Metalsmith</span> <span class="hljs-string">tag</span> <span class="hljs-string">plugin</span><br/><span class="hljs-attr">author:</span> <span class="hljs-string">David</span><br/><span class="hljs-attr">tags:</span> [<span class="hljs-string">metalsmith</span>]<br/><span class="hljs-attr">date:</span> <span class="hljs-number">2014-08-09</span><br/><span class="hljs-attr">excerpt:</span> <span class="hljs-string">A</span> <span class="hljs-string">walkthrough</span> <span class="hljs-string">of</span> <span class="hljs-string">creating</span> <span class="hljs-string">a</span> <span class="hljs-string">tag</span> <span class="hljs-string">plugin</span> <span class="hljs-string">for</span> <span class="hljs-string">Metalsmith</span><br/><span class="hljs-attr">template:</span> <span class="hljs-string">post.html</span></code></pre><h3 id="creating-the-tags-plugin">Creating the tags plugin</h3><p>First we need to consider what we actually want our plugin to do. What we need are two things;</p><ul><li>We want to add a page for each tag, listing all posts for that tag. These files need to be generated by the plugin.</li><li>We want to add a page listing all tags found in the blog, along with a post count for each tag. The plugin could generate this file, or simply expose data making such a file easy to set up. We&#x27;ve elected to go with the latter, as there&#x27;s too many decisions going into creating such a file.</li></ul><p>Here&#x27;s the full code for our tag plugin, meeting the needs outlined above:</p><pre><code class="hljs language-javascript">tags = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opts</span>) </span>{<br/>  opts = _.defaults(opts || {}, {<br/>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;tags/&quot;</span>,<br/>    <span class="hljs-attr">yaml</span>: { <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;tag.html&quot;</span> }<br/>  });<br/>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files, metalsmith, done</span>) </span>{<br/>    meta = metalsmith.metadata();<br/><br/>    <span class="hljs-comment">// loop through all files, building an object with data about all tags</span><br/>    <span class="hljs-keyword">var</span> tags = _.reduce(<br/>      files,<br/>      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memo, file, path</span>) </span>{<br/>        <span class="hljs-comment">// make sure all tags are lower case, to prevent distinction between `Backbone` and `backbone`.</span><br/>        file.tags = file.tags<br/>          ? _.map(file.tags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{<br/>              <span class="hljs-keyword">return</span> t.toLowerCase();<br/>            })<br/>          : [];<br/>        <span class="hljs-comment">// loop through all tags found in the `tags` YAML data for this file</span><br/>        _.each(file.tags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tag</span>) </span>{<br/>          <span class="hljs-comment">// build a path for where the file for this tag is supposed to go</span><br/>          key = opts.path + tag + <span class="hljs-string">&quot;/index.html&quot;</span>;<br/>          memo[key] = _.defaults(<br/>            {},<br/>            memo[key],<br/>            { <span class="hljs-attr">tag</span>: tag, <span class="hljs-attr">posts</span>: [], <span class="hljs-attr">contents</span>: <span class="hljs-string">&quot;&quot;</span> },<br/>            opts.yaml<br/>          );<br/>          memo[key].posts = _.sortBy(<br/>            memo[key].posts.concat(file),<br/>            <span class="hljs-string">&quot;date&quot;</span><br/>          ).reverse();<br/>        });<br/>        <span class="hljs-keyword">return</span> memo;<br/>      },<br/>      {}<br/>    );<br/><br/>    <span class="hljs-comment">// add this data to the files object, causing Metalsmith to create these files</span><br/>    _.extend(files, tags);<br/><br/>    <span class="hljs-comment">// add a taglist array to the metadata, to be consumed by a tagcloud type page</span><br/>    meta.taglist = _.sortBy(<br/>      _.reduce(<br/>        tags,<br/>        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memo, tag</span>) </span>{<br/>          <span class="hljs-keyword">return</span> memo.concat({<br/>            <span class="hljs-attr">tag</span>: tag.tag,<br/>            <span class="hljs-attr">count</span>: tag.posts.length,<br/>            <span class="hljs-attr">posts</span>: tag.posts<br/>          });<br/>        },<br/>        []<br/>      ),<br/>      <span class="hljs-string">&quot;count&quot;</span><br/>    ).reverse();<br/><br/>    <span class="hljs-comment">// also add the same data but with tagnames as key, for use by individual tag pages</span><br/>    meta.tags = _.reduce(<br/>      tags,<br/>      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memo, tag</span>) </span>{<br/>        memo[tag.tag] = {<br/>          <span class="hljs-attr">tag</span>: tag.tag,<br/>          <span class="hljs-attr">count</span>: tag.posts.length,<br/>          <span class="hljs-attr">posts</span>: tag.posts<br/>        };<br/>        <span class="hljs-keyword">return</span> memo;<br/>      },<br/>      {}<br/>    );<br/><br/>    <span class="hljs-comment">// note metalsmith that we are done!</span><br/>    done();<br/>  };<br/>};</code></pre><h3 id="consuming-the-plugin">Consuming the plugin</h3><p>First off, individual blog posts will print out their tags by simply reading from the YAML <code>tags</code> array. All YAML data are available as local variables:</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>  Tags: {{#each tags}}<br/>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../tags/{{this}}/&quot;</span>&gt;</span>{{this}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>  {{/each}}<br/><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><p>Our taglist page contains this code, using the <code>taglist</code> metadata added by our plugin:</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>  Tags: {{#each this.taglist}}<br/>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../tags/{{tag}}/&quot;</span>&gt;</span>{{tag}} ({{count}})<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>  {{/each}}<br/><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><p>The main code powering the individual tag pages will be in the html template file. Note that we added a default to the <code>opts</code> object, telling Metalsmith to use a <code>tags.html</code> template file for these pages. The <code>contents</code> was merely set to an empty string. Even though there are no contents to the individual tag files we need to have a contents specification, otherwise Metalsmith will simply skip over generating a file.</p><p>When the template file is used to create a tag file, it will have the tag name in a local <code>tag</code> variable. Thus we can do the following in the template:</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br/>  Posts about {{tag}}:<br/><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><h3 id="utilizing-handlebars-helpers">Utilizing Handlebars helpers</h3><p>For the actual post list we created a Handlebars helper, to avoid having to put too much logic into the template file. Here&#x27;s how we consume it in the template:</p><pre><code class="hljs language-html">{{#tagPosts tag}}<br/><br/><span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;{{post_class}}&quot;</span>&gt;</span><br/>  <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-header&quot;</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-title&quot;</span>&gt;</span><br/>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../{{path}}&quot;</span>&gt;</span>{{{title}}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta&quot;</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">&quot;{{date}}&quot;</span>&gt;</span>{{moment date &#x27;MMM Do YYYY&#x27;}}<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span><br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>      By:<br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../author/{{toLowerCase author}}&quot;</span>&gt;</span>{{author}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>      Tags: {{#each tags}}<br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../tags/{{this}}/&quot;</span>&gt;</span>{{this}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>      {{/each}}<br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br/>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-excerpt&quot;</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{excerpt}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span><br/><br/>{{/tagPosts}}</code></pre><p>And here&#x27;s the source for the <code>tagPosts</code> helper. It is run in the context of the Metalsmith session, which means that <code>this</code> points to the metadata. Our tag plugin added a <code>tags</code> option with tagname keys, so we can use that to access the post list for our particular tag:</p><pre><code class="hljs language-javascript">Handlebars.registerHelper(<span class="hljs-string">&quot;tagPosts&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tagname, options</span>) </span>{<br/>  <span class="hljs-keyword">return</span> _.reduce(<br/>    <span class="hljs-built_in">this</span>.tags[tagname].posts,<br/>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memo, post</span>) </span>{<br/>      <span class="hljs-keyword">return</span> memo + options.fn(post);<br/>    },<br/>    <span class="hljs-string">&quot;&quot;</span><br/>  );<br/>});</code></pre><p>For each call to <code>options.fn</code>, our helper will use the given html in the context of a post object.</p><h3 id="author-portraits">Author portraits</h3><p>While we&#x27;re talking Handlebars, let&#x27;s also look at how we deal with the author portraits! Each author on this blog has their own page with a short bio and a listing of that person&#x27;s posts. This is generated from markdown files for all authors in the source directory that Metalsmith iterates over:</p><p><img src="/static/posts/creating-a-metalsmith-tag-plugin/img/authorfiles.png" alt="author files"/></p><p>Here&#x27;s what the author file looks like for me (David):</p><pre><code class="hljs language-markdown">---<br/>template: author.html<br/><span class="hljs-section">portrait: David<br/>---</span><br/><br/><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;__STATIC__/img/david.png&#x27;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;leftimg&#x27;</span> /&gt;</span></span><br/>David shares his time between working as a maths teacher for the Swedish Prison and Probation service, and working as a web programmer. His duties as the latter includes teaching a yearly course in advanced JavaScript at Linnaeus University.</code></pre><p>Notice we&#x27;re storing the author name in a <code>portrait</code> YAML variable, and sending the contents to an <code>author.html</code> template. Here&#x27;s the relevant part of that template:</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-content&quot;</span>&gt;</span>{{{contents}}}<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br/><br/>{{#authorPosts portrait}}<br/><br/><span class="hljs-tag">&lt;<span class="hljs-name">article</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;{{post_class}}&quot;</span>&gt;</span><br/>  <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-header&quot;</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-title&quot;</span>&gt;</span><br/>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../{{path}}&quot;</span>&gt;</span>{{{title}}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta&quot;</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">datetime</span>=<span class="hljs-string">&quot;{{date}}&quot;</span>&gt;</span>{{moment date &#x27;MMM Do YYYY&#x27;}}<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span><br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>      By:<br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../author/{{toLowerCase author}}&quot;</span>&gt;</span>{{author}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tags&quot;</span>&gt;</span><br/>      Tags: {{#each tags}}<br/>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;../../tags/{{this}}/&quot;</span>&gt;</span>{{this}}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>      {{/each}}<br/>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span><br/>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-excerpt&quot;</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{excerpt}}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span><br/><br/>{{else}}<br/><br/><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-content&quot;</span>&gt;</span><br/>  {{portrait}} hasn&#x27;t written any posts yet!<br/><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br/><br/>{{/authorPosts}}</code></pre><p>First we print the bio content using the <code>contents</code> variable, and then we call an <code>authorPosts</code> Handlebars helper. Note how we send two chunks of html to the helper - one to be used normally, then a fallback <code>else</code> chunk. In the first chunk, we assume having access to a single post by this author.</p><p>Here&#x27;s the source code for this helper:</p><pre><code class="hljs language-javascript">Handlebars.registerHelper(<span class="hljs-string">&quot;authorPosts&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">authorname, options</span>) </span>{<br/>  <span class="hljs-keyword">return</span> (<br/>    _.reduce(<br/>      <span class="hljs-built_in">this</span>.articles,<br/>      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memo, post</span>) </span>{<br/>        <span class="hljs-keyword">return</span> post.author === authorname ? memo + options.fn(post) : memo;<br/>      },<br/>      <span class="hljs-string">&quot;&quot;</span><br/>    ) || options.inverse(<span class="hljs-built_in">this</span>)<br/>  );<br/>});</code></pre><p>We loop through all posts, which thanks to the collection plugin can be accessed at <code>this.articles</code>. Then for all posts who has the name of our author in the YAML author variable, we send that post to the first html chunk through <code>options.fn</code>.</p><p>If there were no matching posts, we instead use the second html chunk through a call to <code>options.inverse</code>. Notice how we&#x27;re sending <code>this</code> as a context, giving us access to the YAML <code>portrait</code> variable in the second chunk.</p></div><hr/></div><div id="disqus_thread" style="display:none"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/posts/creating-a-metalsmith-tag-plugin","query":{},"buildId":"wQeVqw4-MCmoY2Zy_p65E","dynamicBuildId":false,"nextExport":true}</script><script async="" id="__NEXT_PAGE__/posts/creating-a-metalsmith-tag-plugin" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/creating-a-metalsmith-tag-plugin.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js"></script><script src="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" async=""></script><script src="/_next/static/chunks/commons.ebbfd942159f83091516.js" async=""></script><script src="/_next/static/runtime/main-c1620565ee9f1f33603c.js" async=""></script><script type="text/javascript" async="" src="https://krawaller.disqus.com/embed.js"></script></body></html>