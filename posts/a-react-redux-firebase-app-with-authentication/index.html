<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/static/styles/nprogress.css"/><link rel="stylesheet" href="/static/styles/code.css"/><link rel="stylesheet" href="/static/styles/site.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Lexend+Zetta&amp;display=swap" rel="stylesheet"/><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-11433118-1', 'auto');
  ga("send", "pageview");</script><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>A React-Redux-Firebase app with authentication</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-redux-firebase-app-with-authentication.js" as="script"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ebbfd942159f83091516.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-c1620565ee9f1f33603c.js" as="script"/></head><body><div id="__next"><div style="margin-bottom:20px"></div><div class="master"><h1><a href="/"><span>k</span><span>r</span><span>a</span><span>w</span><span>a</span><span>l</span><span>l</span><span>e</span><span>r</span></a></h1><hr/><div class="summary">Another Redux sample app, this time coupled with Firebase. Demonstrates authentication, validation and keeping all UI state in Redux.</div><hr/><h2>A React-Redux-Firebase app with authentication</h2><p class="taglist">Tags:<!-- --> <a href="/tags/react/">react</a><a href="/tags/redux/">redux</a><a href="/tags/case_study/">case study</a><a href="/tags/firebase/">firebase</a></p><div class="page-content"><div class="post" data-postid="reduxfirebasedemo"><h3 id="the-quotes-app">The quotes app</h3><p>This post presents an example app demonstrating how to can use Firebase on a React-Redux foundation. The app is a simple collection of quotes. If you log in (using Github credentials) you can add a new quote and edit/delete previous quotes added by you. Try it out below!</p><iframe src="https://blog.krawaller.se/reduxfirebasedemo/index.html" style="height:600px;width:100%"></iframe><p>You&#x27;ll find the code repo <a href="https://github.com/krawaller/reduxfirebasedemo">here</a>, and the app is published <a href="https://blog.krawaller.se/reduxfirebasedemo/#/?_k=98yl14">here</a>.</p><p>The app was built as a demo for the <a href="https://coursepress.lnu.se/kurs/ria-utveckling-med-javascript/">RIA development course</a> I&#x27;m running at <a href="http://lnu.se">Linnaeus university</a>.</p><p>It is meant to serve as an example of several things:</p><ul><li>How to couple Redux and Firebase</li><li>How to let Redux manage all UI state</li><li>How to deal with validation in Redux</li><li>How to handle authentication</li></ul><h3 id="app-state">App state</h3><p>As with all Redux app, the entire state of the app is stored in an object in one single store. Here&#x27;s what the <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/store/initialstate.js">initial state</a> looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../constants&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = {<br/>  <span class="hljs-attr">feedback</span>: [<br/>    {<br/>      <span class="hljs-attr">msg</span>:<br/>        <span class="hljs-string">&quot;Welcome to this little demo! It is meant to demonstrate three things:&quot;</span>,<br/>      <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span><br/>    },<br/>    { <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;1) How to use Redux + Firebase&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> },<br/>    { <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;2) How to use authentication in a Redux app&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> },<br/>    {<br/>      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;3) How to have all UI state in Redux and none in the components&quot;</span>,<br/>      <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span><br/>    }<br/>  ],<br/>  <span class="hljs-attr">auth</span>: {<br/>    <span class="hljs-attr">currently</span>: C.ANONYMOUS,<br/>    <span class="hljs-attr">username</span>: <span class="hljs-literal">null</span>,<br/>    <span class="hljs-attr">uid</span>: <span class="hljs-literal">null</span><br/>  },<br/>  <span class="hljs-attr">quotes</span>: {<br/>    <span class="hljs-attr">hasreceiveddata</span>: <span class="hljs-literal">false</span>,<br/>    <span class="hljs-attr">submittingnew</span>: <span class="hljs-literal">false</span>,<br/>    <span class="hljs-attr">states</span>: {}, <span class="hljs-comment">// this will store per quote id if we&#x27;re reading, editing or awaiting DB response</span><br/>    <span class="hljs-attr">data</span>: {} <span class="hljs-comment">// this will contain firebase data</span><br/>  }<br/>};</code></pre><p>As you can see the state can be divided into three parts;</p><ol><li><code>feedback</code>: An array of UI messages to the user</li><li><code>auth</code>: Information about the currently logged in user</li><li><code>quotes</code>: The actual list of quotes, and also the UI state of each quote</li></ol><p>We&#x27;ll now look at the corresponding reducer and action creator for these three parts one at a time.</p><h3 id="authentication">Authentication</h3><p>Beginning with authentication, here&#x27;s what the <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/store/reducers/auth.js">reducer</a> looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../../constants&quot;</span>),<br/>  initialState = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../initialstate&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">currentstate, action</span>) </span>{<br/>  <span class="hljs-keyword">switch</span> (action.type) {<br/>    <span class="hljs-keyword">case</span> C.ATTEMPTING_LOGIN:<br/>      <span class="hljs-keyword">return</span> {<br/>        <span class="hljs-attr">currently</span>: C.AWAITING_AUTH_RESPONSE,<br/>        <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;guest&quot;</span>,<br/>        <span class="hljs-attr">uid</span>: <span class="hljs-literal">null</span><br/>      };<br/>    <span class="hljs-keyword">case</span> C.LOGOUT:<br/>      <span class="hljs-keyword">return</span> {<br/>        <span class="hljs-attr">currently</span>: C.ANONYMOUS,<br/>        <span class="hljs-attr">username</span>: <span class="hljs-string">&quot;guest&quot;</span>,<br/>        <span class="hljs-attr">uid</span>: <span class="hljs-literal">null</span><br/>      };<br/>    <span class="hljs-keyword">case</span> C.LOGIN_USER:<br/>      <span class="hljs-keyword">return</span> {<br/>        <span class="hljs-attr">currently</span>: C.LOGGED_IN,<br/>        <span class="hljs-attr">username</span>: action.username,<br/>        <span class="hljs-attr">uid</span>: action.uid<br/>      };<br/>    <span class="hljs-keyword">default</span>:<br/>      <span class="hljs-keyword">return</span> currentstate || initialState.auth;<br/>  }<br/>};</code></pre><p>You&#x27;ll note there are three things that can happen;</p><ol><li><code>ATTEMPTING_LOGIN</code> which is the user having entered his credentials and now awaiting a response</li><li><code>LOGIN_USER</code> represents a successfull login</li><li><code>LOGOUT</code> means we discard the current user credentials and reenter guestmode</li></ol><p>So far we&#x27;ve seen no trace of actual Firebase code, which is to be expected. The reducers should always be instantaneous and free of side effects, and simply react synchronously to an action notification just received.</p><p>Instead, the related Firebase code can be found in the <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/actions/auth.js">authentication action creators</a>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../constants&quot;</span>),<br/>  Firebase = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;firebase&quot;</span>),<br/>  fireRef = <span class="hljs-keyword">new</span> Firebase(C.FIREBASE);<br/><br/><span class="hljs-built_in">module</span>.exports = {<br/>  <span class="hljs-comment">// called at app start</span><br/>  <span class="hljs-attr">startListeningToAuth</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch, getState</span>) </span>{<br/>      fireRef.onAuth(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">authData</span>) </span>{<br/>        <span class="hljs-keyword">if</span> (authData) {<br/>          dispatch({<br/>            <span class="hljs-attr">type</span>: C.LOGIN_USER,<br/>            <span class="hljs-attr">uid</span>: authData.uid,<br/>            <span class="hljs-attr">username</span>: authData.github.displayName || authData.github.username<br/>          });<br/>        } <span class="hljs-keyword">else</span> {<br/>          <span class="hljs-keyword">if</span> (getState().auth.currently !== C.ANONYMOUS) {<br/>            <span class="hljs-comment">// log out if not already logged out</span><br/>            dispatch({ <span class="hljs-attr">type</span>: C.LOGOUT });<br/>          }<br/>        }<br/>      });<br/>    };<br/>  },<br/>  <span class="hljs-attr">attemptLogin</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch, getState</span>) </span>{<br/>      dispatch({ <span class="hljs-attr">type</span>: C.ATTEMPTING_LOGIN });<br/>      fireRef.authWithOAuthPopup(<span class="hljs-string">&quot;github&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, authData</span>) </span>{<br/>        <span class="hljs-keyword">if</span> (error) {<br/>          dispatch({ <span class="hljs-attr">type</span>: C.DISPLAY_ERROR, <span class="hljs-attr">error</span>: <span class="hljs-string">&quot;Login failed! &quot;</span> + error });<br/>          dispatch({ <span class="hljs-attr">type</span>: C.LOGOUT });<br/>        } <span class="hljs-keyword">else</span> {<br/>          <span class="hljs-comment">// no need to do anything here, startListeningToAuth have already made sure that we update on changes</span><br/>        }<br/>      });<br/>    };<br/>  },<br/>  <span class="hljs-attr">logoutUser</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch, getState</span>) </span>{<br/>      dispatch({ <span class="hljs-attr">type</span>: C.LOGOUT }); <span class="hljs-comment">// don&#x27;t really need to do this, but nice to get immediate feedback</span><br/>      fireRef.unauth();<br/>    };<br/>  }<br/>};</code></pre><p>We&#x27;re using <a href="https://github.com/gaearon/redux-thunk">Redux-Thunk</a> which allows for the action creators to return a function instead of a straight-up actions object, making asynchronous actions possible.</p><p>There are three authentication-related action creators;</p><ol><li><code>startListeningToAuth</code> is called att app start, setting upp the real-time updates from Firebase. This means we never have to bother catching the result of subsequent auth requests made to Firebase, this listener will catch them all!</li><li><code>attemptLogin</code> is when a user submits his credentials. This synchronously fires an <code>ATTEMPTING_LOGIN</code> action, setting the spinner to notify the user that judgement is a-coming.</li><li><code>logoutUser</code> is when a user clicks log out. Note that we synchronously log out here, not totally necessary since Firebase would push the log out to us.</li></ol><p>Here&#x27;s what the <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/index.js">app-start kickoff</a> looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ReactDOM = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-dom&quot;</span>),<br/>  Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-router&quot;</span>).Router,<br/>  Provider = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-redux&quot;</span>).Provider,<br/>  store = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./store&quot;</span>),<br/>  routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes&quot;</span>),<br/>  actions = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./actions&quot;</span>);<br/><br/>ReactDOM.render(<br/>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">routes</span>=<span class="hljs-string">{routes}</span> /&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>,<br/>  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;root&quot;</span>)<br/>);<br/><br/><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>  store.dispatch(actions.startListeningToAuth());<br/>  store.dispatch(actions.startListeningToQuotes());<br/>});</code></pre><p>Note the action calls at the very bottom.</p><p>Now you&#x27;ve seen all authentication-related code. This code ensures that <code>appstate.auth</code> contains the current user, which can then be queried by your other code. In a production app you&#x27;d also have security rules on the Firebase side of things to prevent easy manipulation.</p><h3 id="quotes">Quotes</h3><p>Now let&#x27;s look at the quotes-related code. To save you scrolling back, here&#x27;s what the quote state looked like:</p><pre><code class="hljs language-javascript">quotes: {<br/>    <span class="hljs-attr">hasreceiveddata</span>: <span class="hljs-literal">false</span>,<br/>    <span class="hljs-attr">submittingnew</span>: <span class="hljs-literal">false</span>,<br/>    <span class="hljs-attr">states</span>: {}, <span class="hljs-comment">// this will store per quote id if we&#x27;re reading, editing or awaiting DB response</span><br/>    <span class="hljs-attr">data</span>: {} <span class="hljs-comment">// this will contain firebase data</span><br/>}</code></pre><p>With that fresh on our retinas, here&#x27;s the <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/store/reducers/quotes.js">reducer</a>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../../constants&quot;</span>),<br/>  initialState = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../initialstate&quot;</span>),<br/>  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lodash&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">currentstate, action</span>) </span>{<br/>  <span class="hljs-keyword">var</span> newstate;<br/>  <span class="hljs-keyword">switch</span> (action.type) {<br/>    <span class="hljs-keyword">case</span> C.RECEIVE_QUOTES_DATA:<br/>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.assign({}, currentstate, {<br/>        <span class="hljs-attr">hasreceiveddata</span>: <span class="hljs-literal">true</span>,<br/>        <span class="hljs-attr">data</span>: action.data<br/>      });<br/>    <span class="hljs-keyword">case</span> C.AWAIT_NEW_QUOTE_RESPONSE:<br/>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.assign({}, currentstate, {<br/>        <span class="hljs-attr">submittingnew</span>: <span class="hljs-literal">true</span><br/>      });<br/>    <span class="hljs-keyword">case</span> C.RECEIVE_NEW_QUOTE_RESPONSE:<br/>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.assign({}, currentstate, {<br/>        <span class="hljs-attr">submittingnew</span>: <span class="hljs-literal">false</span><br/>      });<br/>    <span class="hljs-keyword">case</span> C.START_QUOTE_EDIT:<br/>      newstate = _.cloneDeep(currentstate);<br/>      newstate.states[action.qid] = C.EDITING_QUOTE;<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.FINISH_QUOTE_EDIT:<br/>      newstate = _.cloneDeep(currentstate);<br/>      <span class="hljs-keyword">delete</span> newstate.states[action.qid];<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.SUBMIT_QUOTE_EDIT:<br/>      newstate = _.cloneDeep(currentstate);<br/>      newstate.states[action.qid] = C.SUBMITTING_QUOTE;<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">default</span>:<br/>      <span class="hljs-keyword">return</span> currentstate || initialState.quotes;<br/>  }<br/>};</code></pre><p>As the switch statement shows there are 6 quote actions:</p><ol><li><code>RECEIVE_QUOTES_DATA</code> means an update from Firebase. We grab that payload and put it in <code>appstate.quotes.data</code>.</li><li><code>AWAIT_NEW_QUOTE_RESPONSE</code> is when we have submitted a new quote but haven&#x27;t yet had an answer, so we should show a spinner in the form for adding new quotes.</li><li><code>RECEIVE_NEW_QUOTE_RESPONSE</code> means we got the answer on our request to add a new quote, so the new quote form should no longer show a spinner.</li><li><code>START_QUOTE_EDIT</code> is when a user clicked &quot;edit&quot; on a quote he/she has written, so that qoute should now be displayed in a form.</li><li><code>C.FINISH_QUOTE_EDIT</code> means they cancelled or received submit result, so the quote should no longer be displayed in a form</li><li><code>SUBMIT_QUOTE_EDIT</code> is when they submitted an edit, so the form for that quote should now display a spinner.</li></ol><p>Let&#x27;s take a look at the render function for <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/pages/components/quote.js">a single quote</a>, showing off all the quote state we&#x27;ve seen so far:</p><pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<br/>    <span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props,<br/>        q = p.quote,<br/>        button;<br/>    <span class="hljs-keyword">if</span> (p.state === C.EDITING_QUOTE){<br/>        <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;quote&quot;</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{this.submit}</span>&gt;</span><br/>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;field&quot;</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{q.content}/</span>&gt;</span><br/>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{p.cancel}</span>&gt;</span>Cancel<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br/>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.submit}</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>);<br/>    }<br/>    <span class="hljs-keyword">if</span> (!p.mayedit){<br/>        button = <span class="hljs-string">&quot;&quot;</span><br/>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p.state === C.SUBMITTING_QUOTE) {<br/>        button = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&quot;disabled&quot;</span>&gt;</span>Submitting...<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br/>    } <span class="hljs-keyword">else</span> {<br/>        button = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{p.edit}</span>&gt;</span>Edit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{p.delete}</span>&gt;</span>Delete<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;<br/>    }<br/>    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;quote&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;author&quot;</span>&gt;</span>{q.username+&quot; said: &quot;}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>{q.content} {button}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br/>}</code></pre><p>The quote is rendered in a <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/pages/quoteslist.js">quotelist parent component</a>. This parent component is connected to Redux using <a href="https://github.com/rackt/react-redux">React-Redux</a>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> mapStateToProps = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">appState</span>) </span>{<br/>  <span class="hljs-keyword">return</span> {<br/>    <span class="hljs-attr">quotes</span>: appState.quotes,<br/>    <span class="hljs-attr">auth</span>: appState.auth<br/>  };<br/>};<br/><br/><span class="hljs-keyword">var</span> mapDispatchToProps = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch</span>) </span>{<br/>  <span class="hljs-keyword">return</span> {<br/>    <span class="hljs-attr">submitNewQuote</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">content</span>) </span>{<br/>      dispatch(actions.submitNewQuote(content));<br/>    },<br/>    <span class="hljs-attr">startEdit</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">qid</span>) </span>{<br/>      dispatch(actions.startQuoteEdit(qid));<br/>    },<br/>    <span class="hljs-attr">cancelEdit</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">qid</span>) </span>{<br/>      dispatch(actions.cancelQuoteEdit(qid));<br/>    },<br/>    <span class="hljs-attr">submitEdit</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">qid, content</span>) </span>{<br/>      dispatch(actions.submitQuoteEdit(qid, content));<br/>    },<br/>    <span class="hljs-attr">deleteQuote</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">qid</span>) </span>{<br/>      dispatch(actions.deleteQuote(qid));<br/>    }<br/>  };<br/>};<br/><br/><span class="hljs-built_in">module</span>.exports = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(<br/>  Quoteslist<br/>);</code></pre><p>And it renders each quote like thus, passing down the relevant state and callbacks:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props,<br/>  rows = _.map(p.quotes.data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">quote, qid</span>) </span>{<br/>    <span class="hljs-keyword">var</span> quotestate = p.quotes.states[qid];<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Quote</span><br/>        <span class="hljs-attr">key</span>=<span class="hljs-string">{qid}</span><br/>        <span class="hljs-attr">quote</span>=<span class="hljs-string">{quote}</span><br/>        <span class="hljs-attr">qid</span>=<span class="hljs-string">{qid}</span><br/>        <span class="hljs-attr">state</span>=<span class="hljs-string">{quotestate}</span><br/>        <span class="hljs-attr">edit</span>=<span class="hljs-string">{p.startEdit.bind(this,</span> <span class="hljs-attr">qid</span>)}<br/>        <span class="hljs-attr">cancel</span>=<span class="hljs-string">{p.cancelEdit.bind(this,</span> <span class="hljs-attr">qid</span>)}<br/>        <span class="hljs-attr">submit</span>=<span class="hljs-string">{p.submitEdit.bind(this,</span> <span class="hljs-attr">qid</span>)}<br/>        <span class="hljs-attr">delete</span>=<span class="hljs-string">{p.deleteQuote.bind(this,</span> <span class="hljs-attr">qid</span>)}<br/>        <span class="hljs-attr">mayedit</span>=<span class="hljs-string">{p.auth.uid</span> === <span class="hljs-string">quote.uid}</span><br/>      /&gt;</span></span><br/>    );<br/>  }).reverse();</code></pre><p>Note how it checks if you&#x27;re allowed to edit this quote by comparing <code>quote.uid</code> with the <code>uid</code> of the currently logged in user.</p><h3 id="feedback">Feedback</h3><p>For completion&#x27;s sake let&#x27;s also look at the feedback functionality, which is much simpler and doesn&#x27;t include Firebase. The feedback state is just an array of string messages to show:</p><pre><code class="hljs language-javascript">feedback: [<br/>  {<br/>    <span class="hljs-attr">msg</span>:<br/>      <span class="hljs-string">&quot;Welcome to this little demo! It is meant to demonstrate three things:&quot;</span>,<br/>    <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span><br/>  },<br/>  { <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;1) How to use Redux + Firebase&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> },<br/>  { <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;2) How to use authentication in a Redux app&quot;</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> },<br/>  {<br/>    <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;3) How to have all UI state in Redux and none in the components&quot;</span>,<br/>    <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span><br/>  }<br/>];</code></pre><p>The <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/store/reducers/feedback.js">feedback reducer</a> deals with 3 actions:</p><pre><code class="hljs language-javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">currentfeedback, action</span>) </span>{<br/>  <span class="hljs-keyword">switch</span> (action.type) {<br/>    <span class="hljs-keyword">case</span> C.DISMISS_FEEDBACK:<br/>      <span class="hljs-keyword">return</span> currentfeedback.filter(<span class="hljs-function">(<span class="hljs-params">i, n</span>) =&gt;</span> n !== action.num);<br/>    <span class="hljs-keyword">case</span> C.DISPLAY_ERROR:<br/>      <span class="hljs-keyword">return</span> currentfeedback.concat({ <span class="hljs-attr">msg</span>: action.error, <span class="hljs-attr">error</span>: <span class="hljs-literal">true</span> });<br/>    <span class="hljs-keyword">case</span> C.DISPLAY_MESSAGE:<br/>      <span class="hljs-keyword">return</span> currentfeedback.concat({ <span class="hljs-attr">msg</span>: action.message, <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span> });<br/>    <span class="hljs-keyword">default</span>:<br/>      <span class="hljs-keyword">return</span> currentfeedback || initialState.feedback;<br/>  }<br/>};</code></pre><p>And the related <a href="https://github.com/krawaller/reduxfirebasedemo/blob/gh-pages/src/actions/feedback.js">feedback action creator</a> contains just one single thing, namely a function to dismiss a feedback message. Adding messages / errors are only done inside of other action creators.</p><pre><code class="hljs language-javascript"><span class="hljs-built_in">module</span>.exports = {<br/>  <span class="hljs-attr">dismissFeedback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">num</span>) </span>{<br/>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: C.DISMISS_FEEDBACK, <span class="hljs-attr">num</span>: num };<br/>  }<br/>};</code></pre><h3 id="wrapping-up">Wrapping up</h3><p>Perhaps this demo took on more than it can chew, but I hope it at least can serve as an example of how to pair Redux and Firebase in a sane way.</p></div><hr/></div><div id="disqus_thread" style="display:none"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/posts/a-react-redux-firebase-app-with-authentication","query":{},"buildId":"wQeVqw4-MCmoY2Zy_p65E","dynamicBuildId":false,"nextExport":true}</script><script async="" id="__NEXT_PAGE__/posts/a-react-redux-firebase-app-with-authentication" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-redux-firebase-app-with-authentication.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js"></script><script src="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" async=""></script><script src="/_next/static/chunks/commons.ebbfd942159f83091516.js" async=""></script><script src="/_next/static/runtime/main-c1620565ee9f1f33603c.js" async=""></script><script type="text/javascript" async="" src="https://krawaller.disqus.com/embed.js"></script></body></html>