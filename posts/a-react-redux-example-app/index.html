<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/static/styles/nprogress.css"/><link rel="stylesheet" href="/static/styles/code.css"/><link rel="stylesheet" href="/static/styles/site.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Lexend+Zetta&amp;display=swap" rel="stylesheet"/><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-11433118-1', 'auto');
  ga("send", "pageview");</script><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>A React-Redux example app</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-redux-example-app.js" as="script"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ebbfd942159f83091516.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-c1620565ee9f1f33603c.js" as="script"/></head><body><div id="__next"><div style="margin-bottom:20px"></div><div class="master"><h1><a href="/"><span>k</span><span>r</span><span>a</span><span>w</span><span>a</span><span>l</span><span>l</span><span>e</span><span>r</span></a></h1><hr/><div class="summary">Dissecting a small React-Redux example application</div><hr/><h2>A React-Redux example app</h2><p class="taglist">Tags:<!-- --> <a href="/tags/react/">react</a><a href="/tags/redux/">redux</a><a href="/tags/case_study/">case study</a></p><div class="page-content"><div class="post" data-postid="superheroes"><p><span style="color:red"><strong>Note</strong>: This example app has a bug due to bad flow design. See the explanation and the solution in <a href="/posts/a-react-redux-example-followup/">this follow-up post</a>!</span></p><h3 id="the-superhero-battler-app">The Superhero battler app</h3><p>This post presents a simple React-Redux example app. The aim was to have a small example to complement the official Redux ones, that is also more portable. It uses React, Redux, React-Router, React-Redux and browserify. And (almost) no ES6 syntax.</p><p>Instead of the venerable ToDo, the app is a tiny &quot;game&quot; where superheroes battle it out until there&#x27;s only one left standing:</p><iframe src="https://blog.krawaller.se/riastart2015/index.html" style="height:500px;width:100%"></iframe><p>The url for the app is <a href="https://blog.krawaller.se/riastart2015/">https://blog.krawaller.se/riastart2015/</a>, and the source code is at <a href="https://github.com/krawaller/riastart2015">https://github.com/krawaller/riastart2015</a>.</p><p>Kick the tires for a bit so you get a feel for what&#x27;s going on, then read on to see how it is all put together!</p><h3 id="under-the-hood">Under the hood</h3><p>These are the involved files (along with <code>index.html</code> and the generated <code>bundle.js</code>):</p><p><img src="/static/posts/a-react-redux-example-app/img/superherofiles.png" alt="components"/></p><p>Before we look at the components, let&#x27;s examine the main plumbing first. The entry point is <code>index.js</code>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ReactDOM = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-dom&quot;</span>),<br/>  Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-router&quot;</span>).Router,<br/>  Provider = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-redux&quot;</span>).Provider,<br/>  store = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./store&quot;</span>),<br/>  routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes&quot;</span>);<br/><br/>ReactDOM.render(<br/>  <span class="hljs-comment">// The top-level Provider is what allows us to `connect` components to the store</span><br/>  <span class="hljs-comment">// using ReactRedux.connect (see components Home and Hero)</span><br/>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">routes</span>=<span class="hljs-string">{routes}</span> /&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>,<br/>  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;root&quot;</span>)<br/>);</code></pre><p>In here we load <code>routes.js</code>, hook up <code>store.js</code>, and feed it all to <code>ReactDOM.render</code>!</p><h3 id="data-model">Data model</h3><p>Now we enter Redux land! I won&#x27;t go into too much detail on how Redux works, as <a href="http://redux.js.org/">the official docs</a> are just marvelous at doing that. Instead we&#x27;ll focus on how this app uses Redux.</p><p>Here&#x27;s what our store (in Redux there&#x27;s only one) looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> Redux = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;redux&quot;</span>),<br/>  heroReducer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./reducers/heroes&quot;</span>),<br/>  battlefieldReducer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./reducers/battlefield&quot;</span>),<br/>  initialState = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./initialstate&quot;</span>),<br/>  thunk = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;redux-thunk&quot;</span>); <span class="hljs-comment">// allows us to use asynchronous actions</span><br/><br/><span class="hljs-keyword">var</span> rootReducer = Redux.combineReducers({<br/>  <span class="hljs-attr">heroes</span>: heroReducer, <span class="hljs-comment">// this means heroReducer will operate on appState.heroes</span><br/>  <span class="hljs-attr">battlefield</span>: battlefieldReducer <span class="hljs-comment">// battlefieldReducer will operate on appState.battlefield,</span><br/>});<br/><br/><span class="hljs-built_in">module</span>.exports = Redux.applyMiddleware(thunk)(Redux.createStore)(<br/>  rootReducer,<br/>  initialState()<br/>);</code></pre><p>There are some weird parts to this, but what&#x27;s relevant for our app is <code>initialstate</code> and the two reducers, <code>heroReducer</code> and <code>battlefieldReducer</code>.</p><p>Let&#x27;s peek at <code>initialstate</code> first, as that will also serve as a picture of what the app data model looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./constants&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>  <span class="hljs-keyword">return</span> {<br/>    <span class="hljs-attr">heroes</span>: {<br/>      <span class="hljs-attr">batman</span>: {<br/>        <span class="hljs-attr">quote</span>: <span class="hljs-string">&quot;I&#x27;m batman.&quot;</span>,<br/>        <span class="hljs-attr">kills</span>: <span class="hljs-number">0</span><br/>      },<br/>      <span class="hljs-attr">superman</span>: {<br/>        <span class="hljs-attr">quote</span>: <span class="hljs-string">&quot;I can fly!&quot;</span>,<br/>        <span class="hljs-attr">kills</span>: <span class="hljs-number">0</span><br/>      },<br/>      <span class="hljs-attr">spiderman</span>: {<br/>        <span class="hljs-attr">quote</span>: <span class="hljs-string">&quot;Why don&#x27;t you love me, Lois?&quot;</span>,<br/>        <span class="hljs-attr">kills</span>: <span class="hljs-number">0</span><br/>      },<br/>      <span class="hljs-string">&quot;he-man&quot;</span>: {<br/>        <span class="hljs-attr">quote</span>: <span class="hljs-string">&quot;By the power of Grayskull!&quot;</span>,<br/>        <span class="hljs-attr">kills</span>: <span class="hljs-number">0</span><br/>      }<br/>    },<br/>    <span class="hljs-attr">battlefield</span>: {<br/>      <span class="hljs-attr">doing</span>: {<br/>        <span class="hljs-attr">batman</span>: C.WAITING,<br/>        <span class="hljs-attr">superman</span>: C.WAITING,<br/>        <span class="hljs-attr">spiderman</span>: C.WAITING,<br/>        <span class="hljs-string">&quot;he-man&quot;</span>: C.WAITING<br/>      },<br/>      <span class="hljs-attr">standing</span>: <span class="hljs-number">4</span>,<br/>      <span class="hljs-attr">log</span>: [<span class="hljs-string">&quot;Ready.... fight!&quot;</span>]<br/>    }<br/>  };<br/>};</code></pre><p>As you can see there are two main parts to the data; <code>heroes</code> and <code>battlefield</code>. These parts correspond to the two reducers you saw earlier in the store file.</p><p>The constants file is merely just that, a list of constants:</p><pre><code class="hljs">module.exports = {<br/>    <span class="hljs-comment">// ACTION TYPES</span><br/><span class="hljs-symbol">    AIM_AT:</span> <span class="hljs-string">&quot;AIM_AT&quot;</span>,<br/><span class="hljs-symbol">    KILL_HERO:</span> <span class="hljs-string">&quot;KILL_HERO&quot;</span>,<br/><span class="hljs-symbol">    RESET:</span> <span class="hljs-string">&quot;RESET&quot;</span>,<br/><span class="hljs-symbol">    DUCK_DOWN:</span> <span class="hljs-string">&quot;DUCK_DOWN&quot;</span>,<br/><span class="hljs-symbol">    STAND_UP:</span> <span class="hljs-string">&quot;STAND_UP&quot;</span>,<br/><br/>    <span class="hljs-comment">// HERO STATUSES</span><br/><span class="hljs-symbol">    AIMING:</span> <span class="hljs-string">&quot;AIMING&quot;</span>,<br/><span class="hljs-symbol">    DUCKING:</span> <span class="hljs-string">&quot;DUCKING&quot;</span>,<br/><span class="hljs-symbol">    WAITING:</span> <span class="hljs-string">&quot;WAITING&quot;</span>,<br/><span class="hljs-symbol">    DEAD:</span> <span class="hljs-string">&quot;DEAD&quot;</span><br/>};</code></pre><h3 id="mutating-the-data">Mutating the data</h3><p>Now we&#x27;ve seen what the data looks like; how is it updated? Through <code>actions</code>, that&#x27;s how! Here&#x27;s what the action creators for our app looks like:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./constants&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = {<br/>  <span class="hljs-attr">reset</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-comment">// A normal action creator, returns a simple object describing the action.</span><br/>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: constants.RESET };<br/>  },<br/>  <span class="hljs-attr">duckDown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">who</span>) </span>{<br/>    <span class="hljs-comment">// here we take advantage of Redux-thunk; instead of returning an object describing an action,</span><br/>    <span class="hljs-comment">// we return a function that takes dispatch and getState as arguments. This function can then</span><br/>    <span class="hljs-comment">// invoke dispatch, now or later using setTimeout or similar.</span><br/>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch, getState</span>) </span>{<br/>      dispatch({ <span class="hljs-attr">type</span>: constants.DUCK_DOWN, <span class="hljs-attr">coward</span>: who });<br/>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>        dispatch({ <span class="hljs-attr">type</span>: constants.STAND_UP, <span class="hljs-attr">coward</span>: who });<br/>      }, <span class="hljs-number">2000</span>);<br/>    };<br/>  },<br/>  <span class="hljs-attr">aimAt</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">killer, victim</span>) </span>{<br/>    <span class="hljs-comment">// Another async action using the Redux-thunk syntax</span><br/>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch, getState</span>) </span>{<br/>      dispatch({ <span class="hljs-attr">type</span>: constants.AIM_AT, <span class="hljs-attr">killer</span>: killer, <span class="hljs-attr">victim</span>: victim });<br/>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>        dispatch({ <span class="hljs-attr">type</span>: constants.KILL_HERO, <span class="hljs-attr">killer</span>: killer, <span class="hljs-attr">victim</span>: victim });<br/>      }, <span class="hljs-number">2000</span>);<br/>    };<br/>  }<br/>};</code></pre><p>These functions will be used inside components in response to user events. But before we look at those, let&#x27;s see what happens when they are invoked - that magic is all in the reducers!</p><p>First off the <code>heroReducer</code>, as that is by far the simplest. The only thing it does is increase the kill count whenever a hero kills another.</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../constants&quot;</span>),<br/>  initialState = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../initialstate&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, action</span>) </span>{<br/>  <span class="hljs-keyword">var</span> newstate = <span class="hljs-built_in">Object</span>.assign({}, state); <span class="hljs-comment">// sloppily copying the old state here, so we never mutate it</span><br/>  <span class="hljs-keyword">switch</span> (action.type) {<br/>    <span class="hljs-keyword">case</span> C.KILL_HERO:<br/>      newstate[action.killer].kills += <span class="hljs-number">1</span>;<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">default</span>:<br/>      <span class="hljs-keyword">return</span> state || initialState().heroes;<br/>  }<br/>};</code></pre><p>The <code>battlefieldReducer</code>, however, has far more responsibilities!</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../constants&quot;</span>),<br/>  initialState = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../initialstate&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, action</span>) </span>{<br/>  <span class="hljs-keyword">var</span> newstate = <span class="hljs-built_in">Object</span>.assign({}, state); <span class="hljs-comment">// sloppily copying the old state here, so we never mutate it</span><br/>  <span class="hljs-keyword">switch</span> (action.type) {<br/>    <span class="hljs-keyword">case</span> C.DUCK_DOWN:<br/>      newstate.doing[action.coward] = C.DUCKING;<br/>      newstate.log.push(action.coward + <span class="hljs-string">&quot; ducks down like a coward.&quot;</span>);<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.STAND_UP:<br/>      newstate.doing[action.coward] = C.WAITING;<br/>      newstate.log.push(action.coward + <span class="hljs-string">&quot; stands back up.&quot;</span>);<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.AIM_AT:<br/>      newstate.doing[action.killer] = C.AIMING;<br/>      newstate.log.push(action.killer + <span class="hljs-string">&quot; takes aim at &quot;</span> + action.victim + <span class="hljs-string">&quot;!&quot;</span>);<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.KILL_HERO:<br/>      <span class="hljs-comment">// the shooter has died before he got the shot off</span><br/>      <span class="hljs-keyword">if</span> (state.doing[action.killer] === C.DEAD) {<br/>        newstate.log.push(<br/>          <span class="hljs-string">&quot;The trigger finger twitches on &quot;</span> + action.killer + <span class="hljs-string">&quot;&#x27;s corpse&quot;</span><br/>        );<br/>      } <span class="hljs-keyword">else</span> {<br/>        newstate.doing[action.killer] = C.WAITING;<br/>        <span class="hljs-comment">// the target is ducking</span><br/>        <span class="hljs-keyword">if</span> (state.doing[action.victim] === C.DUCKING) {<br/>          newstate.log.push(<br/>            action.victim + <span class="hljs-string">&quot; dodges a blast from &quot;</span> + action.killer + <span class="hljs-string">&quot;!&quot;</span><br/>          );<br/>          <span class="hljs-comment">// the target has already been killed</span><br/>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state.doing[action.victim] === C.DEAD) {<br/>          newstate.log.push(<br/>            action.killer + <span class="hljs-string">&quot; blasts &quot;</span> + action.victim + <span class="hljs-string">&quot;&#x27;s corpse.&quot;</span><br/>          );<br/>          <span class="hljs-comment">// we kill the target!</span><br/>        } <span class="hljs-keyword">else</span> {<br/>          <span class="hljs-keyword">if</span> (state.doing[action.victim] === C.AIMING) {<br/>            newstate.log.push(<br/>              action.killer +<br/>                <span class="hljs-string">&quot; killed &quot;</span> +<br/>                action.victim +<br/>                <span class="hljs-string">&quot; before he got his shot off!&quot;</span><br/>            );<br/>          } <span class="hljs-keyword">else</span> {<br/>            newstate.log.push(action.killer + <span class="hljs-string">&quot; killed &quot;</span> + action.victim + <span class="hljs-string">&quot;!&quot;</span>);<br/>          }<br/>          newstate.doing[action.victim] = C.DEAD;<br/>          newstate.standing = newstate.standing - <span class="hljs-number">1</span>;<br/>          <span class="hljs-keyword">if</span> (newstate.standing === <span class="hljs-number">1</span>) {<br/>            newstate.log.push(action.killer + <span class="hljs-string">&quot; WINS!!&quot;</span>);<br/>          }<br/>        }<br/>      }<br/>      <span class="hljs-keyword">return</span> newstate;<br/>    <span class="hljs-keyword">case</span> C.RESET:<br/>      <span class="hljs-keyword">return</span> initialState().battlefield;<br/>    <span class="hljs-keyword">default</span>:<br/>      <span class="hljs-keyword">return</span> state || initialState().battlefield;<br/>  }<br/>};</code></pre><p>Please take a moment to look at the various cases, and connect it to how the app behaved when you tested it earlier!</p><h3 id="components">Components</h3><p>The app are made up by these components:</p><p><img src="/static/posts/a-react-redux-example-app/img/superherocomponents.png" alt="components"/></p><p>The hierarchy isn&#x27;t strictly true as <code>Hero</code> and <code>Home</code> are served through <code>routes</code>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ReactRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-router&quot;</span>),<br/>  Route = ReactRouter.Route,<br/>  IndexRoute = ReactRouter.IndexRoute,<br/>  Wrapper = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./components/wrapper&quot;</span>),<br/>  Home = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./components/home&quot;</span>),<br/>  Hero = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./components/hero&quot;</span>);<br/><br/><span class="hljs-built_in">module</span>.exports = (<br/>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Wrapper}</span>&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">IndexRoute</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Home}</span> /&gt;</span><br/>    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/hero/:name&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">{Hero}</span> /&gt;</span><br/>  <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br/>);</code></pre><p>The app only has two routes, either we&#x27;re in the main battle arena or we are in a closeup of one of the heroes.</p><p><code>Wrapper</code> doesn&#x27;t do anything exciting, it simply renders out the children:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>);<br/><br/><span class="hljs-keyword">var</span> Wrapper = React.createClass({<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Superhero battle arena 2000!<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br/>        {this.props.children}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});<br/><br/><span class="hljs-built_in">module</span>.exports = Wrapper;</code></pre><p>For slightly higher excitement let&#x27;s take a look at <code>Hero</code>, our first Redux-aware component:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ptypes = React.PropTypes,<br/>  Link = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-router&quot;</span>).Link,<br/>  ReactRedux = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-redux&quot;</span>);<br/><br/><span class="hljs-keyword">var</span> Hero = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">params</span>: ptypes.shape({ <span class="hljs-attr">name</span>: ptypes.string.isRequired }).isRequired, <span class="hljs-comment">// will be provided by react-router</span><br/>    <span class="hljs-attr">heroes</span>: ptypes.object.isRequired <span class="hljs-comment">// will be provided by react-redux</span><br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> name = <span class="hljs-built_in">this</span>.props.params.name,<br/>      data = <span class="hljs-built_in">this</span>.props.heroes[name];<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br/>          <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Back to arena<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here&#x27;s some info on {this.props.params.name}:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br/>          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Quote:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {data.quote}{&quot; &quot;}<br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br/>          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Kills:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {data.kills}{&quot; &quot;}<br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});<br/><br/><span class="hljs-comment">// connect to Redux store</span><br/><br/><span class="hljs-keyword">var</span> mapStateToProps = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{<br/>  <span class="hljs-comment">// This component will have access to `appstate.heroes` through `this.props.heroes`</span><br/>  <span class="hljs-keyword">return</span> { <span class="hljs-attr">heroes</span>: state.heroes };<br/>};<br/><br/><span class="hljs-built_in">module</span>.exports = ReactRedux.connect(mapStateToProps)(Hero);</code></pre><p>Through <code>ReactRedux</code> we give the component access to the <code>battlefield</code> part of the app state. The component can the use that just as any other property data served down from a higher-level component.</p><p>Using <code>ReactRouter</code> we learn the name of the current hero we&#x27;ve navigated to (there should probably be some error checking in there though), and then we can dig out the correct data.</p><h3 id="getting-dirty">Getting dirty</h3><p>On to the next Redux-aware component - <code>Home</code>, which is the main battle arena!</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ptypes = React.PropTypes,<br/>  ReactRedux = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-redux&quot;</span>),<br/>  Log = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./log&quot;</span>),<br/>  Battlers = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./battlers&quot;</span>),<br/>  actions = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../actions&quot;</span>);<br/><br/><span class="hljs-keyword">var</span> Home = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-comment">// redux store state, imported below</span><br/>    <span class="hljs-attr">battle</span>: ptypes.shape({<br/>      <span class="hljs-attr">doing</span>: ptypes.object.isRequired,<br/>      <span class="hljs-attr">log</span>: ptypes.arrayOf(ptypes.string)<br/>    }).isRequired,<br/>    <span class="hljs-comment">// redux action hookups, set up below</span><br/>    <span class="hljs-attr">kill</span>: ptypes.func.isRequired,<br/>    <span class="hljs-attr">duck</span>: ptypes.func.isRequired,<br/>    <span class="hljs-attr">reset</span>: ptypes.func.isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> battleprops = <span class="hljs-built_in">this</span>.props.battle;<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">Battlers</span><br/>          <span class="hljs-attr">doing</span>=<span class="hljs-string">{battleprops.doing}</span><br/>          <span class="hljs-attr">kill</span>=<span class="hljs-string">{this.props.kill}</span><br/>          <span class="hljs-attr">duck</span>=<span class="hljs-string">{this.props.duck}</span><br/>        /&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">Log</span> <span class="hljs-attr">log</span>=<span class="hljs-string">{battleprops.log}</span> /&gt;</span><br/>        {battleprops.standing === 1 &amp;&amp; (<br/>          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.reset}</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br/>        )}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});<br/><br/><span class="hljs-comment">// now we connect the component to the Redux store:</span><br/><br/><span class="hljs-keyword">var</span> mapStateToProps = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{<br/>  <span class="hljs-comment">// This component will have access to `state.battlefield` through `this.props.battle`</span><br/>  <span class="hljs-keyword">return</span> { <span class="hljs-attr">battle</span>: state.battlefield };<br/>};<br/><br/><span class="hljs-keyword">var</span> mapDispatchToProps = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dispatch</span>) </span>{<br/>  <span class="hljs-keyword">return</span> {<br/>    <span class="hljs-attr">kill</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">killer, victim</span>) </span>{<br/>      dispatch(actions.aimAt(killer, victim));<br/>    },<br/>    <span class="hljs-attr">duck</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">coward</span>) </span>{<br/>      dispatch(actions.duckDown(coward));<br/>    },<br/>    <span class="hljs-attr">reset</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>      dispatch(actions.reset());<br/>    }<br/>  };<br/>};<br/><br/><span class="hljs-built_in">module</span>.exports = ReactRedux.connect(mapStateToProps, mapDispatchToProps)(Home);</code></pre><p>Like before we connect it to the Redux Store, but unlike before we also import the action creators we saw earlier to use as callbacks!</p><p>Of these, <code>reset</code> is used in this very component while <code>kill</code> and <code>duck</code> are passed down to the <code>Battlers</code> component:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ptypes = React.PropTypes,<br/>  Battler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./battler&quot;</span>),<br/>  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lodash&quot;</span>);<br/><br/><span class="hljs-keyword">var</span> Battlers = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">kill</span>: ptypes.func.isRequired,<br/>    <span class="hljs-attr">duck</span>: ptypes.func.isRequired,<br/>    <span class="hljs-attr">doing</span>: ptypes.object.isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props,<br/>      boxes = _.map(<br/>        p.doing,<br/>        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">doing, name</span>) </span>{<br/>          <span class="hljs-keyword">var</span> kill = p.kill.bind(<span class="hljs-built_in">this</span>, name), <span class="hljs-comment">// prefill the kill method so that killer is always `name`</span><br/>            duck = p.duck.bind(<span class="hljs-built_in">this</span>, name); <span class="hljs-comment">// make sure battler can only duck himself</span><br/>          <span class="hljs-keyword">return</span> (<br/>            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Battler</span><br/>              <span class="hljs-attr">key</span>=<span class="hljs-string">{name}</span><br/>              <span class="hljs-attr">name</span>=<span class="hljs-string">{name}</span><br/>              <span class="hljs-attr">doing</span>=<span class="hljs-string">{p.doing}</span><br/>              <span class="hljs-attr">kill</span>=<span class="hljs-string">{kill}</span><br/>              <span class="hljs-attr">duck</span>=<span class="hljs-string">{duck}</span><br/>            /&gt;</span></span><br/>          );<br/>        },<br/>        <span class="hljs-built_in">this</span><br/>      );<br/>    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;battlers&quot;</span>&gt;</span>{boxes}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br/>  }<br/>});<br/><br/><span class="hljs-built_in">module</span>.exports = Battlers;</code></pre><p>This components renders a <code>Battler</code> component for each super hero, giving them their name, personalized versions of <code>kill</code> and <code>duck</code>, as well as the full <code>doing</code> object containing the status of everyone. Here&#x27;s the code for <code>Battler</code>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ptypes = React.PropTypes,<br/>  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;lodash&quot;</span>),<br/>  Link = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react-router&quot;</span>).Link,<br/>  C = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../constants&quot;</span>);<br/><br/><span class="hljs-keyword">var</span> Battler = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">name</span>: ptypes.string.isRequired,<br/>    <span class="hljs-attr">kill</span>: ptypes.func.isRequired,<br/>    <span class="hljs-attr">duck</span>: ptypes.func.isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props,<br/>      name = p.name,<br/>      doing = p.doing,<br/>      <span class="hljs-comment">// list all enemies that aren&#x27;t dead yet</span><br/>      killable = _.reduce(<br/>        doing,<br/>        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">list, status, opp</span>) </span>{<br/>          <span class="hljs-keyword">return</span> status !== C.DEAD &amp;&amp; opp !== name ? list.concat(opp) : list;<br/>        },<br/>        []<br/>      ),<br/>      <span class="hljs-comment">// make buttons for all killable enemies</span><br/>      buttons = killable<br/>        .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opp</span>) </span>{<br/>          <span class="hljs-keyword">return</span> (<br/>            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{opp}</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{p.kill.bind(this,</span> <span class="hljs-attr">opp</span>)}&gt;</span><br/>              {&quot;Kill &quot; + opp}<br/>            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br/>          );<br/>        }, <span class="hljs-built_in">this</span>)<br/>        .concat(<br/>          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;duck&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{p.duck}</span>&gt;</span><br/>            duck<br/>          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br/>        );<br/>    <span class="hljs-comment">//controls depend on what we&#x27;re doing</span><br/>    <span class="hljs-keyword">var</span> controls = {<br/>      <span class="hljs-comment">// using ES6 syntax for dynamic object properties</span><br/>      [C.WAITING]: buttons.length &gt; <span class="hljs-number">1</span> ? buttons : <span class="hljs-string">&quot;Winner!!&quot;</span>,<br/>      [C.DUCKING]: <span class="hljs-string">&quot;ducking&quot;</span>,<br/>      [C.DEAD]: <span class="hljs-string">&quot;...dead...&quot;</span>,<br/>      [C.AIMING]: <span class="hljs-string">&quot;aiming!&quot;</span><br/>    }[p.doing[name]];<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;battler&quot;</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>&quot;/<span class="hljs-attr">hero</span>/&quot; + <span class="hljs-attr">name</span>}&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{controls}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});<br/><br/><span class="hljs-built_in">module</span>.exports = Battler;</code></pre><p>Here we finally hook up <code>kill</code> and <code>duck</code> to user interactions.</p><p>For completion&#x27;s sake let&#x27;s also list the code for <code>Log</code>, although there&#x27;s nothing much going on there:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> React = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;react&quot;</span>),<br/>  ptypes = React.PropTypes;<br/><br/><span class="hljs-keyword">var</span> Log = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">log</span>: ptypes.arrayOf(ptypes.string).isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br/>        {this.props.log.map(function(txt, n) {<br/>          return <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{n}</span>&gt;</span>{txt}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>;<br/>        })}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br/>    );<br/>  }<br/>});<br/><br/><span class="hljs-built_in">module</span>.exports = Log;</code></pre><h3 id="wrapping-up">Wrapping up</h3><p>As warned I didn&#x27;t explain much about how Redux works, but again, the <a href="http://redux.js.org/">official docs</a> are really brilliant. But I hope this hands-on example helped you learn what I have; that Redux, although tiny, is one beast of a data flow library!</p></div><hr/></div><div id="disqus_thread" style="display:none"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/posts/a-react-redux-example-app","query":{},"buildId":"wQeVqw4-MCmoY2Zy_p65E","dynamicBuildId":false,"nextExport":true}</script><script async="" id="__NEXT_PAGE__/posts/a-react-redux-example-app" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-redux-example-app.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js"></script><script src="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" async=""></script><script src="/_next/static/chunks/commons.ebbfd942159f83091516.js" async=""></script><script src="/_next/static/runtime/main-c1620565ee9f1f33603c.js" async=""></script><script type="text/javascript" async="" src="https://krawaller.disqus.com/embed.js"></script></body></html>