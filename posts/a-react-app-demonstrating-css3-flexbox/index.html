<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/static/styles/nprogress.css"/><link rel="stylesheet" href="/static/styles/code.css"/><link rel="stylesheet" href="/static/styles/site.css"/><link href="https://fonts.googleapis.com/css?family=Open+Sans&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Lexend+Zetta&amp;display=swap" rel="stylesheet"/><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-11433118-1', 'auto');
  ga("send", "pageview");</script><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/><meta charSet="utf-8"/><title>A React app demonstrating CSS3 flexbox</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-app-demonstrating-css3-flexbox.js" as="script"/><link rel="preload" href="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ebbfd942159f83091516.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-c1620565ee9f1f33603c.js" as="script"/></head><body><div id="__next"><div style="margin-bottom:20px"></div><div class="master"><h1><a href="/"><span>k</span><span>r</span><span>a</span><span>w</span><span>a</span><span>l</span><span>l</span><span>e</span><span>r</span></a></h1><hr/><div class="summary">Presenting and dissecting a React-built CSS flexbox demonstration app</div><hr/><h2>A React app demonstrating CSS3 flexbox</h2><p class="taglist">Tags:<!-- --> <a href="/tags/css/">css</a><a href="/tags/css3/">css3</a><a href="/tags/flexbox/">flexbox</a><a href="/tags/react/">react</a><a href="/tags/case_study/">case study</a><a href="/tags/underscore/">underscore</a></p><div class="page-content"><div class="post" data-postid="flexdemo"><h3 id="exploring-flexbox">Exploring Flexbox</h3><p>Like everyone else I&#x27;ve been playing around with the newly released <a href="http://facebook.github.io/react-native/">React Native</a>. Buckets of fun! But I was quickly made aware that I still haven&#x27;t really understood <a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/">flexbox</a>, which React Native uses for layout.</p><p>In order to alleviate that I built an interactive demo app where you can change the related props for the container and the children, and see first hand what the resulting layout looks like. This helped me a lot, so I share it here hoping it can help you too! You can try it out below, and it is also published <a href="">here</a>.</p><iframe src="https://blog.krawaller.se/flexboxdemo/index.html" style="height:440px;width:100%"></iframe><p>Putting the demo app together was a lot of fun! I used React (of course), and it turned out to be a great fit for this particular project. Throughout the rest of this post I&#x27;ll walk through the <a href="">source code</a>.</p><h3 id="components">Components</h3><p>The app is made up by four components:</p><p><img src="/static/posts/a-react-app-demonstrating-css3-flexbox/img/flexboxcomp.jpg" alt="components"/></p><p>The top level <code>Demo</code> component uses <code>Child</code> to display the flex children. It also renders the two <code>Form</code>s, who in turn uses <code>Dropdown</code> for each individual control.</p><h3 id="demo">Demo</h3><p>Let&#x27;s first look at the <code>Demo</code> component. The file (<a href="https://github.com/krawaller/flexboxdemo/blob/gh-pages/src/demo.js">demo.js</a>) contains the regular class definition as well as the flex data blueprint:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> parentoptions = {<br/>  <span class="hljs-attr">flexDirection</span>: [<span class="hljs-string">&quot;row&quot;</span>,<span class="hljs-string">&quot;row-reverse&quot;</span>,<span class="hljs-string">&quot;column&quot;</span>,<span class="hljs-string">&quot;column-reverse&quot;</span>],<br/>  <span class="hljs-attr">justifyContent</span>: [<span class="hljs-string">&quot;flex-start&quot;</span>,<span class="hljs-string">&quot;flex-end&quot;</span>,<span class="hljs-string">&quot;center&quot;</span>,<span class="hljs-string">&quot;space-between&quot;</span>,<span class="hljs-string">&quot;space-around&quot;</span>],<br/>  <span class="hljs-attr">alignItems</span>: [<span class="hljs-string">&quot;flex-start&quot;</span>,<span class="hljs-string">&quot;flex-end&quot;</span>,<span class="hljs-string">&quot;center&quot;</span>,<span class="hljs-string">&quot;stretch&quot;</span>,<span class="hljs-string">&quot;baseline&quot;</span>],<br/>  <span class="hljs-attr">flexWrap</span>: [<span class="hljs-string">&quot;nowrap&quot;</span>,<span class="hljs-string">&quot;wrap&quot;</span>,<span class="hljs-string">&quot;wrap-reverse&quot;</span>],<br/>  <span class="hljs-attr">alignContent</span>: [<span class="hljs-string">&quot;flex-start&quot;</span>,<span class="hljs-string">&quot;flex-end&quot;</span>,<span class="hljs-string">&quot;center&quot;</span>,<span class="hljs-string">&quot;stretch&quot;</span>,<span class="hljs-string">&quot;space-between&quot;</span>,<span class="hljs-string">&quot;space-around&quot;</span>]<br/>};<br/><br/><span class="hljs-keyword">var</span> childoptions = {<br/>  <span class="hljs-attr">alignSelf</span>: [<span class="hljs-string">&quot;auto&quot;</span>,<span class="hljs-string">&quot;flex-start&quot;</span>,<span class="hljs-string">&quot;flex-end&quot;</span>,<span class="hljs-string">&quot;center&quot;</span>,<span class="hljs-string">&quot;baseline&quot;</span>,<span class="hljs-string">&quot;stretch&quot;</span>],<br/>  <span class="hljs-attr">flexGrow</span>: _.range(<span class="hljs-number">0</span>,<span class="hljs-number">6</span>),<br/>  <span class="hljs-attr">order</span>: _.range(<span class="hljs-number">-10</span>,<span class="hljs-number">11</span>)<br/>};<br/><br/><span class="hljs-keyword">var</span> Demo = React.createClass({<br/>  <span class="hljs-attr">getInitialState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{...},<br/>  <span class="hljs-attr">setValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{...},<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{...}<br/>});</code></pre><p>These are used to build the initial state of the component:</p><pre><code class="hljs language-javascript">getInitialState: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<br/>  <span class="hljs-keyword">return</span> {<br/>    <span class="hljs-attr">parent</span>: _.mapValues(parentoptions,_.first),<br/>    <span class="hljs-attr">children</span>: _.range(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>)</span>{<br/>      <span class="hljs-keyword">return</span> _.extend(_.mapValues(childoptions,_.first),{ <span class="hljs-attr">ID</span>: n, <span class="hljs-attr">order</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">flexGrow</span>: <span class="hljs-number">0</span> });<br/>    }),<br/>    <span class="hljs-attr">selectedId</span>: <span class="hljs-number">0</span><br/>  };<br/>}</code></pre><p>As you can see we have three state variables:</p><ul><li><code>parent</code> contains the currently selected container options. To begin with we select the first option from each array of property values.</li><li><code>children</code> contains an array with an option object for each child. Again we use the first option as default except for <code>flexGrow</code> and <code>order</code>. Each child is also given a unique id.</li><li><code>selectedId</code> contains the position of the currently selected child.</li></ul><p>The app implements a bare-bones cursor, similar to <a href="https://github.com/dustingetz/react-cursor">React cursor</a> or <a href="https://github.com/mquan/cortex">Cortex</a>. The child components will get callbacks that when called update <code>Demo</code>&#x27;s state. This is implemented through the <code>setValues</code> method:</p><pre><code class="hljs language-javascript">setValue: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<br/>  <span class="hljs-keyword">var</span> arr = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>),<br/>      val = arr.pop(),<br/>      prop = arr.pop(),<br/>      clone = _.cloneDeep(<span class="hljs-built_in">this</span>.state),<br/>      pointer = clone;<br/>  <span class="hljs-keyword">while</span>(arr.length) pointer = pointer[arr.shift()];<br/>  pointer[prop] = _.isFinite(<span class="hljs-built_in">parseInt</span>(val)) ? <span class="hljs-built_in">parseInt</span>(val) : val;<br/>  <span class="hljs-built_in">this</span>.setState(clone);<br/>}</code></pre><p>If we did <code>setValue(&quot;children&quot;,0,&quot;alignSelf&quot;,&quot;stretch&quot;)</code>, then that would equal <code>this.state[&quot;children&quot;][0][&quot;alignSelf&quot;] = &quot;stretch&quot;</code>.</p><p>Inside the <code>render</code> method of <code>Demo</code> we pass callbacks to the child components tied to <code>setValue</code>, with the arguments partly prefilled.</p><pre><code class="hljs language-javascript">  render: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<br/>    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">this</span>.state, child = s.selectedId, cbmaker = <span class="hljs-built_in">Function</span>.prototype.bind.bind(<span class="hljs-built_in">this</span>.setValue,<span class="hljs-built_in">this</span>);<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;wrapper&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{Date()}</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;explanation&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;forms&quot;</span>&gt;</span><br/>          <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;container&quot;</span> <span class="hljs-attr">options</span>=<span class="hljs-string">{parentoptions}</span> <span class="hljs-attr">values</span>=<span class="hljs-string">{s.parent}</span> <span class="hljs-attr">callback</span>=<span class="hljs-string">{cbmaker(</span>&quot;<span class="hljs-attr">parent</span>&quot;)} /&gt;</span><br/>          <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{</span>&quot;<span class="hljs-attr">child</span> #&quot;+(<span class="hljs-attr">child</span>+<span class="hljs-attr">1</span>)} <span class="hljs-attr">options</span>=<span class="hljs-string">{childoptions}</span> <span class="hljs-attr">values</span>=<span class="hljs-string">{s.children[child]}</span> <span class="hljs-attr">callback</span>=<span class="hljs-string">{cbmaker(</span>&quot;<span class="hljs-attr">children</span>&quot;,<span class="hljs-attr">child</span>)} /&gt;</span><br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;container&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{s.parent}</span>&gt;</span><br/>          {s.children.map(function(c,n){<br/>            return <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{c.ID}</span> <span class="hljs-attr">def</span>=<span class="hljs-string">{c}</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">{n</span>===<span class="hljs-string">child}</span> <span class="hljs-attr">callback</span>=<span class="hljs-string">{cbmaker(</span>&quot;<span class="hljs-attr">selectedId</span>&quot;,<span class="hljs-attr">n</span>)} /&gt;</span>;<br/>          },this)}<br/>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }</code></pre><p>Yes, I did feel rather smug when using <code>bind</code> on <code>bind</code> to define <code>cbmaker</code>. :)</p><h3 id="child">Child</h3><p>The <a href="https://github.com/krawaller/flexboxdemo/blob/gh-pages/src/child.js"><code>Child</code> component</a> is rather simple - it receives an object of styles which it should apply, and also write out.</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> Child = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">def</span>: ptypes.objectOf(ptypes.oneOfType([ptypes.string, ptypes.number]))<br/>      .isRequired,<br/>    <span class="hljs-attr">selected</span>: ptypes.bool,<br/>    <span class="hljs-attr">callback</span>: ptypes.func.isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props;<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span><br/>        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{_.ary(p.callback,</span> <span class="hljs-attr">0</span>)}<br/>        <span class="hljs-attr">style</span>=<span class="hljs-string">{p.def}</span><br/>        <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>&quot;<span class="hljs-attr">child</span>&quot; + (<span class="hljs-attr">p.selected</span> ? &quot; <span class="hljs-attr">selectedchild</span>&quot; <span class="hljs-attr">:</span> &quot;&quot;)}<br/>      &gt;</span><br/>        {_.map(<br/>          p.def,<br/>          function(val, key) {<br/>            return (<br/>              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{key}</span>&gt;</span><br/>                {key}: {val}<br/>              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>            );<br/>          },<br/>          this<br/>        )}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});</code></pre><p>Notice how we must do <code>_.ary(p.callback,0)</code> to prevent the click event from being passed along, messing up the <code>setValue</code> call in <code>Demo</code>.</p><h3 id="form">Form</h3><p>The <a href="https://github.com/krawaller/flexboxdemo/blob/gh-pages/src/form.js"><code>Form</code> component</a> take an <code>options</code> object, a <code>values</code> object containing the currently selected options, a <code>title</code> and a <code>callback</code>. It will then use a <code>Dropdown</code> component for each property in <code>options</code>/<code>values</code>.</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> Form = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">options</span>: ptypes.objectOf(<br/>      ptypes.arrayOf(ptypes.oneOfType([ptypes.string, ptypes.number]))<br/>    ).isRequired,<br/>    <span class="hljs-attr">values</span>: ptypes.objectOf(ptypes.oneOfType([ptypes.string, ptypes.number]))<br/>      .isRequired,<br/>    <span class="hljs-attr">title</span>: ptypes.string.isRequired,<br/>    <span class="hljs-attr">callback</span>: ptypes.func.isRequired<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">var</span> p = <span class="hljs-built_in">this</span>.props;<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;form&quot;</span>&gt;</span><br/>        <span class="hljs-tag">&lt;<span class="hljs-name">strong</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>{p.title}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><br/>        {_.mapValues(<br/>          p.options,<br/>          function(opts, name) {<br/>            return (<br/>              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{name}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;formrow&quot;</span>&gt;</span><br/>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{name}: <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br/>                <span class="hljs-tag">&lt;<span class="hljs-name">Dropdown</span><br/>                  <span class="hljs-attr">options</span>=<span class="hljs-string">{opts}</span><br/>                  <span class="hljs-attr">current</span>=<span class="hljs-string">{p.values[name]}</span><br/>                  <span class="hljs-attr">callback</span>=<span class="hljs-string">{p.callback.bind(this,</span> <span class="hljs-attr">name</span>)}<br/>                /&gt;</span><br/>              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br/>            );<br/>          },<br/>          this<br/>        )}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br/>    );<br/>  }<br/>});</code></pre><p>Note how it passes <code>callback</code> along to each <code>Dropdown</code> but curries it further with the property name.</p><h3 id="dropdown">Dropdown</h3><p>Finally, the <code>Dropdown</code> component renders a <code>select</code> control with the given values.</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> Dropdown = React.createClass({<br/>  <span class="hljs-attr">propTypes</span>: {<br/>    <span class="hljs-attr">options</span>: ptypes.arrayOf(ptypes.oneOfType([ptypes.string, ptypes.number]))<br/>      .isRequired,<br/>    <span class="hljs-attr">current</span>: ptypes.oneOfType([ptypes.string, ptypes.number]).isRequired,<br/>    <span class="hljs-attr">callback</span>: ptypes.func.isRequired<br/>  },<br/>  <span class="hljs-attr">changeOption</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{<br/>    <span class="hljs-built_in">this</span>.props.callback(<span class="hljs-built_in">this</span>.refs.sel.getDOMNode().value);<br/>  },<br/>  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<br/>    <span class="hljs-keyword">return</span> (<br/>      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span><br/>        <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;sel&quot;</span><br/>        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{this.changeOption}</span><br/>        <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{</span>&quot;&quot; + <span class="hljs-attr">this.props.current</span>}<br/>      &gt;</span><br/>        {this.props.options.map(function(o) {<br/>          return (<br/>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{o}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{o}</span>&gt;</span><br/>              {o}<br/>            <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br/>          );<br/>        })}<br/>      <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br/>    );<br/>  }<br/>});</code></pre><p>Calling <code>callback</code> with the updated value will result in a curried call to <code>setValue</code>.</p><h3 id="wrapping-up">Wrapping up</h3><p>Since the demo app by its very nature needed to cascade data changes, it turned out to be a great fit for React. Then again, most apps are!</p><p>And although flexbox can seem intimidating at first, the model at its heart is really rather simple! Yet hugely powerful, and I think it was a stroke of genious to give it the task of layout in React Native. I&#x27;ve done my fare share of Titanium development, but feel that using flexbox seems superior in every way.</p></div><hr/></div><div id="disqus_thread" style="display:none"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/posts/a-react-app-demonstrating-css3-flexbox","query":{},"buildId":"wQeVqw4-MCmoY2Zy_p65E","dynamicBuildId":false,"nextExport":true}</script><script async="" id="__NEXT_PAGE__/posts/a-react-app-demonstrating-css3-flexbox" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/posts/a-react-app-demonstrating-css3-flexbox.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/wQeVqw4-MCmoY2Zy_p65E/pages/_app.js"></script><script src="/_next/static/runtime/webpack-3df6523e264ff2ac6548.js" async=""></script><script src="/_next/static/chunks/commons.ebbfd942159f83091516.js" async=""></script><script src="/_next/static/runtime/main-c1620565ee9f1f33603c.js" async=""></script><script type="text/javascript" async="" src="https://krawaller.disqus.com/embed.js"></script></body></html>